# –û—Ç—á–µ—Ç –ø–æ –æ—á–∏—Å—Ç–∫–µ –¥—É–±–ª–∏—Ä—É—é—â–µ–≥–æ—Å—è –∫–æ–¥–∞ (LEGACY)

## üìÖ –î–∞—Ç–∞: 2025-01-23
## üéØ –¶–µ–ª—å: –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –ø–æ–º–µ—Ç–∫–∞ –¥—É–±–ª–∏—Ä—É—é—â–µ–≥–æ—Å—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –∫–∞–∫ Legacy

## üîç –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –¥—É–±–ª–∏

### 1. –°–µ—Ä–≤–∏—Å—ã –∞–≤–∞—Ç–∞—Ä–æ–≤ (AvatarService)
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û
- **–û—Å–Ω–æ–≤–Ω–æ–π (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è):** `app/services/avatar_db.py` 
- **–î—É–±–ª—å 1:** `app/services/avatar/service.py` ‚Üí `app/services/avatar/service.py.LEGACY`
- **–î—É–±–ª—å 2:** `app/services/avatar/avatar_service.py` ‚Üí `app/services/avatar/avatar_service.py.LEGACY`

**–î–µ–π—Å—Ç–≤–∏—è:**
- –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω—ã –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è —Ñ–∞–π–ª—ã —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º `.LEGACY`
- –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –≤–µ—Å—å –∫–æ–¥ –¥—É–±–ª–µ–π
- –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ–± –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞

### 2. Legacy –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û
- `app/keyboards/avatar.py` - legacy —Ñ—É–Ω–∫—Ü–∏—è `avatar_inline_keyboard()` –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞
- `app/handlers/fallback.py` - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö callback'–æ–≤ (–æ—Å—Ç–∞–≤–ª–µ–Ω –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)

### 3. Legacy —Ñ—É–Ω–∫—Ü–∏–∏ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–æ–≤
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –¢–†–ï–ë–£–ï–¢ –í–ù–ò–ú–ê–ù–ò–Ø
- `app/database/repositories/transcript.py:28` - –º–µ—Ç–æ–¥ `get_user_transcripts()` –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ LEGACY
- `app/services/transcript.py:155` - –º–µ—Ç–æ–¥ `get_user_transcripts()` –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ LEGACY

### 4. –î—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è —É—Ç–∏–ª–∏—Ç—ã –æ—á–∏—Å—Ç–∫–∏ —Ñ–∞–π–ª–æ–≤
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û
- `app/services/audio_processing/storage.py:128` - `cleanup_old_files()` (–æ—Å–Ω–æ–≤–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)
- `app/core/utils.py:53` - `cleanup_old_files()` –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ –∫–∞–∫ LEGACY

## üìã –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –¥–∞–ª—å–Ω–µ–π—à–µ–π –æ—á–∏—Å—Ç–∫–µ

### –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
1. **–ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å legacy –º–µ—Ç–æ–¥—ã —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–æ–≤** –Ω–∞ –Ω–æ–≤—ã–µ API
2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ legacy –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤** –≤ fallback.py
3. **–û—á–∏—Å—Ç–∏—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –ø–æ–ª—è –≤ –º–æ–¥–µ–ª—è—Ö** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `order` –≤ `AvatarPhoto`)

### –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
1. **–£–¥–∞–ª–∏—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∏–º–ø–æ—Ä—Ç—ã** –≤ DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
2. **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ legacy –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤** –≤ –∫–æ–¥–µ
3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏** —Å –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π

### –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
1. **–û—á–∏—Å—Ç–∫–∞ –∫–∞—Ç–∞–ª–æ–≥–∞ archive/** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ –ø–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
2. **–£–¥–∞–ª–µ–Ω–∏–µ .LEGACY —Ñ–∞–π–ª–æ–≤** –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

## üõ†Ô∏è –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (app/core/di.py)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä `get_avatar_service()`
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ "missing 1 required positional argument: 'session'"

### –§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- ‚úÖ –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω—ã –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è —Å–µ—Ä–≤–∏—Å—ã —Å —Å—É—Ñ—Ñ–∏–∫—Å–æ–º `.LEGACY`
- ‚úÖ –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –∫–æ–¥ –≤ legacy —Ñ–∞–π–ª–∞—Ö
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ–± –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –Ω–æ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### –£—Ç–∏–ª–∏—Ç—ã –∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
- ‚úÖ –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ –¥—É–±–ª–∏—Ä—É—é—â–∞—è—Å—è —Ñ—É–Ω–∫—Ü–∏—è `cleanup_old_files()` –≤ utils.py
- ‚úÖ –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ legacy —Ñ—É–Ω–∫—Ü–∏—è `avatar_inline_keyboard()` –≤ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞—Ö

## üîÑ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
2. **–ú–∏–≥—Ä–∞—Ü–∏—è –≤—ã–∑–æ–≤–æ–≤** - –Ω–∞–π—Ç–∏ –∏ –æ–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ legacy —Ñ—É–Ω–∫—Ü–∏—è–º
3. **–£–¥–∞–ª–µ–Ω–∏–µ legacy —Ñ–∞–π–ª–æ–≤** - –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
4. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏** - –∞–∫—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Å—Ö–µ–º—ã

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤:** 2
- **–ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤:** 2
- **–ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π:** 2
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫ DI:** 1
- **–ù–∞–π–¥–µ–Ω–Ω—ã—Ö legacy –º–µ—Ç–æ–¥–æ–≤:** 4+
- **–ü—Ä–æ—Ü–µ–Ω—Ç –æ—á–∏—Å—Ç–∫–∏:** ~60% (–æ—Å–Ω–æ–≤–Ω—ã–µ –¥—É–±–ª–∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã)

---
*–û—Ç—á–µ—Ç —Å–æ–∑–¥–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã* 
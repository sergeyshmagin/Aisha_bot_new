# üê≥ –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ Docker –¥–ª—è Aisha Bot v2

**–°—Ç–∞—Ç—É—Å:** üìã –í –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏  
**–û–∫—Ä—É–∂–µ–Ω–∏–µ:** WSL2 (dev) ‚Üí Ubuntu 24 (prod)  
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** –Ø–Ω–≤–∞—Ä—å 2025  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í–´–°–û–ö–ò–ô

---

## üéØ **–¶–ï–õ–ò –ú–ò–ì–†–ê–¶–ò–ò**

### **–û—Å–Ω–æ–≤–Ω—ã–µ —Ü–µ–ª–∏**
1. **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π** - —É–ø–∞–∫–æ–≤–∫–∞ bot + api –≤ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
2. **Unified –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –ø–æ–¥—Ö–æ–¥ –≤ dev –∏ prod (–≤–Ω–µ—à–Ω–∏–µ –ë–î)
3. **–£–ø—Ä–æ—â–µ–Ω–∏–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è** - –æ–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
4. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–º—É –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é
5. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤** - PostgreSQL, Redis, MinIO —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã

### **–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è**
```
üè† Development (WSL2):
- ‚úÖ –¢–æ–ª—å–∫–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π (bot + api)
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –≤–Ω–µ—à–Ω–∏–º —Å–µ—Ä–≤–∏—Å–∞–º –ø—Ä–æ–µ–∫—Ç–∞
- ‚úÖ Hot reload, –æ—Ç–ª–∞–¥–∫–∞, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

üåê Production (aibots.kz - Ubuntu 24):
- ‚úÖ –¢–æ–ª—å–∫–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π (bot + api + nginx)
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Ç–µ–º –∂–µ –≤–Ω–µ—à–Ω–∏–º —Å–µ—Ä–≤–∏—Å–∞–º
- ‚úÖ –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```

---

## üèóÔ∏è **–ê–†–•–ò–¢–ï–ö–¢–£–†–ê –†–ï–®–ï–ù–ò–Ø**

### **–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (Dev + Prod)**
```mermaid
graph TB
    subgraph "Development (WSL2)"
        DEV_BOT[aisha-bot:dev]
        DEV_API[aisha-api:dev]
    end
    
    subgraph "Production (aibots.kz)"
        PROD_BOT[aisha-bot:prod]
        PROD_API[aisha-api:prod]
        NGINX[nginx-proxy]
    end
    
    subgraph "Existing Project Infrastructure"
        EXT_PG[(PostgreSQL)]
        EXT_REDIS[(Redis)]
        EXT_MINIO[(MinIO)]
    end
    
    DEV_BOT --> EXT_PG
    DEV_BOT --> EXT_REDIS
    DEV_BOT --> EXT_MINIO
    DEV_API --> EXT_PG
    DEV_API --> EXT_REDIS
    
    NGINX --> PROD_API
    PROD_BOT --> EXT_PG
    PROD_BOT --> EXT_REDIS
    PROD_BOT --> EXT_MINIO
    PROD_API --> EXT_PG
    PROD_API --> EXT_REDIS
```

---

## üìÅ **–°–¢–†–£–ö–¢–£–†–ê –§–ê–ô–õ–û–í**

```
Aisha_bot_new/
‚îú‚îÄ‚îÄ docker/
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile.bot               # –ú–Ω–æ–≥–æ—ç—Ç–∞–ø–Ω—ã–π: dev/prod
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile.api               # –ú–Ω–æ–≥–æ—ç—Ç–∞–ø–Ω—ã–π: dev/prod
‚îÇ   ‚îú‚îÄ‚îÄ nginx/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ nginx.conf               # Prod –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ nginx.dev.conf           # Dev –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
‚îÇ   ‚îî‚îÄ‚îÄ scripts/
‚îÇ       ‚îú‚îÄ‚îÄ wait-for-it.sh
‚îÇ       ‚îú‚îÄ‚îÄ deploy.sh                # –°–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è
‚îÇ       ‚îî‚îÄ‚îÄ health-check.sh          # –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
‚îú‚îÄ‚îÄ docker-compose.yml               # Development (—Ç–æ–ª—å–∫–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
‚îú‚îÄ‚îÄ docker-compose.prod.yml          # Production (–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è + nginx)
‚îú‚îÄ‚îÄ .env.docker.dev                  # Dev –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (–≤–Ω–µ—à–Ω–∏–µ –ë–î)
‚îú‚îÄ‚îÄ .env.docker.prod                 # Prod –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (–≤–Ω–µ—à–Ω–∏–µ –ë–î)
‚îî‚îÄ‚îÄ deploy/
    ‚îú‚îÄ‚îÄ setup.sh                     # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
    ‚îî‚îÄ‚îÄ systemd/
        ‚îî‚îÄ‚îÄ aisha-bot.service        # Systemd —Å–µ—Ä–≤–∏—Å
```

---

## üê≥ **–§–ê–ó–ê 1: DEVELOPMENT –û–ö–†–£–ñ–ï–ù–ò–ï (WSL2)**

### **1.1 Docker Compose –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (—Ç–æ–ª—å–∫–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)**

#### **docker-compose.yml**
```yaml
version: '3.8'

services:
  # ======================== APPLICATION SERVICES ONLY ========================
  
  aisha-bot:
    build:
      context: .
      dockerfile: docker/Dockerfile.bot
      target: development
    container_name: aisha-bot-dev
    restart: unless-stopped
    environment:
      # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –≤–Ω–µ—à–Ω–∏–º —Å–µ—Ä–≤–∏—Å–∞–º –ø—Ä–æ–µ–∫—Ç–∞
      - DATABASE_URL=postgresql+asyncpg://aisha:${POSTGRES_PASSWORD}@${DATABASE_HOST}:5432/aisha_v2
      - REDIS_URL=redis://${REDIS_HOST}:6379/0
      - MINIO_ENDPOINT=${MINIO_ENDPOINT}
      - DEBUG=true
      - ENVIRONMENT=development
    env_file:
      - .env.docker.dev
    volumes:
      - .:/app
      - /app/__pycache__
      - ./logs:/app/logs
    networks:
      - aisha-dev-network
    healthcheck:
      test: ["CMD", "python", "-c", "import sys; sys.exit(0)"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  aisha-api:
    build:
      context: .
      dockerfile: docker/Dockerfile.api
      target: development
    container_name: aisha-api-dev
    restart: unless-stopped
    ports:
      - "8443:8000"
    environment:
      # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –≤–Ω–µ—à–Ω–∏–º —Å–µ—Ä–≤–∏—Å–∞–º –ø—Ä–æ–µ–∫—Ç–∞
      - DATABASE_URL=postgresql+asyncpg://aisha:${POSTGRES_PASSWORD}@${DATABASE_HOST}:5432/aisha_v2
      - REDIS_URL=redis://${REDIS_HOST}:6379/0
      - DEBUG=true
      - ENVIRONMENT=development
    env_file:
      - .env.docker.dev
    volumes:
      - ./api_server:/app/api_server
    command: uvicorn api_server.main:app --host 0.0.0.0 --port 8000 --reload
    networks:
      - aisha-dev-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

networks:
  aisha-dev-network:
    driver: bridge
```

### **1.2 Production Compose (–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è + nginx)**

#### **docker-compose.prod.yml**
```yaml
version: '3.8'

services:
  # ======================== APPLICATION SERVICES ========================
  
  aisha-bot:
    build:
      context: .
      dockerfile: docker/Dockerfile.bot
      target: production
    container_name: aisha-bot-prod
    restart: always
    environment:
      # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Ç–µ–º –∂–µ –≤–Ω–µ—à–Ω–∏–º —Å–µ—Ä–≤–∏—Å–∞–º
      - DATABASE_URL=postgresql+asyncpg://aisha:${POSTGRES_PASSWORD}@${DATABASE_HOST}:5432/aisha_v2
      - REDIS_URL=redis://${REDIS_HOST}:6379/0
      - MINIO_ENDPOINT=${MINIO_ENDPOINT}
      - DEBUG=false
      - ENVIRONMENT=production
    env_file:
      - .env.docker.prod
    volumes:
      - ./logs:/app/logs
      - /etc/localtime:/etc/localtime:ro
    deploy:
      resources:
        limits:
          memory: 512M
          cpus: '0.5'
        reservations:
          memory: 256M
          cpus: '0.25'
    networks:
      - aisha-prod-network
    healthcheck:
      test: ["CMD", "python", "-c", "import sys; sys.exit(0)"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  aisha-api:
    build:
      context: .
      dockerfile: docker/Dockerfile.api
      target: production
    container_name: aisha-api-prod
    restart: always
    environment:
      # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Ç–µ–º –∂–µ –≤–Ω–µ—à–Ω–∏–º —Å–µ—Ä–≤–∏—Å–∞–º
      - DATABASE_URL=postgresql+asyncpg://aisha:${POSTGRES_PASSWORD}@${DATABASE_HOST}:5432/aisha_v2
      - REDIS_URL=redis://${REDIS_HOST}:6379/0
      - DEBUG=false
      - ENVIRONMENT=production
    env_file:
      - .env.docker.prod
    deploy:
      resources:
        limits:
          memory: 256M
          cpus: '0.5'
        reservations:
          memory: 128M
          cpus: '0.25'
      replicas: 2
    networks:
      - aisha-prod-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # ======================== REVERSE PROXY (—Ç–æ–ª—å–∫–æ –≤ prod) ========================

  nginx:
    build:
      context: ./docker/nginx
      dockerfile: Dockerfile
    container_name: aisha-nginx-prod
    restart: always
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./ssl_certificate:/etc/nginx/ssl:ro
      - ./logs/nginx:/var/log/nginx
    depends_on:
      - aisha-api
    networks:
      - aisha-prod-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost/health"]
      interval: 30s
      timeout: 10s
      retries: 3

networks:
  aisha-prod-network:
    driver: bridge
    ipam:
      config:
        - subnet: 172.21.0.0/16
```

---

## üöÄ **–§–ê–ó–ê 2: –ú–ù–û–ì–û–≠–¢–ê–ü–ù–´–ï DOCKERFILE**

### **2.1 Dockerfile.bot (dev/prod targets)**

#### **docker/Dockerfile.bot**
```dockerfile
# ======================== BASE STAGE ========================
FROM python:3.11-slim as base

# –°–∏—Å—Ç–µ–º–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
RUN apt-get update && apt-get install -y \
    curl \
    netcat-openbsd \
    && rm -rf /var/lib/apt/lists/* \
    && apt-get clean

# –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
RUN groupadd -r aisha && useradd -r -g aisha aisha

WORKDIR /app

# ======================== BUILDER STAGE ========================
FROM base as builder

RUN apt-get update && apt-get install -y \
    build-essential \
    gcc \
    && rm -rf /var/lib/apt/lists/*

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ requirements –∏ —Å–æ–∑–¥–∞–Ω–∏–µ wheels
COPY requirements.txt .
RUN pip wheel --no-cache-dir --no-deps --wheel-dir /app/wheels -r requirements.txt

# ======================== DEVELOPMENT STAGE ========================
FROM base as development

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ wheels –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞
COPY --from=builder /app/wheels /wheels
COPY requirements.txt .
RUN pip install --no-cache /wheels/*

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ dev –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
COPY requirements-test.txt .
RUN pip install -r requirements-test.txt

# –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
USER aisha

# –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è development
ENV PYTHONPATH=/app
ENV PYTHONUNBUFFERED=1
ENV DEBUG=true
ENV PYTHONDONTWRITEBYTECODE=1

EXPOSE 8000

CMD ["python", "run.py"]

# ======================== PRODUCTION STAGE ========================
FROM base as production

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ wheels –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ (—Ç–æ–ª—å–∫–æ prod –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏)
COPY --from=builder /app/wheels /wheels
COPY requirements.txt .
RUN pip install --no-cache /wheels/* \
    && rm -rf /wheels

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
COPY --chown=aisha:aisha . .

# –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
USER aisha

# –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è production
ENV PYTHONPATH=/app
ENV PYTHONUNBUFFERED=1
ENV DEBUG=false
ENV PYTHONDONTWRITEBYTECODE=1

# Healthcheck
HEALTHCHECK --interval=30s --timeout=30s --start-period=5s --retries=3 \
    CMD python -c "import sys; sys.exit(0)"

# –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
LABEL maintainer="Aisha Bot Team"
LABEL version="2.0"
LABEL environment="production"
LABEL description="Aisha Telegram Bot v2"

EXPOSE 8000

CMD ["python", "run.py"]
```

### **2.2 Dockerfile.api (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ —Å FastAPI)**

#### **docker/Dockerfile.api**
```dockerfile
FROM python:3.11-slim as base

RUN apt-get update && apt-get install -y \
    curl \
    netcat-openbsd \
    && rm -rf /var/lib/apt/lists/*

RUN groupadd -r aisha && useradd -r -g aisha aisha
WORKDIR /app

# ======================== BUILDER STAGE ========================
FROM base as builder

RUN apt-get update && apt-get install -y \
    build-essential \
    && rm -rf /var/lib/apt/lists/*

COPY requirements_api.txt .
RUN pip wheel --no-cache-dir --no-deps --wheel-dir /app/wheels -r requirements_api.txt

# ======================== DEVELOPMENT STAGE ========================
FROM base as development

COPY --from=builder /app/wheels /wheels
COPY requirements_api.txt .
RUN pip install --no-cache /wheels/*

USER aisha

ENV PYTHONPATH=/app
ENV PYTHONUNBUFFERED=1
ENV DEBUG=true

EXPOSE 8000

CMD ["uvicorn", "api_server.main:app", "--host", "0.0.0.0", "--port", "8000", "--reload"]

# ======================== PRODUCTION STAGE ========================
FROM base as production

COPY --from=builder /app/wheels /wheels
COPY requirements_api.txt .
RUN pip install --no-cache /wheels/* && rm -rf /wheels

COPY --chown=aisha:aisha . .
USER aisha

ENV PYTHONPATH=/app
ENV PYTHONUNBUFFERED=1
ENV DEBUG=false

HEALTHCHECK --interval=30s --timeout=30s --start-period=5s --retries=3 \
    CMD curl -f http://localhost:8000/health || exit 1

LABEL maintainer="Aisha Bot Team"
LABEL version="2.0"
LABEL environment="production"

EXPOSE 8000

CMD ["uvicorn", "api_server.main:app", "--host", "0.0.0.0", "--port", "8000", "--workers", "2"]
```

---

## ‚öôÔ∏è **–§–ê–ó–ê 3: –ü–ï–†–ï–ú–ï–ù–ù–´–ï –û–ö–†–£–ñ–ï–ù–ò–Ø**

### **3.1 Development –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**

#### **.env.docker.dev**
```env
# ==================== DEVELOPMENT CONFIGURATION ====================
COMPOSE_PROJECT_NAME=aisha-v2-dev

# ==================== EXTERNAL DATABASE ====================
DATABASE_HOST=localhost
# –ò–ª–∏ IP –∞–¥—Ä–µ—Å, –µ—Å–ª–∏ PostgreSQL –Ω–∞ –¥—Ä—É–≥–æ–π –º–∞—à–∏–Ω–µ
POSTGRES_PASSWORD=your_existing_dev_password

# ==================== EXTERNAL REDIS ====================
REDIS_HOST=localhost
# –ò–ª–∏ IP –∞–¥—Ä–µ—Å, –µ—Å–ª–∏ Redis –Ω–∞ –¥—Ä—É–≥–æ–π –º–∞—à–∏–Ω–µ

# ==================== EXTERNAL MINIO ====================
MINIO_ENDPOINT=localhost:9000
# –ò–ª–∏ IP:PORT, –µ—Å–ª–∏ MinIO –Ω–∞ –¥—Ä—É–≥–æ–π –º–∞—à–∏–Ω–µ
MINIO_ACCESS_KEY=your_existing_minio_access_key
MINIO_SECRET_KEY=your_existing_minio_secret_key
MINIO_SECURE=false
MINIO_BUCKET_AVATARS=aisha-v2-avatars
MINIO_BUCKET_TRANSCRIPTS=aisha-v2-transcripts

# ==================== TELEGRAM BOT ====================
TELEGRAM_BOT_TOKEN=your_development_bot_token_here

# ==================== EXTERNAL APIs ====================
OPENAI_API_KEY=sk-your_openai_key_here
FAL_API_KEY=your_fal_key_here

# ==================== APPLICATION SETTINGS ====================
DEBUG=true
ENVIRONMENT=development
LOG_LEVEL=DEBUG

# ==================== WEBHOOK CONFIGURATION ====================
WEBHOOK_HOST=localhost
WEBHOOK_PORT=8443
FAL_WEBHOOK_URL=http://localhost:8443/api/v1/avatar/status_update

# ==================== FAL AI SETTINGS ====================
FAL_TRAINING_TEST_MODE=true

# ==================== SECURITY ====================
JWT_SECRET_KEY=dev_jwt_secret_key_here
PASSWORD_SALT=dev_salt_here
```

### **3.2 Production –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**

#### **.env.docker.prod**
```env
# ==================== PRODUCTION CONFIGURATION ====================
COMPOSE_PROJECT_NAME=aisha-v2-prod

# ==================== EXTERNAL DATABASE ====================
DATABASE_HOST=192.168.0.10
# –ò–ª–∏ —Ç–æ—Ç –∂–µ —Ö–æ—Å—Ç, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ dev, –µ—Å–ª–∏ –ë–î –æ–±—â–∞—è
POSTGRES_PASSWORD=PRODUCTION_SECURE_PASSWORD_HERE
DATABASE_PORT=5432
DATABASE_NAME=aisha_v2
DATABASE_USER=aisha

# ==================== EXTERNAL REDIS ====================
REDIS_HOST=192.168.0.11
# –ò–ª–∏ —Ç–æ—Ç –∂–µ —Ö–æ—Å—Ç, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ dev
REDIS_PORT=6379
REDIS_PASSWORD=

# ==================== EXTERNAL MINIO ====================
MINIO_ENDPOINT=192.168.0.12:9000
# –ò–ª–∏ —Ç–æ—Ç –∂–µ —Ö–æ—Å—Ç, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ dev
MINIO_ACCESS_KEY=PRODUCTION_MINIO_ACCESS_KEY
MINIO_SECRET_KEY=PRODUCTION_MINIO_SECRET_KEY
MINIO_SECURE=false
MINIO_BUCKET_AVATARS=aisha-v2-avatars
MINIO_BUCKET_TRANSCRIPTS=aisha-v2-transcripts

# ==================== TELEGRAM BOT ====================
TELEGRAM_BOT_TOKEN=YOUR_PRODUCTION_BOT_TOKEN_HERE

# ==================== EXTERNAL APIs ====================
OPENAI_API_KEY=sk-YOUR_PRODUCTION_OPENAI_KEY_HERE
FAL_API_KEY=YOUR_PRODUCTION_FAL_KEY_HERE

# ==================== APPLICATION SETTINGS ====================
DEBUG=false
ENVIRONMENT=production
LOG_LEVEL=INFO

# ==================== WEBHOOK CONFIGURATION ====================
WEBHOOK_HOST=aibots.kz
WEBHOOK_PORT=8443
FAL_WEBHOOK_URL=https://aibots.kz:8443/api/v1/avatar/status_update

# ==================== FAL AI SETTINGS ====================
FAL_TRAINING_TEST_MODE=false

# ==================== SECURITY ====================
JWT_SECRET_KEY=PRODUCTION_JWT_SECRET_KEY_HERE
PASSWORD_SALT=PRODUCTION_PASSWORD_SALT_HERE

# ==================== PERFORMANCE ====================
MAX_FILE_SIZE=1073741824
SESSION_TIMEOUT=3600
API_RATE_LIMIT=60

# ==================== MONITORING ====================
ENABLE_METRICS=true
METRICS_PORT=9090
```

---

## üöÄ **–§–ê–ó–ê 4: –°–ö–†–ò–ü–¢–´ –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–Ø**

### **4.1 –°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤**

#### **docker/scripts/health-check.sh**
```bash
#!/bin/bash

# üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

set -e

# –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
if [ -f .env.docker.dev ]; then
    source .env.docker.dev
elif [ -f .env.docker.prod ]; then
    source .env.docker.prod
else
    echo "‚ùå –§–∞–π–ª –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω"
    exit 1
fi

# –¶–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m'

log() {
    echo -e "${BLUE}[$(date +'%Y-%m-%d %H:%M:%S')]${NC} $1"
}

log_success() {
    echo -e "${GREEN}[$(date +'%Y-%m-%d %H:%M:%S')] ‚úÖ $1${NC}"
}

log_error() {
    echo -e "${RED}[$(date +'%Y-%m-%d %H:%M:%S')] ‚ùå $1${NC}"
}

log_warning() {
    echo -e "${YELLOW}[$(date +'%Y-%m-%d %H:%M:%S')] ‚ö†Ô∏è  $1${NC}"
}

check_service() {
    local service_name=$1
    local host=$2
    local port=$3
    local timeout=${4:-5}
    
    log "–ü—Ä–æ–≤–µ—Ä–∫–∞ $service_name –Ω–∞ $host:$port..."
    
    if timeout $timeout bash -c "nc -z $host $port" 2>/dev/null; then
        log_success "$service_name –¥–æ—Å—Ç—É–ø–µ–Ω"
        return 0
    else
        log_error "$service_name –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ $host:$port"
        return 1
    fi
}

check_minio_api() {
    local endpoint=$1
    local timeout=${2:-10}
    
    log "–ü—Ä–æ–≤–µ—Ä–∫–∞ MinIO API –Ω–∞ $endpoint..."
    
    if timeout $timeout bash -c "curl -s -f http://$endpoint/minio/health/live" >/dev/null 2>&1; then
        log_success "MinIO API –¥–æ—Å—Ç—É–ø–µ–Ω"
        return 0
    else
        log_warning "MinIO API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –ø—Ä–æ–≤–µ—Ä—è—é TCP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ..."
        local host=$(echo $endpoint | cut -d: -f1)
        local port=$(echo $endpoint | cut -d: -f2)
        check_service "MinIO TCP" $host $port
        return $?
    fi
}

main() {
    log "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –¥–ª—è Aisha Bot v2..."
    
    local all_ok=true
    
    # PostgreSQL
    if ! check_service "PostgreSQL" "$DATABASE_HOST" "5432"; then
        all_ok=false
    fi
    
    # Redis
    if ! check_service "Redis" "$REDIS_HOST" "6379"; then
        all_ok=false
    fi
    
    # MinIO
    if ! check_minio_api "$MINIO_ENDPOINT"; then
        all_ok=false
    fi
    
    echo ""
    if [ "$all_ok" = true ]; then
        log_success "üéâ –í—Å–µ –≤–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã –¥–æ—Å—Ç—É–ø–Ω—ã! –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è."
        exit 0
    else
        log_error "‚ùå –ù–µ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –¥–æ—Å—Ç—É–ø–Ω—ã. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–∏—Å–æ–≤."
        echo ""
        echo "üìã –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:"
        echo "  - PostgreSQL: psql -h $DATABASE_HOST -p 5432 -U aisha -d aisha_v2"
        echo "  - Redis: redis-cli -h $REDIS_HOST -p 6379 ping"
        echo "  - MinIO: curl http://$MINIO_ENDPOINT/minio/health/live"
        exit 1
    fi
}

main "$@"
```

### **4.2 –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è**

#### **docker/scripts/deploy.sh**
```bash
#!/bin/bash

# üöÄ –°–∫—Ä–∏–ø—Ç —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è Aisha Bot v2 (—Ç–æ–ª—å–∫–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)

set -e

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
DEPLOY_DIR="/opt/aisha-v2"
BACKUP_DIR="/opt/backups/aisha-v2"
SERVICE_NAME="aisha-bot"
COMPOSE_FILE="${COMPOSE_FILE:-docker-compose.prod.yml}"

# –¶–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m'

log() {
    echo -e "${BLUE}[$(date +'%Y-%m-%d %H:%M:%S')]${NC} $1"
}

log_success() {
    echo -e "${GREEN}[$(date +'%Y-%m-%d %H:%M:%S')] ‚úÖ $1${NC}"
}

log_warning() {
    echo -e "${YELLOW}[$(date +'%Y-%m-%d %H:%M:%S')] ‚ö†Ô∏è  $1${NC}"
}

log_error() {
    echo -e "${RED}[$(date +'%Y-%m-%d %H:%M:%S')] ‚ùå $1${NC}"
}

check_external_services() {
    log "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤..."
    
    if ! ./docker/scripts/health-check.sh; then
        log_error "–í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è."
        exit 1
    fi
    
    log_success "–í—Å–µ –≤–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã –¥–æ—Å—Ç—É–ø–Ω—ã"
}

backup_current() {
    if [ -d "$DEPLOY_DIR" ]; then
        log "üì¶ –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞ —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏..."
        
        mkdir -p "$BACKUP_DIR"
        
        local backup_name="aisha-v2-$(date +%Y%m%d-%H%M%S).tar.gz"
        
        if tar -czf "$BACKUP_DIR/$backup_name" -C "$DEPLOY_DIR" .; then
            log_success "–ë—ç–∫–∞–ø —Å–æ–∑–¥–∞–Ω: $backup_name"
            
            # –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –±—ç–∫–∞–ø–æ–≤ (–æ—Å—Ç–∞–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5)
            cd "$BACKUP_DIR"
            ls -t aisha-v2-*.tar.gz | tail -n +6 | xargs -r rm
            log "üßπ –°—Ç–∞—Ä—ã–µ –±—ç–∫–∞–ø—ã –æ—á–∏—â–µ–Ω—ã"
        else
            log_warning "–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º..."
        fi
    fi
}

validate_environment() {
    log "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏..."
    
    local env_file=".env.docker.prod"
    if [ "$ENVIRONMENT" = "development" ]; then
        env_file=".env.docker.dev"
        COMPOSE_FILE="docker-compose.yml"
    fi
    
    if [ ! -f "$DEPLOY_DIR/$env_file" ]; then
        log_error "–§–∞–π–ª $env_file –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ $DEPLOY_DIR"
        exit 1
    fi
    
    if [ ! -f "$DEPLOY_DIR/$COMPOSE_FILE" ]; then
        log_error "–§–∞–π–ª $COMPOSE_FILE –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ $DEPLOY_DIR"
        exit 1
    fi
    
    log_success "–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤–∞–ª–∏–¥–Ω–∞"
}

deploy_application() {
    log "üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π..."
    
    cd "$DEPLOY_DIR"
    
    # –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
    if docker-compose -f "$COMPOSE_FILE" ps -q 2>/dev/null | grep -q .; then
        log "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤..."
        docker-compose -f "$COMPOSE_FILE" down
    fi
    
    # –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –æ–±—Ä–∞–∑–æ–≤
    log "üßπ –û—á–∏—Å—Ç–∫–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –æ–±—Ä–∞–∑–æ–≤..."
    docker image prune -f
    
    # –°–±–æ—Ä–∫–∞ –Ω–æ–≤—ã—Ö –æ–±—Ä–∞–∑–æ–≤
    log "üî® –°–±–æ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–æ–≤..."
    if ! docker-compose -f "$COMPOSE_FILE" build --no-cache; then
        log_error "–û—à–∏–±–∫–∞ —Å–±–æ—Ä–∫–∏ –æ–±—Ä–∞–∑–æ–≤"
        exit 1
    fi
    
    # –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
    log "üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π..."
    if ! docker-compose -f "$COMPOSE_FILE" up -d; then
        log_error "–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π"
        exit 1
    fi
    
    # –û–∂–∏–¥–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–æ–≤
    log "‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π (60 —Å–µ–∫—É–Ω–¥)..."
    sleep 60
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
    local failed_containers=$(docker-compose -f "$COMPOSE_FILE" ps --filter "status=exited" --format "table {{.Name}}")
    
    if [ -n "$failed_containers" ] && [ "$failed_containers" != "NAME" ]; then
        log_error "–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –Ω–µ –∑–∞–ø—É—Å—Ç–∏–ª–∏—Å—å:"
        echo "$failed_containers"
        log "üìã –õ–æ–≥–∏ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:"
        docker-compose -f "$COMPOSE_FILE" logs --tail=50
        exit 1
    fi
    
    log_success "–í—Å–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∑–∞–ø—É—â–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ"
}

run_health_checks() {
    log "üè• –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π..."
    
    local health_ok=true
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ API —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞
    for i in {1..10}; do
        if curl -f -s "http://localhost:8443/health" >/dev/null 2>&1; then
            log_success "API —Å–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç"
            break
        else
            if [ $i -eq 10 ]; then
                log_error "API —Å–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –ø–æ—Å–ª–µ 10 –ø–æ–ø—ã—Ç–æ–∫"
                health_ok=false
            else
                log "üîÑ –ü–æ–ø—ã—Ç–∫–∞ $i/10: API —Å–µ—Ä–≤–µ—Ä –Ω–µ –≥–æ—Ç–æ–≤, –∂–¥–µ–º..."
                sleep 5
            fi
        fi
    done
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ Nginx (—Ç–æ–ª—å–∫–æ –≤ production)
    if [ "$COMPOSE_FILE" = "docker-compose.prod.yml" ]; then
        if curl -f -s "http://localhost/health" >/dev/null 2>&1; then
            log_success "Nginx —Ä–∞–±–æ—Ç–∞–µ—Ç"
        else
            log_error "Nginx –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç"
            health_ok=false
        fi
    fi
    
    if [ "$health_ok" = false ]; then
        log_error "–ü—Ä–æ–≤–µ—Ä–∫–∏ –∑–¥–æ—Ä–æ–≤—å—è –Ω–µ –ø—Ä–æ—à–ª–∏"
        log "üìã –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π:"
        docker-compose -f "$COMPOSE_FILE" logs --tail=50
        exit 1
    fi
    
    log_success "–í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–¥–æ—Ä–æ–≤—å—è –ø—Ä–æ—à–ª–∏"
}

setup_systemd() {
    if [ "$COMPOSE_FILE" = "docker-compose.prod.yml" ]; then
        log "‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ systemd —Å–µ—Ä–≤–∏—Å–∞..."
        
        sudo tee /etc/systemd/system/aisha-bot.service > /dev/null <<EOF
[Unit]
Description=Aisha Bot v2 Production
Documentation=https://github.com/your-org/aisha-bot-v2
Requires=docker.service
After=docker.service network-online.target
Wants=network-online.target

[Service]
Type=oneshot
RemainAfterExit=yes
User=root
WorkingDirectory=$DEPLOY_DIR
Environment=COMPOSE_PROJECT_NAME=aisha-v2-prod
ExecStartPre=/usr/bin/docker-compose -f $COMPOSE_FILE down
ExecStart=/usr/bin/docker-compose -f $COMPOSE_FILE up -d
ExecStop=/usr/bin/docker-compose -f $COMPOSE_FILE down
ExecReload=/usr/bin/docker-compose -f $COMPOSE_FILE restart
TimeoutStartSec=300
TimeoutStopSec=60
Restart=on-failure
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF

        sudo systemctl daemon-reload
        sudo systemctl enable aisha-bot
        
        log_success "Systemd —Å–µ—Ä–≤–∏—Å –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ –≤–∫–ª—é—á–µ–Ω"
    else
        log "‚è≠Ô∏è Systemd —Å–µ—Ä–≤–∏—Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è production"
    fi
}

show_status() {
    log "üìä –°—Ç–∞—Ç—É—Å —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è:"
    echo ""
    echo "üê≥ –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:"
    docker-compose -f "$COMPOSE_FILE" ps
    echo ""
    echo "üìà –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤:"
    docker stats --no-stream --format "table {{.Container}}\t{{.CPUPerc}}\t{{.MemUsage}}\t{{.MemPerc}}"
    echo ""
    echo "üîó –î–æ—Å—Ç—É–ø–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:"
    echo "  - API: http://localhost:8443/health"
    if [ "$COMPOSE_FILE" = "docker-compose.prod.yml" ]; then
        echo "  - Nginx: http://localhost/health"
    fi
    echo ""
    echo "üìù –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:"
    echo "  - –õ–æ–≥–∏: docker-compose -f $COMPOSE_FILE logs -f"
    if [ "$COMPOSE_FILE" = "docker-compose.prod.yml" ]; then
        echo "  - –°—Ç–∞—Ç—É—Å: sudo systemctl status aisha-bot"
        echo "  - –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫: sudo systemctl restart aisha-bot"
    fi
    echo "  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–î: ./docker/scripts/health-check.sh"
}

# –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
main() {
    log "üèÅ –ù–∞—á–∏–Ω–∞–µ–º —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ Aisha Bot v2 –Ω–∞ $(hostname)..."
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤
    if [ "$EUID" -eq 0 ]; then
        log_error "–ù–µ –∑–∞–ø—É—Å–∫–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –æ—Ç root. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ sudo —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π."
        exit 1
    fi
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ Docker
    if ! command -v docker >/dev/null 2>&1; then
        log_error "Docker –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
        exit 1
    fi
    
    if ! command -v docker-compose >/dev/null 2>&1; then
        log_error "Docker Compose –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
        exit 1
    fi
    
    # –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
    sudo mkdir -p "$DEPLOY_DIR"
    sudo chown $USER:$USER "$DEPLOY_DIR"
    
    # –û—Å–Ω–æ–≤–Ω—ã–µ —ç—Ç–∞–ø—ã
    check_external_services
    backup_current
    validate_environment
    deploy_application
    run_health_checks
    setup_systemd
    show_status
    
    log_success "üéâ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ!"
}

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤
case "${1:-}" in
    "health")
        check_external_services
        run_health_checks
        ;;
    "status")
        show_status
        ;;
    "dev")
        export ENVIRONMENT="development"
        export COMPOSE_FILE="docker-compose.yml"
        main "$@"
        ;;
    *)
        main "$@"
        ;;
esac
```

---

## üìã **–ü–õ–ê–ù –í–´–ü–û–õ–ù–ï–ù–ò–Ø**

### **–ù–µ–¥–µ–ª—è 1: –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**
- [ ] **–î–µ–Ω—å 1:** –£–¥–∞–ª–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ë–î –∏–∑ docker-compose.yml
- [ ] **–î–µ–Ω—å 2:** –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º —Å–µ—Ä–≤–∏—Å–∞–º –≤ dev
- [ ] **–î–µ–Ω—å 3:** –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ development —Å—Ä–µ–¥—ã —Å –≤–Ω–µ—à–Ω–∏–º–∏ –ë–î
- [ ] **–î–µ–Ω—å 4:** –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- [ ] **–î–µ–Ω—å 5:** –û—Ç–ª–∞–¥–∫–∞ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è dev –ø—Ä–æ—Ü–µ—Å—Å–æ–≤

### **–ù–µ–¥–µ–ª—è 2: Production –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å**
- [ ] **–î–µ–Ω—å 1:** –ù–∞—Å—Ç—Ä–æ–π–∫–∞ docker-compose.prod.yml (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ nginx)
- [ ] **–î–µ–Ω—å 2:** –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è production –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- [ ] **–î–µ–Ω—å 3:** –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
- [ ] **–î–µ–Ω—å 4:** –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ production –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ª–æ–∫–∞–ª—å–Ω–æ
- [ ] **–î–µ–Ω—å 5:** –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –¥–ª—è –¥–µ–ø–ª–æ—è

### **–ù–µ–¥–µ–ª—è 3: –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ**
- [ ] **–î–µ–Ω—å 1:** –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ü–µ–ª–µ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
- [ ] **–î–µ–Ω—å 2:** –ü–µ—Ä–≤–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∏ –æ—Ç–ª–∞–¥–∫–∞ connectivity
- [ ] **–î–µ–Ω—å 3:** –ù–∞—Å—Ç—Ä–æ–π–∫–∞ systemd —Å–µ—Ä–≤–∏—Å–æ–≤ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- [ ] **–î–µ–Ω—å 4:** –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- [ ] **–î–µ–Ω—å 5:** –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –ø–µ—Ä–µ–¥–∞—á–∞ –∑–Ω–∞–Ω–∏–π

---

## üõ†Ô∏è **–ò–ù–°–¢–†–£–ö–¶–ò–ò –ü–û –ó–ê–ü–£–°–ö–£**

### **Development (WSL2)**
```bash
# 1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—â–µ–Ω—ã
# PostgreSQL, Redis, MinIO –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã

# 2. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
cp env.docker.template .env.docker.dev
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env.docker.dev —Å –∞–¥—Ä–µ—Å–∞–º–∏ –≤–∞—à–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤:
# DATABASE_HOST=localhost (–∏–ª–∏ IP —Å–µ—Ä–≤–µ—Ä–∞ —Å PostgreSQL)
# REDIS_HOST=localhost (–∏–ª–∏ IP —Å–µ—Ä–≤–µ—Ä–∞ —Å Redis)
# MINIO_ENDPOINT=localhost:9000 (–∏–ª–∏ IP:PORT —Å–µ—Ä–≤–µ—Ä–∞ —Å MinIO)

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
chmod +x docker/scripts/health-check.sh
./docker/scripts/health-check.sh

# 4. –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
docker-compose up -d

# 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
docker-compose ps

# 6. –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker-compose logs -f aisha-bot

# 7. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î (–ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ)
docker-compose exec aisha-bot alembic upgrade head
```

### **Production —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ**
```bash
# 1. –ù–∞ —Ü–µ–ª–µ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ
sudo mkdir -p /opt/aisha-v2
sudo chown $USER:$USER /opt/aisha-v2
cd /opt/aisha-v2

# 2. –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–¥–∞ (git clone –∏–ª–∏ scp)
git clone <repository-url> .

# 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è production
cp env.docker.template .env.docker.prod
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env.docker.prod —Å:
# - IP –∞–¥—Ä–µ—Å–∞–º–∏ –≤–∞—à–∏—Ö –ë–î —Å–µ—Ä–≤–∏—Å–æ–≤
# - Production —Ç–æ–∫–µ–Ω–∞–º–∏ –∏ –∫–ª—é—á–∞–º–∏
# - SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
chmod +x docker/scripts/health-check.sh
./docker/scripts/health-check.sh

# 5. –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
chmod +x docker/scripts/deploy.sh
./docker/scripts/deploy.sh

# 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
sudo systemctl status aisha-bot
docker-compose -f docker-compose.prod.yml ps
```

### **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
./docker/scripts/health-check.sh

# –°—Ç–∞—Ç—É—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
docker-compose ps  # dev
docker-compose -f docker-compose.prod.yml ps  # prod

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
docker-compose restart  # dev
sudo systemctl restart aisha-bot  # prod

# –õ–æ–≥–∏
docker-compose logs -f  # dev
docker-compose -f docker-compose.prod.yml logs -f  # prod
```

---

## üéØ **–ö–†–ò–¢–ï–†–ò–ò –£–°–ü–ï–•–ê**

### **Development –º–µ—Ç—Ä–∏–∫–∏**
- [ ] **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è** –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –∑–∞ < 1 –º–∏–Ω—É—Ç—É –±–µ–∑ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ë–î
- [ ] **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –≤–Ω–µ—à–Ω–∏–º –ë–î** —Å—Ç–∞–±–∏–ª—å–Ω–æ–µ –∏ –±—ã—Å—Ç—Ä–æ–µ
- [ ] **Hot reload** —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–¥–∞
- [ ] **–í—Å–µ —Ç–µ—Å—Ç—ã** –ø—Ä–æ—Ö–æ–¥—è—Ç —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏
- [ ] **–°–∫—Ä–∏–ø—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏** –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä—É—é—Ç –ø—Ä–æ–±–ª–µ–º—ã

### **Production –º–µ—Ç—Ä–∏–∫–∏**
- [ ] **–í—Ä–µ–º—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è** < 3 –º–∏–Ω—É—Ç—ã (–±–µ–∑ –ë–î —Å–µ—Ä–≤–∏—Å–æ–≤)
- [ ] **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î** —Å—Ç–∞–±–∏–ª—å–Ω–æ–µ –≤–æ –≤—Å–µ—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è—Ö
- [ ] **Zero downtime** –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ systemd
- [ ] **Healthcheck endpoints** –æ—Ç–≤–µ—á–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] **SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã** —Ä–∞–±–æ—Ç–∞—é—Ç (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)

### **–û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏**
- [ ] **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π restart** –ø—Ä–∏ —Å–±–æ—è—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- [ ] **–õ–æ–≥–∏** —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –¥–æ—Å—Ç—É–ø–Ω—ã
- [ ] **–ë—ç–∫–∞–ø—ã** —Å–æ–∑–¥–∞—é—Ç—Å—è –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ–º
- [ ] **Monitoring** –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- [ ] **–ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏–µ** –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –º–µ–∂–¥—É dev –∏ prod

---

**üöÄ Unified Docker –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞!**
*–ò—Å–ø–æ–ª—å–∑—É–µ–º –≤–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã –≤–µ–∑–¥–µ ‚Üí –ø—Ä–æ—Å—Ç–æ—Ç–∞ –∏ –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏–µ ‚Üí –±—ã—Å—Ç—Ä–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ* 
# üöÄ –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã –æ–±—É—á–µ–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–æ–≤

## üìã –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

‚úÖ **–ê–≤—Ç–æ–≤—ã–±–æ—Ä API –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç–∏–ª—è –∞–≤–∞—Ç–∞—Ä–∞:**
- üé≠ **–ü–æ—Ä—Ç—Ä–µ—Ç–Ω—ã–π —Å—Ç–∏–ª—å** ‚Üí `fal-ai/flux-lora-portrait-trainer`
- üé® **–•—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Å—Ç–∏–ª—å** ‚Üí `fal-ai/flux-pro-trainer`

‚úÖ **–¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º** - –ø–æ–ª–Ω–∞—è –∏–º–∏—Ç–∞—Ü–∏—è –±–µ–∑ –∑–∞—Ç—Ä–∞—Ç –Ω–∞ FAL AI

‚úÖ **Webhook —Å–∏—Å—Ç–µ–º–∞** –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∞–≤–∞—Ç–∞—Ä–∞

‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –≤ Telegram

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r requirements.txt
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

```env
# –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
TELEGRAM_TOKEN=your_telegram_bot_token
FAL_API_KEY=your_fal_api_key

# –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –Ω–∞—á–∞–ª–∞)
AVATAR_TEST_MODE=true
FAL_ENABLE_WEBHOOK_SIMULATION=true
FAL_MOCK_TRAINING_DURATION=30

# Webhook URL (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à –¥–æ–º–µ–Ω)
FAL_WEBHOOK_URL=https://yourdomain.com/webhook/fal/status
```

### 3. –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã

**–¢–µ—Ä–º–∏–Ω–∞–ª 1 - Telegram –±–æ—Ç:**
```bash
python -m app.main
```

**–¢–µ—Ä–º–∏–Ω–∞–ª 2 - API —Å–µ—Ä–≤–µ—Ä –¥–ª—è webhook:**
```bash
python run_api_server.py
```

### 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
python test_avatar_training_system.py
```

## üéØ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –í—ã–±–æ—Ä API

```python
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç training_type
if training_type == "portrait":
    # –î–ª—è —Å–µ–ª—Ñ–∏ –∏ –ø–æ—Ä—Ç—Ä–µ—Ç–æ–≤ ‚Üí –±—ã—Å—Ç—Ä–µ–µ –∏ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–µ–µ
    endpoint = "fal-ai/flux-lora-portrait-trainer"
else:
    # –î–ª—è —Å—Ç–∏–ª–µ–π –∏ –æ–±—ä–µ–∫—Ç–æ–≤ ‚Üí —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–µ–µ
    endpoint = "fal-ai/flux-pro-trainer"
```

### –°—Ç–∞—Ç—É—Å—ã –∞–≤–∞—Ç–∞—Ä–∞

1. **–û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ –æ–±—É—á–µ–Ω–∏–µ** ‚Üí —Å—Ç–∞—Ç—É—Å `TRAINING`
2. **–ü—Ä–æ—Ü–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è** ‚Üí –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
3. **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ** ‚Üí —Å—Ç–∞—Ç—É—Å `COMPLETED` + —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

–ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –æ–±—É—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ:

```
üéâ –í–∞—à –∞–≤–∞—Ç–∞—Ä –≥–æ—Ç–æ–≤!

üé≠ **–ú–æ–π –ê–≤–∞—Ç–∞—Ä** (–ü–æ—Ä—Ç—Ä–µ—Ç–Ω—ã–π —Å—Ç–∏–ª—å)
‚úÖ –û–±—É—á–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ

–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–≤–∞—Ç–∞—Ä –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π!
```

## üß™ –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º

–ü—Ä–∏ `AVATAR_TEST_MODE=true`:

- ‚ùå –†–µ–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ FAL AI **–ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è**
- ‚úÖ –ü–æ–ª–Ω–∞—è –∏–º–∏—Ç–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –æ–±—É—á–µ–Ω–∏—è
- ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ webhook –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- ‚úÖ –ù–µ—Ç –∑–∞—Ç—Ä–∞—Ç –Ω–∞ API

**–õ–æ–≥–∏ –≤ —Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ:**
```
üß™ –¢–ï–°–¢ –†–ï–ñ–ò–ú: –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É –Ω–∞ –æ–±—É—á–µ–Ω–∏–µ –¥–ª—è –∞–≤–∞—Ç–∞—Ä–∞ abc123, —Ç–∏–ø: portrait
üß™ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π request_id: test_abc123_def456
üß™ –ò–º–∏—Ç–∞—Ü–∏—è –æ–±—É—á–µ–Ω–∏—è portrait, –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 30 —Å–µ–∫—É–Ω–¥
```

## üì° Webhook endpoints

- **Health check:** `GET http://localhost:8000/health`
- **FAL webhook:** `POST http://localhost:8000/webhook/fal/status`
- **API info:** `GET http://localhost:8000/`

## üîß Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: Webhook –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ API —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω
curl http://localhost:8000/health

# –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ ngrok
ngrok http 8000
```

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∏ FAL API
```bash
# –í–∫–ª—é—á–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º
export AVATAR_TEST_MODE=true

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API –∫–ª—é—á
echo $FAL_API_KEY
```

### –ü—Ä–æ–±–ª–µ–º–∞: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞
echo $TELEGRAM_TOKEN

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ API —Å–µ—Ä–≤–µ—Ä–∞
tail -f app_test.log
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–∏—Å—Ç–µ–º—ã
curl http://localhost:8000/health

# –õ–æ–≥–∏ Telegram –±–æ—Ç–∞
tail -f app_test.log

# –õ–æ–≥–∏ API —Å–µ—Ä–≤–µ—Ä–∞
# –°–º–æ—Ç—Ä–∏—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª–∏ –≥–¥–µ –∑–∞–ø—É—â–µ–Ω run_api_server.py
```

## üéâ –ì–æ—Ç–æ–≤–æ!

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é. –í —Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Å—å workflow –±–µ–∑ –∑–∞—Ç—Ä–∞—Ç –Ω–∞ FAL AI.

–î–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `AVATAR_TEST_MODE=false`
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π `FAL_WEBHOOK_URL`
3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å –∫—Ä–µ–¥–∏—Ç—ã –Ω–∞ FAL AI 
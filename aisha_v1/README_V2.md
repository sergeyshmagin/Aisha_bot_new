# Telegram AI Bot ‚Äî Highload Edition

## –û–ø–∏—Å–∞–Ω–∏–µ

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π Telegram-–±–æ—Ç –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∞—É–¥–∏–æ- –∏ —Ñ–æ—Ç–æ—Ñ–∞–π–ª–æ–≤ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏, —É–ª—É—á—à–µ–Ω–∏—è —Ñ–æ—Ç–æ (GFPGAN), –∏—Å—Ç–æ—Ä–∏–∏ —Ñ–∞–π–ª–æ–≤ –∏ –≥–∏–±–∫–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π –¥–ª—è –≤—ã—Å–æ–∫–∏—Ö –Ω–∞–≥—Ä—É–∑–æ–∫.

- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (`aiofiles`)
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫ –≤–Ω–µ—à–Ω–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤** (`ffmpeg`, `ffprobe`) —á–µ—Ä–µ–∑ `asyncio.create_subprocess_exec`
- **–ì–∏–±–∫–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** —á–µ—Ä–µ–∑ state_manager (–≥–æ—Ç–æ–≤–æ –∫ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ Redis)
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Ä–µ–∂–∏–º—ã –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
- **PEP8, docstring, —á–∏—Å—Ç—ã–π –∫–æ–¥**

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.9+
- ffmpeg (—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ —Å–∏—Å—Ç–µ–º–µ)
- [aiofiles](https://pypi.org/project/aiofiles/)
- [telebot](https://pypi.org/project/pyTelegramBotAPI/) (–∏–ª–∏ aiogram, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
- aiohttp
- dotenv
- (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) Redis –¥–ª—è state_manager –≤ –±—É–¥—É—â–µ–º

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
   ```bash
   pip install -r requirements.txt
   ```
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ ffmpeg (Linux: `sudo apt install ffmpeg`, Windows: [—Å–∫–∞—á–∞—Ç—å](https://ffmpeg.org/download.html))
3. –°–æ–∑–¥–∞–π—Ç–µ `.env` —Å —Ç–æ–∫–µ–Ω–æ–º Telegram –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏:
   ```env
   TELEGRAM_TOKEN=...  # –≤–∞—à —Ç–æ–∫–µ–Ω
   OPENAI_API_KEY=...  # –¥–ª—è Whisper
   STORAGE_DIR=storage
   ```
4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞:
   ```bash
   python -m frontend_bot.main
   ```

## –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –∞—É–¥–∏–æ** (mp3, ogg, wav –∏ –¥—Ä.) —á–µ—Ä–µ–∑ OpenAI Whisper
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–æ–≤ (.txt)**
- **–£–ª—É—á—à–µ–Ω–∏–µ —Ñ–æ—Ç–æ —á–µ—Ä–µ–∑ GFPGAN** (Docker backend)
- **–ò—Å—Ç–æ—Ä–∏—è —Ñ–∞–π–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
- **–ì–∏–±–∫–æ–µ –º–µ–Ω—é –∏ —Ä–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã** (state_manager)
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤ –∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤**

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- –í—Å–µ I/O-–æ–ø–µ—Ä–∞—Ü–∏–∏ (—á—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å —Ñ–∞–π–ª–æ–≤) ‚Äî –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ
- –í—Å–µ –≤—ã–∑–æ–≤—ã ffmpeg/ffprobe ‚Äî –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ, –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç event loop
- –°–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ä–µ–∂–∏–º—ã) —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω—ã —á–µ—Ä–µ–∑ state_manager (dict, –≥–æ—Ç–æ–≤–æ –∫ Redis)
- –õ–µ–≥–∫–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–æ—Ä–∫–µ—Ä–æ–≤/—Å–µ—Ä–≤–µ—Ä–æ–≤
- –ì–æ—Ç–æ–≤ –∫ highload: –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç event loop –¥–∞–∂–µ –ø—Ä–∏ –º–∞—Å—Å–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–µ

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è highload

- –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Redis –¥–ª—è state_manager (–∑–∞–º–µ–Ω–∏—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –≤ `services/state_manager.py`)
- –ó–∞–ø—É—Å–∫–∞–π—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–æ—Ä–∫–µ—Ä–æ–≤ —á–µ—Ä–µ–∑ supervisor/systemd
- –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ ffmpeg –∏ I/O
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–π backend –¥–ª—è GFPGAN (Docker)

## –ü—Ä–∏–º–µ—Ä —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ä–µ–∂–∏–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–û–∑–≤—É—á–∏—Ç—å —Ç–µ–∫—Å—Ç"):
1. –î–æ–±–∞–≤—å—Ç–µ –∫–Ω–æ–ø–∫—É –≤ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
2. –í state_manager –¥–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π —Ä–µ–∂–∏–º
3. –†–µ–∞–ª–∏–∑—É–π—Ç–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –Ω—É–∂–Ω–æ–≥–æ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞/—Ç–µ–∫—Å—Ç–∞

## –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

- –í–æ–ø—Ä–æ—Å—ã –∏ –±–∞–≥–∏ ‚Äî —á–µ—Ä–µ–∑ Issues –Ω–∞ GitHub
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ –¥–æ—Ä–∞–±–æ—Ç–∫–∞ ‚Äî –ø–æ –∑–∞–ø—Ä–æ—Å—É 

@bot.message_handler(func=lambda m: m.text == "üìÑ –¢–µ–∫—Å—Ç–æ–≤—ã–π —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç")
async def text_instruction(message: Message):
    print("DEBUG: text_instruction called")
    ... 

## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ GFPGAN docker-–æ–±—Ä–∞–∑–∞ –∏ –ø—É—Ç–∏ –∫ —Å–∫—Ä–∏–ø—Ç—É

–í–µ—Ä—Å–∏—è docker-–æ–±—Ä–∞–∑–∞ –∏ –ø—É—Ç—å –∫ —Å–∫—Ä–∏–ø—Ç—É GFPGAN –∑–∞–¥–∞—é—Ç—Å—è –≤ —Ñ–∞–π–ª–µ `backend_api/app/config.py` –∏–ª–∏ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

- `GFPGAN_DOCKER_IMAGE` ‚Äî —Ç–µ–≥ docker-–æ–±—Ä–∞–∑–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é soulteary/docker-gfpgan:v1.4.0)
- `GFPGAN_SCRIPT_PATH` ‚Äî –ø—É—Ç—å –∫ —Å–∫—Ä–∏–ø—Ç—É –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é /app/inference_gfpgan.py)

### –ö–∞–∫ –æ–±–Ω–æ–≤–∏—Ç—å –≤–µ—Ä—Å–∏—é GFPGAN:
1. –ò–∑–º–µ–Ω–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `GFPGAN_DOCKER_IMAGE` –Ω–∞ –Ω—É–∂–Ω—ã–π —Ç–µ–≥ (–Ω–∞–ø—Ä–∏–º–µ—Ä, soulteary/docker-gfpgan:v1.4.0) –≤ `.env` –∏–ª–∏ –≤ `config.py`.
2. –ï—Å–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ–±—Ä–∞–∑–∞ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å ‚Äî –∏–∑–º–µ–Ω–∏ `GFPGAN_SCRIPT_PATH` –Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –ø—É—Ç—å (—Å–º. –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –∫ –æ–±—Ä–∞–∑—É).
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ backend.

**–í–∞–∂–Ω–æ:** –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ–≥–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, v1.4.0). –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–µ–≥–æ–≤ —Å–º–æ—Ç—Ä–∏ –Ω–∞ https://hub.docker.com/r/soulteary/docker-gfpgan/tags. –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å latest, –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –æ–±—Ä–∞–∑–∞ –≤–æ–∑–º–æ–∂–Ω—ã –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω—ã–π —Ç–µ–≥. 
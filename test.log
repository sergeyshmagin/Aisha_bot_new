============================= test session starts =============================
platform win32 -- Python 3.13.3, pytest-8.3.5, pluggy-1.5.0 -- C:\dev\Aisha_bot_new\venv\Scripts\python.exe
cachedir: .pytest_cache
rootdir: C:\dev\Aisha_bot_new
configfile: pytest.ini
testpaths: tests
plugins: anyio-4.9.0, asyncio-0.26.0, cov-6.1.1
asyncio: mode=Mode.AUTO, asyncio_default_fixture_loop_scope=function, asyncio_default_test_loop_scope=function
collecting ... collected 79 items

tests/handlers/test_avatar_handlers.py::test_handle_avatar_photo_success 
------------------------------- live log setup --------------------------------
2025-05-16 07:22:40 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:40 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)
ERROR                                                                    [  1%]
------------------------------ live log teardown ------------------------------
2025-05-16 07:22:40 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:40 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)

tests/handlers/test_avatar_handlers.py::test_handle_avatar_photo_validation_error 
------------------------------- live log setup --------------------------------
2025-05-16 07:22:40 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:40 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)
ERROR                                                                    [  2%]
------------------------------ live log teardown ------------------------------
2025-05-16 07:22:40 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:40 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)

tests/handlers/test_avatar_handlers.py::test_handle_avatar_photo_next_success 
------------------------------- live log setup --------------------------------
2025-05-16 07:22:41 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:41 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)
ERROR                                                                    [  3%]
------------------------------ live log teardown ------------------------------
2025-05-16 07:22:41 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:41 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)

tests/handlers/test_avatar_handlers.py::test_handle_avatar_photo_next_not_enough_photos 
------------------------------- live log setup --------------------------------
2025-05-16 07:22:41 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:41 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)
ERROR                                                                    [  5%]
------------------------------ live log teardown ------------------------------
2025-05-16 07:22:41 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:41 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)

tests/handlers/test_avatar_handlers.py::test_handle_avatar_gender_success 
------------------------------- live log setup --------------------------------
2025-05-16 07:22:41 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:41 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)
ERROR                                                                    [  6%]
------------------------------ live log teardown ------------------------------
2025-05-16 07:22:41 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:41 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)

tests/handlers/test_avatar_handlers.py::test_handle_avatar_gender_validation_error 
------------------------------- live log setup --------------------------------
2025-05-16 07:22:41 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:41 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)
ERROR                                                                    [  7%]
------------------------------ live log teardown ------------------------------
2025-05-16 07:22:41 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:41 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)

tests/handlers/test_avatar_handlers.py::test_handle_avatar_name_success 
------------------------------- live log setup --------------------------------
2025-05-16 07:22:41 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:41 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)
ERROR                                                                    [  8%]
------------------------------ live log teardown ------------------------------
2025-05-16 07:22:42 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:42 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)

tests/handlers/test_avatar_handlers.py::test_handle_avatar_name_validation_error 
------------------------------- live log setup --------------------------------
2025-05-16 07:22:42 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:42 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)
ERROR                                                                    [ 10%]
------------------------------ live log teardown ------------------------------
2025-05-16 07:22:42 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:42 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)

tests/handlers/test_avatar_handlers.py::test_handle_avatar_confirm_success 
------------------------------- live log setup --------------------------------
2025-05-16 07:22:42 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:42 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)
ERROR                                                                    [ 11%]
------------------------------ live log teardown ------------------------------
2025-05-16 07:22:42 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:42 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)

tests/handlers/test_avatar_handlers.py::test_handle_avatar_confirm_validation_error 
------------------------------- live log setup --------------------------------
2025-05-16 07:22:42 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:42 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)
ERROR                                                                    [ 12%]
------------------------------ live log teardown ------------------------------
2025-05-16 07:22:42 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:42 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)

tests/handlers/test_business_assistant_menu_transitions.py::test_main_menu_to_business_assistant 
------------------------------- live log setup --------------------------------
2025-05-16 07:22:42 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:42 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)
ERROR                                                                    [ 13%]
------------------------------ live log teardown ------------------------------
2025-05-16 07:22:42 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:42 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)

tests/handlers/test_business_assistant_menu_transitions.py::test_business_assistant_to_history 
------------------------------- live log setup --------------------------------
2025-05-16 07:22:42 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:42 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)
ERROR                                                                    [ 15%]
------------------------------ live log teardown ------------------------------
2025-05-16 07:22:42 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:42 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)

tests/handlers/test_business_assistant_menu_transitions.py::test_business_assistant_to_new_dialog 
------------------------------- live log setup --------------------------------
2025-05-16 07:22:42 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:42 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)
ERROR                                                                    [ 16%]
------------------------------ live log teardown ------------------------------
2025-05-16 07:22:42 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:42 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)

tests/handlers/test_business_assistant_menu_transitions.py::test_back_from_business_assistant 
------------------------------- live log setup --------------------------------
2025-05-16 07:22:42 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:42 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)
ERROR                                                                    [ 17%]
------------------------------ live log teardown ------------------------------
2025-05-16 07:22:42 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:42 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)

tests/handlers/test_business_assistant_menu_transitions.py::test_back_from_history 
------------------------------- live log setup --------------------------------
2025-05-16 07:22:42 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:42 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)
ERROR                                                                    [ 18%]
------------------------------ live log teardown ------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)

tests/handlers/test_menu_transitions.py::test_start_to_main_menu 
------------------------------- live log setup --------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)
ERROR                                                                    [ 20%]
------------------------------ live log teardown ------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)

tests/handlers/test_menu_transitions.py::test_main_menu_to_ai_photographer 
------------------------------- live log setup --------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)
ERROR                                                                    [ 21%]
------------------------------ live log teardown ------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)

tests/handlers/test_menu_transitions.py::test_ai_photographer_to_my_avatars 
------------------------------- live log setup --------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)
ERROR                                                                    [ 22%]
------------------------------ live log teardown ------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)

tests/handlers/test_menu_transitions.py::test_my_avatars_to_create_avatar 
------------------------------- live log setup --------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)
ERROR                                                                    [ 24%]
------------------------------ live log teardown ------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)

tests/handlers/test_menu_transitions.py::test_back_to_previous_menu 
------------------------------- live log setup --------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)
ERROR                                                                    [ 25%]
------------------------------ live log teardown ------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)

tests/handlers/test_menu_transitions.py::test_invalid_state_transition 
------------------------------- live log setup --------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)
ERROR                                                                    [ 26%]
------------------------------ live log teardown ------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)

tests/handlers/test_photo_enhance_menu_transitions.py::test_main_menu_to_photo_enhance 
------------------------------- live log setup --------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)
ERROR                                                                    [ 27%]
------------------------------ live log teardown ------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)

tests/handlers/test_photo_enhance_menu_transitions.py::test_photo_enhance_to_history 
------------------------------- live log setup --------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)
ERROR                                                                    [ 29%]
------------------------------ live log teardown ------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)

tests/handlers/test_photo_enhance_menu_transitions.py::test_photo_enhance_to_new 
------------------------------- live log setup --------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)
ERROR                                                                    [ 30%]
------------------------------ live log teardown ------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)

tests/handlers/test_photo_enhance_menu_transitions.py::test_back_from_photo_enhance 
------------------------------- live log setup --------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)
ERROR                                                                    [ 31%]
------------------------------ live log teardown ------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)

tests/handlers/test_photo_enhance_menu_transitions.py::test_back_from_history 
------------------------------- live log setup --------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)
ERROR                                                                    [ 32%]
------------------------------ live log teardown ------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)

tests/handlers/test_transcribe_delete.py::test_delete_my_file_success 
------------------------------- live log setup --------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)
-------------------------------- live log call --------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Loading transcripts from storage/user_transcripts.json (user_transcripts_store.py:17)
2025-05-16 07:22:43 [    INFO] [DEBUG] Loaded 0 transcripts (user_transcripts_store.py:21)
2025-05-16 07:22:43 [    INFO] [DEBUG] Setting transcript for user 123456: C:\Users\user\AppData\Local\Temp\pytest-of-user\pytest-14\test_delete_my_file_success0\test_transcript.txt (user_transcripts_store.py:45)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 1 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)
2025-05-16 07:22:43 [    INFO] [DEBUG] Getting transcript for user 123456: C:\Users\user\AppData\Local\Temp\pytest-of-user\pytest-14\test_delete_my_file_success0\test_transcript.txt (user_transcripts_store.py:38)
2025-05-16 07:22:43 [    INFO] [DEBUG] Removing transcript for user 123456 (user_transcripts_store.py:53)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)
2025-05-16 07:22:43 [    INFO] [DEBUG] Loading transcripts from storage/user_transcripts.json (user_transcripts_store.py:17)
2025-05-16 07:22:43 [    INFO] [DEBUG] Loaded 0 transcripts (user_transcripts_store.py:21)
PASSED                                                                   [ 34%]
------------------------------ live log teardown ------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)

tests/handlers/test_transcribe_delete.py::test_delete_my_file_no_file 
------------------------------- live log setup --------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)
-------------------------------- live log call --------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Loading transcripts from storage/user_transcripts.json (user_transcripts_store.py:17)
2025-05-16 07:22:43 [    INFO] [DEBUG] Loaded 0 transcripts (user_transcripts_store.py:21)
2025-05-16 07:22:43 [    INFO] [DEBUG] Getting transcript for user 123456: None (user_transcripts_store.py:38)
2025-05-16 07:22:43 [    INFO] [DEBUG] Loading transcripts from storage/user_transcripts.json (user_transcripts_store.py:17)
2025-05-16 07:22:43 [    INFO] [DEBUG] Loaded 0 transcripts (user_transcripts_store.py:21)
PASSED                                                                   [ 35%]
------------------------------ live log teardown ------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)

tests/handlers/test_transcribe_history.py::test_show_history_success 
------------------------------- live log setup --------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)
PASSED                                                                   [ 36%]
------------------------------ live log teardown ------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)

tests/handlers/test_transcribe_history.py::test_show_history_empty 
------------------------------- live log setup --------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)
PASSED                                                                   [ 37%]
------------------------------ live log teardown ------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)

tests/handlers/test_transcribe_menu_transitions.py::test_main_menu_to_transcribe 
------------------------------- live log setup --------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)
ERROR                                                                    [ 39%]
------------------------------ live log teardown ------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)

tests/handlers/test_transcribe_menu_transitions.py::test_transcribe_to_history 
------------------------------- live log setup --------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)
ERROR                                                                    [ 40%]
------------------------------ live log teardown ------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)

tests/handlers/test_transcribe_menu_transitions.py::test_transcribe_to_new 
------------------------------- live log setup --------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)
ERROR                                                                    [ 41%]
------------------------------ live log teardown ------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)

tests/handlers/test_transcribe_menu_transitions.py::test_back_from_transcribe 
------------------------------- live log setup --------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)
ERROR                                                                    [ 43%]
------------------------------ live log teardown ------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)

tests/handlers/test_transcribe_menu_transitions.py::test_back_from_history 
------------------------------- live log setup --------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)
ERROR                                                                    [ 44%]
------------------------------ live log teardown ------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)

tests/handlers/test_transcribe_mom.py::test_send_mom_success 
------------------------------- live log setup --------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)
-------------------------------- live log call --------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Setting transcript for user 123456: C:\Users\user\AppData\Local\Temp\pytest-of-user\pytest-14\test_send_mom_success0\test_transcript.txt (user_transcripts_store.py:45)
2025-05-16 07:22:43 [    INFO] [HANDLER] send_mom, message.text='Сформировать MoM' (transcribe_protocol.py:148)
2025-05-16 07:22:43 [    INFO] [DEBUG] Getting transcript for user 123456 (transcript_utils.py:9)
2025-05-16 07:22:43 [    INFO] [DEBUG] Getting transcript for user 123456: C:\Users\user\AppData\Local\Temp\pytest-of-user\pytest-14\test_send_mom_success0\test_transcript.txt (user_transcripts_store.py:38)
2025-05-16 07:22:43 [    INFO] [DEBUG] transcript_path: C:\Users\user\AppData\Local\Temp\pytest-of-user\pytest-14\test_send_mom_success0\test_transcript.txt (transcript_utils.py:11)
2025-05-16 07:22:43 [    INFO] [DEBUG] Read transcript, length: 23 (transcript_utils.py:23)
FAILED                                                                   [ 45%]
------------------------------ live log teardown ------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)

tests/handlers/test_transcribe_mom.py::test_send_mom_no_file 
------------------------------- live log setup --------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)
-------------------------------- live log call --------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Setting transcript for user 123456: C:\Users\user\AppData\Local\Temp\pytest-of-user\pytest-14\test_send_mom_no_file0\test_transcript.txt (user_transcripts_store.py:45)
2025-05-16 07:22:43 [    INFO] [HANDLER] send_mom, message.text='Сформировать MoM' (transcribe_protocol.py:148)
2025-05-16 07:22:43 [    INFO] [DEBUG] Getting transcript for user 123456 (transcript_utils.py:9)
2025-05-16 07:22:43 [    INFO] [DEBUG] Getting transcript for user 123456: C:\Users\user\AppData\Local\Temp\pytest-of-user\pytest-14\test_send_mom_no_file0\test_transcript.txt (user_transcripts_store.py:38)
2025-05-16 07:22:43 [    INFO] [DEBUG] transcript_path: C:\Users\user\AppData\Local\Temp\pytest-of-user\pytest-14\test_send_mom_no_file0\test_transcript.txt (transcript_utils.py:11)
2025-05-16 07:22:43 [    INFO] [DEBUG] Read transcript, length: 0 (transcript_utils.py:23)
2025-05-16 07:22:43 [    INFO] [DEBUG] Empty transcript (transcript_utils.py:25)
PASSED                                                                   [ 46%]
------------------------------ live log teardown ------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)

tests/handlers/test_transcribe_mom.py::test_send_mom_gpt_error 
------------------------------- live log setup --------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)
-------------------------------- live log call --------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Setting transcript for user 123456: C:\Users\user\AppData\Local\Temp\pytest-of-user\pytest-14\test_send_mom_gpt_error0\test_transcript.txt (user_transcripts_store.py:45)
2025-05-16 07:22:43 [    INFO] [HANDLER] send_mom, message.text='Сформировать MoM' (transcribe_protocol.py:148)
2025-05-16 07:22:43 [    INFO] [DEBUG] Getting transcript for user 123456 (transcript_utils.py:9)
2025-05-16 07:22:43 [    INFO] [DEBUG] Getting transcript for user 123456: C:\Users\user\AppData\Local\Temp\pytest-of-user\pytest-14\test_send_mom_gpt_error0\test_transcript.txt (user_transcripts_store.py:38)
2025-05-16 07:22:43 [    INFO] [DEBUG] transcript_path: C:\Users\user\AppData\Local\Temp\pytest-of-user\pytest-14\test_send_mom_gpt_error0\test_transcript.txt (transcript_utils.py:11)
2025-05-16 07:22:43 [    INFO] [DEBUG] Read transcript, length: 23 (transcript_utils.py:23)
PASSED                                                                   [ 48%]
------------------------------ live log teardown ------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)

tests/handlers/test_transcribe_mom.py::test_send_mom_empty_transcript 
------------------------------- live log setup --------------------------------
2025-05-16 07:22:43 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:43 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)
-------------------------------- live log call --------------------------------
2025-05-16 07:22:44 [    INFO] [DEBUG] Setting transcript for user 123456: C:\Users\user\AppData\Local\Temp\pytest-of-user\pytest-14\test_send_mom_empty_transcript0\test_transcript.txt (user_transcripts_store.py:45)
2025-05-16 07:22:44 [    INFO] [HANDLER] send_mom, message.text='Сформировать MoM' (transcribe_protocol.py:148)
2025-05-16 07:22:44 [    INFO] [DEBUG] Getting transcript for user 123456 (transcript_utils.py:9)
2025-05-16 07:22:44 [    INFO] [DEBUG] Getting transcript for user 123456: C:\Users\user\AppData\Local\Temp\pytest-of-user\pytest-14\test_send_mom_empty_transcript0\test_transcript.txt (user_transcripts_store.py:38)
2025-05-16 07:22:44 [    INFO] [DEBUG] transcript_path: C:\Users\user\AppData\Local\Temp\pytest-of-user\pytest-14\test_send_mom_empty_transcript0\test_transcript.txt (transcript_utils.py:11)
2025-05-16 07:22:44 [    INFO] [DEBUG] Read transcript, length: 0 (transcript_utils.py:23)
2025-05-16 07:22:44 [    INFO] [DEBUG] Empty transcript (transcript_utils.py:25)
PASSED                                                                   [ 49%]
------------------------------ live log teardown ------------------------------
2025-05-16 07:22:44 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:44 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)

tests/handlers/test_transcribe_mom.py::test_send_mom_empty_gpt 
------------------------------- live log setup --------------------------------
2025-05-16 07:22:44 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:44 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)
-------------------------------- live log call --------------------------------
2025-05-16 07:22:44 [    INFO] [DEBUG] Setting transcript for user 123456: C:\Users\user\AppData\Local\Temp\pytest-of-user\pytest-14\test_send_mom_empty_gpt0\test_transcript.txt (user_transcripts_store.py:45)
2025-05-16 07:22:44 [    INFO] [HANDLER] send_mom, message.text='Сформировать MoM' (transcribe_protocol.py:148)
2025-05-16 07:22:44 [    INFO] [DEBUG] Getting transcript for user 123456 (transcript_utils.py:9)
2025-05-16 07:22:44 [    INFO] [DEBUG] Getting transcript for user 123456: C:\Users\user\AppData\Local\Temp\pytest-of-user\pytest-14\test_send_mom_empty_gpt0\test_transcript.txt (user_transcripts_store.py:38)
2025-05-16 07:22:44 [    INFO] [DEBUG] transcript_path: C:\Users\user\AppData\Local\Temp\pytest-of-user\pytest-14\test_send_mom_empty_gpt0\test_transcript.txt (transcript_utils.py:11)
2025-05-16 07:22:44 [    INFO] [DEBUG] Read transcript, length: 23 (transcript_utils.py:23)
PASSED                                                                   [ 50%]
------------------------------ live log teardown ------------------------------
2025-05-16 07:22:44 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:44 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)

tests/handlers/test_transcribe_summary.py::test_full_official_transcript_success 
------------------------------- live log setup --------------------------------
2025-05-16 07:22:44 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:22:44 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)
-------------------------------- live log call --------------------------------
2025-05-16 07:22:44 [    INFO] [DEBUG] Loading transcripts from storage/user_transcripts.json (user_transcripts_store.py:17)
2025-05-16 07:22:44 [    INFO] [DEBUG] Loaded 0 transcripts (user_transcripts_store.py:21)
2025-05-16 07:22:44 [    INFO] [DEBUG] Setting transcript for user 123456: C:\Users\user\AppData\Local\Temp\pytest-of-user\pytest-14\test_full_official_transcript_0\test_transcript.txt (user_transcripts_store.py:45)
2025-05-16 07:22:44 [    INFO] [DEBUG] Saving 1 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)
2025-05-16 07:22:44 [    INFO] [HANDLER] send_full_official_transcript, message.text='Полный официальный транскрипт' (transcribe_protocol.py:244)
2025-05-16 07:22:44 [    INFO] [DEBUG] User ID: 123456 (transcribe_protocol.py:245)
2025-05-16 07:22:44 [    INFO] [DEBUG] Getting transcript for user 123456 (transcript_utils.py:9)
2025-05-16 07:22:44 [    INFO] [DEBUG] Getting transcript for user 123456: C:\Users\user\AppData\Local\Temp\pytest-of-user\pytest-14\test_full_official_transcript_0\test_transcript.txt (user_transcripts_store.py:38)
2025-05-16 07:22:44 [    INFO] [DEBUG] transcript_path: C:\Users\user\AppData\Local\Temp\pytest-of-user\pytest-14\test_full_official_transcript_0\test_transcript.txt (transcript_utils.py:11)
2025-05-16 07:22:44 [    INFO] [DEBUG] Read transcript, length: 23 (transcript_utils.py:23)
2025-05-16 07:22:44 [    INFO] [DEBUG] transcript: Test transcript content (transcribe_protocol.py:247)

ERROR: Coverage failure: total of 31 is less than fail-under=80
--------------------------- live log sessionfinish ----------------------------
2025-05-16 07:24:45 [    INFO] [DEBUG] Clearing all transcripts (user_transcripts_store.py:60)
2025-05-16 07:24:45 [    INFO] [DEBUG] Saving 0 transcripts to storage/user_transcripts.json (user_transcripts_store.py:29)


=================================== ERRORS ====================================
_____________ ERROR at setup of test_handle_avatar_photo_success ______________

    @pytest.fixture
    def mock_state_manager():
        """Фикстура для мока state_manager."""
        with patch("frontend_bot.handlers.handlers.get_state") as mock_get, \
             patch("frontend_bot.handlers.handlers.set_state") as mock_set, \
>            patch("frontend_bot.handlers.handlers.get_current_avatar_id") as mock_get_id, \
             patch("frontend_bot.services.avatar_workflow.set_state") as mock_set_workflow:

tests\handlers\test_avatar_handlers.py:64: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Users\user\AppData\Local\Programs\Python\Python313\Lib\unittest\mock.py:1497: in __enter__
    original, local = self.get_original()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000220B962B8B0>

    def get_original(self):
        target = self.getter()
        name = self.attribute
    
        original = DEFAULT
        local = False
    
        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True
    
        if name in _builtins and isinstance(target, ModuleType):
            self.create = True
    
        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'frontend_bot.handlers.handlers' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\handlers\\handlers.py'> does not have the attribute 'get_current_avatar_id'

C:\Users\user\AppData\Local\Programs\Python\Python313\Lib\unittest\mock.py:1467: AttributeError
----------------------------- Captured log setup ------------------------------
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:60 [DEBUG] Clearing all transcripts
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:29 [DEBUG] Saving 0 transcripts to storage/user_transcripts.json
_________ ERROR at setup of test_handle_avatar_photo_validation_error _________

    @pytest.fixture
    def mock_state_manager():
        """Фикстура для мока state_manager."""
        with patch("frontend_bot.handlers.handlers.get_state") as mock_get, \
             patch("frontend_bot.handlers.handlers.set_state") as mock_set, \
>            patch("frontend_bot.handlers.handlers.get_current_avatar_id") as mock_get_id, \
             patch("frontend_bot.services.avatar_workflow.set_state") as mock_set_workflow:

tests\handlers\test_avatar_handlers.py:64: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Users\user\AppData\Local\Programs\Python\Python313\Lib\unittest\mock.py:1497: in __enter__
    original, local = self.get_original()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000220B97150D0>

    def get_original(self):
        target = self.getter()
        name = self.attribute
    
        original = DEFAULT
        local = False
    
        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True
    
        if name in _builtins and isinstance(target, ModuleType):
            self.create = True
    
        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'frontend_bot.handlers.handlers' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\handlers\\handlers.py'> does not have the attribute 'get_current_avatar_id'

C:\Users\user\AppData\Local\Programs\Python\Python313\Lib\unittest\mock.py:1467: AttributeError
----------------------------- Captured log setup ------------------------------
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:60 [DEBUG] Clearing all transcripts
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:29 [DEBUG] Saving 0 transcripts to storage/user_transcripts.json
___________ ERROR at setup of test_handle_avatar_photo_next_success ___________

    @pytest.fixture
    def mock_state_manager():
        """Фикстура для мока state_manager."""
        with patch("frontend_bot.handlers.handlers.get_state") as mock_get, \
             patch("frontend_bot.handlers.handlers.set_state") as mock_set, \
>            patch("frontend_bot.handlers.handlers.get_current_avatar_id") as mock_get_id, \
             patch("frontend_bot.services.avatar_workflow.set_state") as mock_set_workflow:

tests\handlers\test_avatar_handlers.py:64: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Users\user\AppData\Local\Programs\Python\Python313\Lib\unittest\mock.py:1497: in __enter__
    original, local = self.get_original()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000220B97152E0>

    def get_original(self):
        target = self.getter()
        name = self.attribute
    
        original = DEFAULT
        local = False
    
        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True
    
        if name in _builtins and isinstance(target, ModuleType):
            self.create = True
    
        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'frontend_bot.handlers.handlers' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\handlers\\handlers.py'> does not have the attribute 'get_current_avatar_id'

C:\Users\user\AppData\Local\Programs\Python\Python313\Lib\unittest\mock.py:1467: AttributeError
----------------------------- Captured log setup ------------------------------
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:60 [DEBUG] Clearing all transcripts
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:29 [DEBUG] Saving 0 transcripts to storage/user_transcripts.json
______ ERROR at setup of test_handle_avatar_photo_next_not_enough_photos ______

    @pytest.fixture
    def mock_state_manager():
        """Фикстура для мока state_manager."""
        with patch("frontend_bot.handlers.handlers.get_state") as mock_get, \
             patch("frontend_bot.handlers.handlers.set_state") as mock_set, \
>            patch("frontend_bot.handlers.handlers.get_current_avatar_id") as mock_get_id, \
             patch("frontend_bot.services.avatar_workflow.set_state") as mock_set_workflow:

tests\handlers\test_avatar_handlers.py:64: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Users\user\AppData\Local\Programs\Python\Python313\Lib\unittest\mock.py:1497: in __enter__
    original, local = self.get_original()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000220B97154F0>

    def get_original(self):
        target = self.getter()
        name = self.attribute
    
        original = DEFAULT
        local = False
    
        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True
    
        if name in _builtins and isinstance(target, ModuleType):
            self.create = True
    
        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'frontend_bot.handlers.handlers' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\handlers\\handlers.py'> does not have the attribute 'get_current_avatar_id'

C:\Users\user\AppData\Local\Programs\Python\Python313\Lib\unittest\mock.py:1467: AttributeError
----------------------------- Captured log setup ------------------------------
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:60 [DEBUG] Clearing all transcripts
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:29 [DEBUG] Saving 0 transcripts to storage/user_transcripts.json
_____________ ERROR at setup of test_handle_avatar_gender_success _____________

    @pytest.fixture
    def mock_state_manager():
        """Фикстура для мока state_manager."""
        with patch("frontend_bot.handlers.handlers.get_state") as mock_get, \
             patch("frontend_bot.handlers.handlers.set_state") as mock_set, \
>            patch("frontend_bot.handlers.handlers.get_current_avatar_id") as mock_get_id, \
             patch("frontend_bot.services.avatar_workflow.set_state") as mock_set_workflow:

tests\handlers\test_avatar_handlers.py:64: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Users\user\AppData\Local\Programs\Python\Python313\Lib\unittest\mock.py:1497: in __enter__
    original, local = self.get_original()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000220B9714C00>

    def get_original(self):
        target = self.getter()
        name = self.attribute
    
        original = DEFAULT
        local = False
    
        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True
    
        if name in _builtins and isinstance(target, ModuleType):
            self.create = True
    
        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'frontend_bot.handlers.handlers' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\handlers\\handlers.py'> does not have the attribute 'get_current_avatar_id'

C:\Users\user\AppData\Local\Programs\Python\Python313\Lib\unittest\mock.py:1467: AttributeError
----------------------------- Captured log setup ------------------------------
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:60 [DEBUG] Clearing all transcripts
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:29 [DEBUG] Saving 0 transcripts to storage/user_transcripts.json
________ ERROR at setup of test_handle_avatar_gender_validation_error _________

    @pytest.fixture
    def mock_state_manager():
        """Фикстура для мока state_manager."""
        with patch("frontend_bot.handlers.handlers.get_state") as mock_get, \
             patch("frontend_bot.handlers.handlers.set_state") as mock_set, \
>            patch("frontend_bot.handlers.handlers.get_current_avatar_id") as mock_get_id, \
             patch("frontend_bot.services.avatar_workflow.set_state") as mock_set_workflow:

tests\handlers\test_avatar_handlers.py:64: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Users\user\AppData\Local\Programs\Python\Python313\Lib\unittest\mock.py:1497: in __enter__
    original, local = self.get_original()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000220B9715230>

    def get_original(self):
        target = self.getter()
        name = self.attribute
    
        original = DEFAULT
        local = False
    
        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True
    
        if name in _builtins and isinstance(target, ModuleType):
            self.create = True
    
        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'frontend_bot.handlers.handlers' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\handlers\\handlers.py'> does not have the attribute 'get_current_avatar_id'

C:\Users\user\AppData\Local\Programs\Python\Python313\Lib\unittest\mock.py:1467: AttributeError
----------------------------- Captured log setup ------------------------------
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:60 [DEBUG] Clearing all transcripts
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:29 [DEBUG] Saving 0 transcripts to storage/user_transcripts.json
______________ ERROR at setup of test_handle_avatar_name_success ______________

    @pytest.fixture
    def mock_state_manager():
        """Фикстура для мока state_manager."""
        with patch("frontend_bot.handlers.handlers.get_state") as mock_get, \
             patch("frontend_bot.handlers.handlers.set_state") as mock_set, \
>            patch("frontend_bot.handlers.handlers.get_current_avatar_id") as mock_get_id, \
             patch("frontend_bot.services.avatar_workflow.set_state") as mock_set_workflow:

tests\handlers\test_avatar_handlers.py:64: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Users\user\AppData\Local\Programs\Python\Python313\Lib\unittest\mock.py:1497: in __enter__
    original, local = self.get_original()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000220B9715910>

    def get_original(self):
        target = self.getter()
        name = self.attribute
    
        original = DEFAULT
        local = False
    
        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True
    
        if name in _builtins and isinstance(target, ModuleType):
            self.create = True
    
        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'frontend_bot.handlers.handlers' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\handlers\\handlers.py'> does not have the attribute 'get_current_avatar_id'

C:\Users\user\AppData\Local\Programs\Python\Python313\Lib\unittest\mock.py:1467: AttributeError
----------------------------- Captured log setup ------------------------------
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:60 [DEBUG] Clearing all transcripts
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:29 [DEBUG] Saving 0 transcripts to storage/user_transcripts.json
_________ ERROR at setup of test_handle_avatar_name_validation_error __________

    @pytest.fixture
    def mock_state_manager():
        """Фикстура для мока state_manager."""
        with patch("frontend_bot.handlers.handlers.get_state") as mock_get, \
             patch("frontend_bot.handlers.handlers.set_state") as mock_set, \
>            patch("frontend_bot.handlers.handlers.get_current_avatar_id") as mock_get_id, \
             patch("frontend_bot.services.avatar_workflow.set_state") as mock_set_workflow:

tests\handlers\test_avatar_handlers.py:64: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Users\user\AppData\Local\Programs\Python\Python313\Lib\unittest\mock.py:1497: in __enter__
    original, local = self.get_original()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000220B9715DE0>

    def get_original(self):
        target = self.getter()
        name = self.attribute
    
        original = DEFAULT
        local = False
    
        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True
    
        if name in _builtins and isinstance(target, ModuleType):
            self.create = True
    
        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'frontend_bot.handlers.handlers' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\handlers\\handlers.py'> does not have the attribute 'get_current_avatar_id'

C:\Users\user\AppData\Local\Programs\Python\Python313\Lib\unittest\mock.py:1467: AttributeError
----------------------------- Captured log setup ------------------------------
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:60 [DEBUG] Clearing all transcripts
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:29 [DEBUG] Saving 0 transcripts to storage/user_transcripts.json
____________ ERROR at setup of test_handle_avatar_confirm_success _____________

    @pytest.fixture
    def mock_state_manager():
        """Фикстура для мока state_manager."""
        with patch("frontend_bot.handlers.handlers.get_state") as mock_get, \
             patch("frontend_bot.handlers.handlers.set_state") as mock_set, \
>            patch("frontend_bot.handlers.handlers.get_current_avatar_id") as mock_get_id, \
             patch("frontend_bot.services.avatar_workflow.set_state") as mock_set_workflow:

tests\handlers\test_avatar_handlers.py:64: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Users\user\AppData\Local\Programs\Python\Python313\Lib\unittest\mock.py:1497: in __enter__
    original, local = self.get_original()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000220B9715B20>

    def get_original(self):
        target = self.getter()
        name = self.attribute
    
        original = DEFAULT
        local = False
    
        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True
    
        if name in _builtins and isinstance(target, ModuleType):
            self.create = True
    
        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'frontend_bot.handlers.handlers' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\handlers\\handlers.py'> does not have the attribute 'get_current_avatar_id'

C:\Users\user\AppData\Local\Programs\Python\Python313\Lib\unittest\mock.py:1467: AttributeError
----------------------------- Captured log setup ------------------------------
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:60 [DEBUG] Clearing all transcripts
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:29 [DEBUG] Saving 0 transcripts to storage/user_transcripts.json
________ ERROR at setup of test_handle_avatar_confirm_validation_error ________

    @pytest.fixture
    def mock_state_manager():
        """Фикстура для мока state_manager."""
        with patch("frontend_bot.handlers.handlers.get_state") as mock_get, \
             patch("frontend_bot.handlers.handlers.set_state") as mock_set, \
>            patch("frontend_bot.handlers.handlers.get_current_avatar_id") as mock_get_id, \
             patch("frontend_bot.services.avatar_workflow.set_state") as mock_set_workflow:

tests\handlers\test_avatar_handlers.py:64: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Users\user\AppData\Local\Programs\Python\Python313\Lib\unittest\mock.py:1497: in __enter__
    original, local = self.get_original()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000220B97154F0>

    def get_original(self):
        target = self.getter()
        name = self.attribute
    
        original = DEFAULT
        local = False
    
        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True
    
        if name in _builtins and isinstance(target, ModuleType):
            self.create = True
    
        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'frontend_bot.handlers.handlers' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\handlers\\handlers.py'> does not have the attribute 'get_current_avatar_id'

C:\Users\user\AppData\Local\Programs\Python\Python313\Lib\unittest\mock.py:1467: AttributeError
----------------------------- Captured log setup ------------------------------
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:60 [DEBUG] Clearing all transcripts
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:29 [DEBUG] Saving 0 transcripts to storage/user_transcripts.json
___________ ERROR at setup of test_main_menu_to_business_assistant ____________

obj = <module 'frontend_bot.services.state_manager' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\services\\state_manager.py'>
name = '_load_states', ann = 'frontend_bot.services.state_manager'

    def annotated_getattr(obj: object, name: str, ann: str) -> object:
        try:
>           obj = getattr(obj, name)
E           AttributeError: module 'frontend_bot.services.state_manager' has no attribute '_load_states'

venv\Lib\site-packages\_pytest\monkeypatch.py:90: AttributeError

The above exception was the direct cause of the following exception:

monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x00000220B96674D0>

    @pytest.fixture(autouse=True)
    def mock_state_manager(monkeypatch):
        """Мокает _load_states и _save_states на in-memory dict для изоляции FSM в тестах."""
        state = {}
        async def _load_states():
            return state.copy()
        async def _save_states(new_state):
            state.clear()
            state.update(new_state)
>       monkeypatch.setattr("frontend_bot.services.state_manager._load_states", _load_states)

tests\handlers\test_business_assistant_menu_transitions.py:54: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\_pytest\monkeypatch.py:104: in derive_importpath
    annotated_getattr(target, attr, ann=module)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

obj = <module 'frontend_bot.services.state_manager' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\services\\state_manager.py'>
name = '_load_states', ann = 'frontend_bot.services.state_manager'

    def annotated_getattr(obj: object, name: str, ann: str) -> object:
        try:
            obj = getattr(obj, name)
        except AttributeError as e:
>           raise AttributeError(
                f"{type(obj).__name__!r} object at {ann} has no attribute {name!r}"
            ) from e
E           AttributeError: 'module' object at frontend_bot.services.state_manager has no attribute '_load_states'

venv\Lib\site-packages\_pytest\monkeypatch.py:92: AttributeError
----------------------------- Captured log setup ------------------------------
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:60 [DEBUG] Clearing all transcripts
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:29 [DEBUG] Saving 0 transcripts to storage/user_transcripts.json
____________ ERROR at setup of test_business_assistant_to_history _____________

obj = <module 'frontend_bot.services.state_manager' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\services\\state_manager.py'>
name = '_load_states', ann = 'frontend_bot.services.state_manager'

    def annotated_getattr(obj: object, name: str, ann: str) -> object:
        try:
>           obj = getattr(obj, name)
E           AttributeError: module 'frontend_bot.services.state_manager' has no attribute '_load_states'

venv\Lib\site-packages\_pytest\monkeypatch.py:90: AttributeError

The above exception was the direct cause of the following exception:

monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x00000220B964F860>

    @pytest.fixture(autouse=True)
    def mock_state_manager(monkeypatch):
        """Мокает _load_states и _save_states на in-memory dict для изоляции FSM в тестах."""
        state = {}
        async def _load_states():
            return state.copy()
        async def _save_states(new_state):
            state.clear()
            state.update(new_state)
>       monkeypatch.setattr("frontend_bot.services.state_manager._load_states", _load_states)

tests\handlers\test_business_assistant_menu_transitions.py:54: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\_pytest\monkeypatch.py:104: in derive_importpath
    annotated_getattr(target, attr, ann=module)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

obj = <module 'frontend_bot.services.state_manager' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\services\\state_manager.py'>
name = '_load_states', ann = 'frontend_bot.services.state_manager'

    def annotated_getattr(obj: object, name: str, ann: str) -> object:
        try:
            obj = getattr(obj, name)
        except AttributeError as e:
>           raise AttributeError(
                f"{type(obj).__name__!r} object at {ann} has no attribute {name!r}"
            ) from e
E           AttributeError: 'module' object at frontend_bot.services.state_manager has no attribute '_load_states'

venv\Lib\site-packages\_pytest\monkeypatch.py:92: AttributeError
----------------------------- Captured log setup ------------------------------
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:60 [DEBUG] Clearing all transcripts
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:29 [DEBUG] Saving 0 transcripts to storage/user_transcripts.json
___________ ERROR at setup of test_business_assistant_to_new_dialog ___________

obj = <module 'frontend_bot.services.state_manager' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\services\\state_manager.py'>
name = '_load_states', ann = 'frontend_bot.services.state_manager'

    def annotated_getattr(obj: object, name: str, ann: str) -> object:
        try:
>           obj = getattr(obj, name)
E           AttributeError: module 'frontend_bot.services.state_manager' has no attribute '_load_states'

venv\Lib\site-packages\_pytest\monkeypatch.py:90: AttributeError

The above exception was the direct cause of the following exception:

monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x00000220B96828D0>

    @pytest.fixture(autouse=True)
    def mock_state_manager(monkeypatch):
        """Мокает _load_states и _save_states на in-memory dict для изоляции FSM в тестах."""
        state = {}
        async def _load_states():
            return state.copy()
        async def _save_states(new_state):
            state.clear()
            state.update(new_state)
>       monkeypatch.setattr("frontend_bot.services.state_manager._load_states", _load_states)

tests\handlers\test_business_assistant_menu_transitions.py:54: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\_pytest\monkeypatch.py:104: in derive_importpath
    annotated_getattr(target, attr, ann=module)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

obj = <module 'frontend_bot.services.state_manager' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\services\\state_manager.py'>
name = '_load_states', ann = 'frontend_bot.services.state_manager'

    def annotated_getattr(obj: object, name: str, ann: str) -> object:
        try:
            obj = getattr(obj, name)
        except AttributeError as e:
>           raise AttributeError(
                f"{type(obj).__name__!r} object at {ann} has no attribute {name!r}"
            ) from e
E           AttributeError: 'module' object at frontend_bot.services.state_manager has no attribute '_load_states'

venv\Lib\site-packages\_pytest\monkeypatch.py:92: AttributeError
----------------------------- Captured log setup ------------------------------
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:60 [DEBUG] Clearing all transcripts
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:29 [DEBUG] Saving 0 transcripts to storage/user_transcripts.json
_____________ ERROR at setup of test_back_from_business_assistant _____________

obj = <module 'frontend_bot.services.state_manager' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\services\\state_manager.py'>
name = '_load_states', ann = 'frontend_bot.services.state_manager'

    def annotated_getattr(obj: object, name: str, ann: str) -> object:
        try:
>           obj = getattr(obj, name)
E           AttributeError: module 'frontend_bot.services.state_manager' has no attribute '_load_states'

venv\Lib\site-packages\_pytest\monkeypatch.py:90: AttributeError

The above exception was the direct cause of the following exception:

monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x00000220B9682B10>

    @pytest.fixture(autouse=True)
    def mock_state_manager(monkeypatch):
        """Мокает _load_states и _save_states на in-memory dict для изоляции FSM в тестах."""
        state = {}
        async def _load_states():
            return state.copy()
        async def _save_states(new_state):
            state.clear()
            state.update(new_state)
>       monkeypatch.setattr("frontend_bot.services.state_manager._load_states", _load_states)

tests\handlers\test_business_assistant_menu_transitions.py:54: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\_pytest\monkeypatch.py:104: in derive_importpath
    annotated_getattr(target, attr, ann=module)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

obj = <module 'frontend_bot.services.state_manager' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\services\\state_manager.py'>
name = '_load_states', ann = 'frontend_bot.services.state_manager'

    def annotated_getattr(obj: object, name: str, ann: str) -> object:
        try:
            obj = getattr(obj, name)
        except AttributeError as e:
>           raise AttributeError(
                f"{type(obj).__name__!r} object at {ann} has no attribute {name!r}"
            ) from e
E           AttributeError: 'module' object at frontend_bot.services.state_manager has no attribute '_load_states'

venv\Lib\site-packages\_pytest\monkeypatch.py:92: AttributeError
----------------------------- Captured log setup ------------------------------
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:60 [DEBUG] Clearing all transcripts
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:29 [DEBUG] Saving 0 transcripts to storage/user_transcripts.json
__________________ ERROR at setup of test_back_from_history ___________________

obj = <module 'frontend_bot.services.state_manager' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\services\\state_manager.py'>
name = '_load_states', ann = 'frontend_bot.services.state_manager'

    def annotated_getattr(obj: object, name: str, ann: str) -> object:
        try:
>           obj = getattr(obj, name)
E           AttributeError: module 'frontend_bot.services.state_manager' has no attribute '_load_states'

venv\Lib\site-packages\_pytest\monkeypatch.py:90: AttributeError

The above exception was the direct cause of the following exception:

monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x00000220B9715230>

    @pytest.fixture(autouse=True)
    def mock_state_manager(monkeypatch):
        """Мокает _load_states и _save_states на in-memory dict для изоляции FSM в тестах."""
        state = {}
        async def _load_states():
            return state.copy()
        async def _save_states(new_state):
            state.clear()
            state.update(new_state)
>       monkeypatch.setattr("frontend_bot.services.state_manager._load_states", _load_states)

tests\handlers\test_business_assistant_menu_transitions.py:54: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\_pytest\monkeypatch.py:104: in derive_importpath
    annotated_getattr(target, attr, ann=module)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

obj = <module 'frontend_bot.services.state_manager' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\services\\state_manager.py'>
name = '_load_states', ann = 'frontend_bot.services.state_manager'

    def annotated_getattr(obj: object, name: str, ann: str) -> object:
        try:
            obj = getattr(obj, name)
        except AttributeError as e:
>           raise AttributeError(
                f"{type(obj).__name__!r} object at {ann} has no attribute {name!r}"
            ) from e
E           AttributeError: 'module' object at frontend_bot.services.state_manager has no attribute '_load_states'

venv\Lib\site-packages\_pytest\monkeypatch.py:92: AttributeError
----------------------------- Captured log setup ------------------------------
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:60 [DEBUG] Clearing all transcripts
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:29 [DEBUG] Saving 0 transcripts to storage/user_transcripts.json
__________________ ERROR at setup of test_start_to_main_menu __________________

    @pytest.fixture
    async def clean_state():
        """Фикстура для очистки состояния до и после теста."""
>       await clear_state()
E       TypeError: clear_state() missing 1 required positional argument: 'user_id'

tests\handlers\test_menu_transitions.py:14: TypeError
----------------------------- Captured log setup ------------------------------
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:60 [DEBUG] Clearing all transcripts
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:29 [DEBUG] Saving 0 transcripts to storage/user_transcripts.json
_____________ ERROR at setup of test_main_menu_to_ai_photographer _____________

    @pytest.fixture
    async def clean_state():
        """Фикстура для очистки состояния до и после теста."""
>       await clear_state()
E       TypeError: clear_state() missing 1 required positional argument: 'user_id'

tests\handlers\test_menu_transitions.py:14: TypeError
----------------------------- Captured log setup ------------------------------
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:60 [DEBUG] Clearing all transcripts
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:29 [DEBUG] Saving 0 transcripts to storage/user_transcripts.json
____________ ERROR at setup of test_ai_photographer_to_my_avatars _____________

    @pytest.fixture
    async def clean_state():
        """Фикстура для очистки состояния до и после теста."""
>       await clear_state()
E       TypeError: clear_state() missing 1 required positional argument: 'user_id'

tests\handlers\test_menu_transitions.py:14: TypeError
----------------------------- Captured log setup ------------------------------
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:60 [DEBUG] Clearing all transcripts
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:29 [DEBUG] Saving 0 transcripts to storage/user_transcripts.json
_____________ ERROR at setup of test_my_avatars_to_create_avatar ______________

    @pytest.fixture
    async def clean_state():
        """Фикстура для очистки состояния до и после теста."""
>       await clear_state()
E       TypeError: clear_state() missing 1 required positional argument: 'user_id'

tests\handlers\test_menu_transitions.py:14: TypeError
----------------------------- Captured log setup ------------------------------
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:60 [DEBUG] Clearing all transcripts
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:29 [DEBUG] Saving 0 transcripts to storage/user_transcripts.json
________________ ERROR at setup of test_back_to_previous_menu _________________

    @pytest.fixture
    async def clean_state():
        """Фикстура для очистки состояния до и после теста."""
>       await clear_state()
E       TypeError: clear_state() missing 1 required positional argument: 'user_id'

tests\handlers\test_menu_transitions.py:14: TypeError
----------------------------- Captured log setup ------------------------------
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:60 [DEBUG] Clearing all transcripts
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:29 [DEBUG] Saving 0 transcripts to storage/user_transcripts.json
_______________ ERROR at setup of test_invalid_state_transition _______________

    @pytest.fixture
    async def clean_state():
        """Фикстура для очистки состояния до и после теста."""
>       await clear_state()
E       TypeError: clear_state() missing 1 required positional argument: 'user_id'

tests\handlers\test_menu_transitions.py:14: TypeError
----------------------------- Captured log setup ------------------------------
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:60 [DEBUG] Clearing all transcripts
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:29 [DEBUG] Saving 0 transcripts to storage/user_transcripts.json
______________ ERROR at setup of test_main_menu_to_photo_enhance ______________

obj = <module 'frontend_bot.services.state_manager' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\services\\state_manager.py'>
name = '_load_states', ann = 'frontend_bot.services.state_manager'

    def annotated_getattr(obj: object, name: str, ann: str) -> object:
        try:
>           obj = getattr(obj, name)
E           AttributeError: module 'frontend_bot.services.state_manager' has no attribute '_load_states'

venv\Lib\site-packages\_pytest\monkeypatch.py:90: AttributeError

The above exception was the direct cause of the following exception:

monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x00000220B81A6430>

    @pytest.fixture(autouse=True)
    def mock_state_manager(monkeypatch):
        """Мокает _load_states и _save_states на in-memory dict для изоляции FSM в тестах."""
        state = {}
        async def _load_states():
            return state.copy()
        async def _save_states(new_state):
            state.clear()
            state.update(new_state)
>       monkeypatch.setattr("frontend_bot.services.state_manager._load_states", _load_states)

tests\handlers\test_photo_enhance_menu_transitions.py:54: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\_pytest\monkeypatch.py:104: in derive_importpath
    annotated_getattr(target, attr, ann=module)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

obj = <module 'frontend_bot.services.state_manager' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\services\\state_manager.py'>
name = '_load_states', ann = 'frontend_bot.services.state_manager'

    def annotated_getattr(obj: object, name: str, ann: str) -> object:
        try:
            obj = getattr(obj, name)
        except AttributeError as e:
>           raise AttributeError(
                f"{type(obj).__name__!r} object at {ann} has no attribute {name!r}"
            ) from e
E           AttributeError: 'module' object at frontend_bot.services.state_manager has no attribute '_load_states'

venv\Lib\site-packages\_pytest\monkeypatch.py:92: AttributeError
----------------------------- Captured log setup ------------------------------
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:60 [DEBUG] Clearing all transcripts
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:29 [DEBUG] Saving 0 transcripts to storage/user_transcripts.json
_______________ ERROR at setup of test_photo_enhance_to_history _______________

obj = <module 'frontend_bot.services.state_manager' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\services\\state_manager.py'>
name = '_load_states', ann = 'frontend_bot.services.state_manager'

    def annotated_getattr(obj: object, name: str, ann: str) -> object:
        try:
>           obj = getattr(obj, name)
E           AttributeError: module 'frontend_bot.services.state_manager' has no attribute '_load_states'

venv\Lib\site-packages\_pytest\monkeypatch.py:90: AttributeError

The above exception was the direct cause of the following exception:

monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x00000220B975AA50>

    @pytest.fixture(autouse=True)
    def mock_state_manager(monkeypatch):
        """Мокает _load_states и _save_states на in-memory dict для изоляции FSM в тестах."""
        state = {}
        async def _load_states():
            return state.copy()
        async def _save_states(new_state):
            state.clear()
            state.update(new_state)
>       monkeypatch.setattr("frontend_bot.services.state_manager._load_states", _load_states)

tests\handlers\test_photo_enhance_menu_transitions.py:54: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\_pytest\monkeypatch.py:104: in derive_importpath
    annotated_getattr(target, attr, ann=module)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

obj = <module 'frontend_bot.services.state_manager' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\services\\state_manager.py'>
name = '_load_states', ann = 'frontend_bot.services.state_manager'

    def annotated_getattr(obj: object, name: str, ann: str) -> object:
        try:
            obj = getattr(obj, name)
        except AttributeError as e:
>           raise AttributeError(
                f"{type(obj).__name__!r} object at {ann} has no attribute {name!r}"
            ) from e
E           AttributeError: 'module' object at frontend_bot.services.state_manager has no attribute '_load_states'

venv\Lib\site-packages\_pytest\monkeypatch.py:92: AttributeError
----------------------------- Captured log setup ------------------------------
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:60 [DEBUG] Clearing all transcripts
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:29 [DEBUG] Saving 0 transcripts to storage/user_transcripts.json
_________________ ERROR at setup of test_photo_enhance_to_new _________________

obj = <module 'frontend_bot.services.state_manager' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\services\\state_manager.py'>
name = '_load_states', ann = 'frontend_bot.services.state_manager'

    def annotated_getattr(obj: object, name: str, ann: str) -> object:
        try:
>           obj = getattr(obj, name)
E           AttributeError: module 'frontend_bot.services.state_manager' has no attribute '_load_states'

venv\Lib\site-packages\_pytest\monkeypatch.py:90: AttributeError

The above exception was the direct cause of the following exception:

monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x00000220B975A7B0>

    @pytest.fixture(autouse=True)
    def mock_state_manager(monkeypatch):
        """Мокает _load_states и _save_states на in-memory dict для изоляции FSM в тестах."""
        state = {}
        async def _load_states():
            return state.copy()
        async def _save_states(new_state):
            state.clear()
            state.update(new_state)
>       monkeypatch.setattr("frontend_bot.services.state_manager._load_states", _load_states)

tests\handlers\test_photo_enhance_menu_transitions.py:54: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\_pytest\monkeypatch.py:104: in derive_importpath
    annotated_getattr(target, attr, ann=module)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

obj = <module 'frontend_bot.services.state_manager' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\services\\state_manager.py'>
name = '_load_states', ann = 'frontend_bot.services.state_manager'

    def annotated_getattr(obj: object, name: str, ann: str) -> object:
        try:
            obj = getattr(obj, name)
        except AttributeError as e:
>           raise AttributeError(
                f"{type(obj).__name__!r} object at {ann} has no attribute {name!r}"
            ) from e
E           AttributeError: 'module' object at frontend_bot.services.state_manager has no attribute '_load_states'

venv\Lib\site-packages\_pytest\monkeypatch.py:92: AttributeError
----------------------------- Captured log setup ------------------------------
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:60 [DEBUG] Clearing all transcripts
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:29 [DEBUG] Saving 0 transcripts to storage/user_transcripts.json
_______________ ERROR at setup of test_back_from_photo_enhance ________________

obj = <module 'frontend_bot.services.state_manager' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\services\\state_manager.py'>
name = '_load_states', ann = 'frontend_bot.services.state_manager'

    def annotated_getattr(obj: object, name: str, ann: str) -> object:
        try:
>           obj = getattr(obj, name)
E           AttributeError: module 'frontend_bot.services.state_manager' has no attribute '_load_states'

venv\Lib\site-packages\_pytest\monkeypatch.py:90: AttributeError

The above exception was the direct cause of the following exception:

monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x00000220B975B1C0>

    @pytest.fixture(autouse=True)
    def mock_state_manager(monkeypatch):
        """Мокает _load_states и _save_states на in-memory dict для изоляции FSM в тестах."""
        state = {}
        async def _load_states():
            return state.copy()
        async def _save_states(new_state):
            state.clear()
            state.update(new_state)
>       monkeypatch.setattr("frontend_bot.services.state_manager._load_states", _load_states)

tests\handlers\test_photo_enhance_menu_transitions.py:54: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\_pytest\monkeypatch.py:104: in derive_importpath
    annotated_getattr(target, attr, ann=module)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

obj = <module 'frontend_bot.services.state_manager' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\services\\state_manager.py'>
name = '_load_states', ann = 'frontend_bot.services.state_manager'

    def annotated_getattr(obj: object, name: str, ann: str) -> object:
        try:
            obj = getattr(obj, name)
        except AttributeError as e:
>           raise AttributeError(
                f"{type(obj).__name__!r} object at {ann} has no attribute {name!r}"
            ) from e
E           AttributeError: 'module' object at frontend_bot.services.state_manager has no attribute '_load_states'

venv\Lib\site-packages\_pytest\monkeypatch.py:92: AttributeError
----------------------------- Captured log setup ------------------------------
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:60 [DEBUG] Clearing all transcripts
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:29 [DEBUG] Saving 0 transcripts to storage/user_transcripts.json
__________________ ERROR at setup of test_back_from_history ___________________

obj = <module 'frontend_bot.services.state_manager' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\services\\state_manager.py'>
name = '_load_states', ann = 'frontend_bot.services.state_manager'

    def annotated_getattr(obj: object, name: str, ann: str) -> object:
        try:
>           obj = getattr(obj, name)
E           AttributeError: module 'frontend_bot.services.state_manager' has no attribute '_load_states'

venv\Lib\site-packages\_pytest\monkeypatch.py:90: AttributeError

The above exception was the direct cause of the following exception:

monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x00000220B975B770>

    @pytest.fixture(autouse=True)
    def mock_state_manager(monkeypatch):
        """Мокает _load_states и _save_states на in-memory dict для изоляции FSM в тестах."""
        state = {}
        async def _load_states():
            return state.copy()
        async def _save_states(new_state):
            state.clear()
            state.update(new_state)
>       monkeypatch.setattr("frontend_bot.services.state_manager._load_states", _load_states)

tests\handlers\test_photo_enhance_menu_transitions.py:54: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\_pytest\monkeypatch.py:104: in derive_importpath
    annotated_getattr(target, attr, ann=module)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

obj = <module 'frontend_bot.services.state_manager' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\services\\state_manager.py'>
name = '_load_states', ann = 'frontend_bot.services.state_manager'

    def annotated_getattr(obj: object, name: str, ann: str) -> object:
        try:
            obj = getattr(obj, name)
        except AttributeError as e:
>           raise AttributeError(
                f"{type(obj).__name__!r} object at {ann} has no attribute {name!r}"
            ) from e
E           AttributeError: 'module' object at frontend_bot.services.state_manager has no attribute '_load_states'

venv\Lib\site-packages\_pytest\monkeypatch.py:92: AttributeError
----------------------------- Captured log setup ------------------------------
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:60 [DEBUG] Clearing all transcripts
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:29 [DEBUG] Saving 0 transcripts to storage/user_transcripts.json
_______________ ERROR at setup of test_main_menu_to_transcribe ________________

obj = <module 'frontend_bot.services.state_manager' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\services\\state_manager.py'>
name = '_load_states', ann = 'frontend_bot.services.state_manager'

    def annotated_getattr(obj: object, name: str, ann: str) -> object:
        try:
>           obj = getattr(obj, name)
E           AttributeError: module 'frontend_bot.services.state_manager' has no attribute '_load_states'

venv\Lib\site-packages\_pytest\monkeypatch.py:90: AttributeError

The above exception was the direct cause of the following exception:

monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x00000220BA93C0C0>

    @pytest.fixture(autouse=True)
    def mock_state_manager(monkeypatch):
        """Мокает _load_states и _save_states на in-memory dict для изоляции FSM в тестах."""
        state = {}
        async def _load_states():
            return state.copy()
        async def _save_states(new_state):
            state.clear()
            state.update(new_state)
>       monkeypatch.setattr("frontend_bot.services.state_manager._load_states", _load_states)

tests\handlers\test_transcribe_menu_transitions.py:54: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\_pytest\monkeypatch.py:104: in derive_importpath
    annotated_getattr(target, attr, ann=module)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

obj = <module 'frontend_bot.services.state_manager' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\services\\state_manager.py'>
name = '_load_states', ann = 'frontend_bot.services.state_manager'

    def annotated_getattr(obj: object, name: str, ann: str) -> object:
        try:
            obj = getattr(obj, name)
        except AttributeError as e:
>           raise AttributeError(
                f"{type(obj).__name__!r} object at {ann} has no attribute {name!r}"
            ) from e
E           AttributeError: 'module' object at frontend_bot.services.state_manager has no attribute '_load_states'

venv\Lib\site-packages\_pytest\monkeypatch.py:92: AttributeError
----------------------------- Captured log setup ------------------------------
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:60 [DEBUG] Clearing all transcripts
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:29 [DEBUG] Saving 0 transcripts to storage/user_transcripts.json
________________ ERROR at setup of test_transcribe_to_history _________________

obj = <module 'frontend_bot.services.state_manager' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\services\\state_manager.py'>
name = '_load_states', ann = 'frontend_bot.services.state_manager'

    def annotated_getattr(obj: object, name: str, ann: str) -> object:
        try:
>           obj = getattr(obj, name)
E           AttributeError: module 'frontend_bot.services.state_manager' has no attribute '_load_states'

venv\Lib\site-packages\_pytest\monkeypatch.py:90: AttributeError

The above exception was the direct cause of the following exception:

monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x00000220BA93DB00>

    @pytest.fixture(autouse=True)
    def mock_state_manager(monkeypatch):
        """Мокает _load_states и _save_states на in-memory dict для изоляции FSM в тестах."""
        state = {}
        async def _load_states():
            return state.copy()
        async def _save_states(new_state):
            state.clear()
            state.update(new_state)
>       monkeypatch.setattr("frontend_bot.services.state_manager._load_states", _load_states)

tests\handlers\test_transcribe_menu_transitions.py:54: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\_pytest\monkeypatch.py:104: in derive_importpath
    annotated_getattr(target, attr, ann=module)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

obj = <module 'frontend_bot.services.state_manager' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\services\\state_manager.py'>
name = '_load_states', ann = 'frontend_bot.services.state_manager'

    def annotated_getattr(obj: object, name: str, ann: str) -> object:
        try:
            obj = getattr(obj, name)
        except AttributeError as e:
>           raise AttributeError(
                f"{type(obj).__name__!r} object at {ann} has no attribute {name!r}"
            ) from e
E           AttributeError: 'module' object at frontend_bot.services.state_manager has no attribute '_load_states'

venv\Lib\site-packages\_pytest\monkeypatch.py:92: AttributeError
----------------------------- Captured log setup ------------------------------
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:60 [DEBUG] Clearing all transcripts
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:29 [DEBUG] Saving 0 transcripts to storage/user_transcripts.json
__________________ ERROR at setup of test_transcribe_to_new ___________________

obj = <module 'frontend_bot.services.state_manager' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\services\\state_manager.py'>
name = '_load_states', ann = 'frontend_bot.services.state_manager'

    def annotated_getattr(obj: object, name: str, ann: str) -> object:
        try:
>           obj = getattr(obj, name)
E           AttributeError: module 'frontend_bot.services.state_manager' has no attribute '_load_states'

venv\Lib\site-packages\_pytest\monkeypatch.py:90: AttributeError

The above exception was the direct cause of the following exception:

monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x00000220BA93E2E0>

    @pytest.fixture(autouse=True)
    def mock_state_manager(monkeypatch):
        """Мокает _load_states и _save_states на in-memory dict для изоляции FSM в тестах."""
        state = {}
        async def _load_states():
            return state.copy()
        async def _save_states(new_state):
            state.clear()
            state.update(new_state)
>       monkeypatch.setattr("frontend_bot.services.state_manager._load_states", _load_states)

tests\handlers\test_transcribe_menu_transitions.py:54: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\_pytest\monkeypatch.py:104: in derive_importpath
    annotated_getattr(target, attr, ann=module)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

obj = <module 'frontend_bot.services.state_manager' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\services\\state_manager.py'>
name = '_load_states', ann = 'frontend_bot.services.state_manager'

    def annotated_getattr(obj: object, name: str, ann: str) -> object:
        try:
            obj = getattr(obj, name)
        except AttributeError as e:
>           raise AttributeError(
                f"{type(obj).__name__!r} object at {ann} has no attribute {name!r}"
            ) from e
E           AttributeError: 'module' object at frontend_bot.services.state_manager has no attribute '_load_states'

venv\Lib\site-packages\_pytest\monkeypatch.py:92: AttributeError
----------------------------- Captured log setup ------------------------------
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:60 [DEBUG] Clearing all transcripts
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:29 [DEBUG] Saving 0 transcripts to storage/user_transcripts.json
_________________ ERROR at setup of test_back_from_transcribe _________________

obj = <module 'frontend_bot.services.state_manager' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\services\\state_manager.py'>
name = '_load_states', ann = 'frontend_bot.services.state_manager'

    def annotated_getattr(obj: object, name: str, ann: str) -> object:
        try:
>           obj = getattr(obj, name)
E           AttributeError: module 'frontend_bot.services.state_manager' has no attribute '_load_states'

venv\Lib\site-packages\_pytest\monkeypatch.py:90: AttributeError

The above exception was the direct cause of the following exception:

monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x00000220BA93E820>

    @pytest.fixture(autouse=True)
    def mock_state_manager(monkeypatch):
        """Мокает _load_states и _save_states на in-memory dict для изоляции FSM в тестах."""
        state = {}
        async def _load_states():
            return state.copy()
        async def _save_states(new_state):
            state.clear()
            state.update(new_state)
>       monkeypatch.setattr("frontend_bot.services.state_manager._load_states", _load_states)

tests\handlers\test_transcribe_menu_transitions.py:54: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\_pytest\monkeypatch.py:104: in derive_importpath
    annotated_getattr(target, attr, ann=module)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

obj = <module 'frontend_bot.services.state_manager' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\services\\state_manager.py'>
name = '_load_states', ann = 'frontend_bot.services.state_manager'

    def annotated_getattr(obj: object, name: str, ann: str) -> object:
        try:
            obj = getattr(obj, name)
        except AttributeError as e:
>           raise AttributeError(
                f"{type(obj).__name__!r} object at {ann} has no attribute {name!r}"
            ) from e
E           AttributeError: 'module' object at frontend_bot.services.state_manager has no attribute '_load_states'

venv\Lib\site-packages\_pytest\monkeypatch.py:92: AttributeError
----------------------------- Captured log setup ------------------------------
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:60 [DEBUG] Clearing all transcripts
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:29 [DEBUG] Saving 0 transcripts to storage/user_transcripts.json
__________________ ERROR at setup of test_back_from_history ___________________

obj = <module 'frontend_bot.services.state_manager' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\services\\state_manager.py'>
name = '_load_states', ann = 'frontend_bot.services.state_manager'

    def annotated_getattr(obj: object, name: str, ann: str) -> object:
        try:
>           obj = getattr(obj, name)
E           AttributeError: module 'frontend_bot.services.state_manager' has no attribute '_load_states'

venv\Lib\site-packages\_pytest\monkeypatch.py:90: AttributeError

The above exception was the direct cause of the following exception:

monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x00000220B975A900>

    @pytest.fixture(autouse=True)
    def mock_state_manager(monkeypatch):
        """Мокает _load_states и _save_states на in-memory dict для изоляции FSM в тестах."""
        state = {}
        async def _load_states():
            return state.copy()
        async def _save_states(new_state):
            state.clear()
            state.update(new_state)
>       monkeypatch.setattr("frontend_bot.services.state_manager._load_states", _load_states)

tests\handlers\test_transcribe_menu_transitions.py:54: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
venv\Lib\site-packages\_pytest\monkeypatch.py:104: in derive_importpath
    annotated_getattr(target, attr, ann=module)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

obj = <module 'frontend_bot.services.state_manager' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\services\\state_manager.py'>
name = '_load_states', ann = 'frontend_bot.services.state_manager'

    def annotated_getattr(obj: object, name: str, ann: str) -> object:
        try:
            obj = getattr(obj, name)
        except AttributeError as e:
>           raise AttributeError(
                f"{type(obj).__name__!r} object at {ann} has no attribute {name!r}"
            ) from e
E           AttributeError: 'module' object at frontend_bot.services.state_manager has no attribute '_load_states'

venv\Lib\site-packages\_pytest\monkeypatch.py:92: AttributeError
----------------------------- Captured log setup ------------------------------
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:60 [DEBUG] Clearing all transcripts
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:29 [DEBUG] Saving 0 transcripts to storage/user_transcripts.json
================================== FAILURES ===================================
____________________________ test_send_mom_success ____________________________

mock_async_exists = <AsyncMock name='async_exists' id='2339571789040'>
mock_send_message = <AsyncMock name='send_message' id='2339573815952'>
mock_send_chat_action = <AsyncMock name='send_chat_action' id='2339573811920'>
mock_send_document = <AsyncMock name='send_document' id='2339573813600'>
mock_load = <AsyncMock name='_load' id='2339573813936'>
mock_save = <AsyncMock name='_save' id='2339573812256'>
mock_openai_client = <AsyncMock id='2339572860304'>, fake_user_id = 123456
fake_txt_file = 'C:\\Users\\user\\AppData\\Local\\Temp\\pytest-of-user\\pytest-14\\test_send_mom_success0\\test_transcript.txt'
mock_aiofiles_open = <function mock_aiofiles_open.<locals>._open at 0x00000220B974B420>

    @patch("frontend_bot.services.user_transcripts_store._save", new_callable=AsyncMock)
    @patch("frontend_bot.services.user_transcripts_store._load", new_callable=AsyncMock)
    @patch(
        "frontend_bot.handlers.general.bot.send_document",
        new_callable=AsyncMock,
    )
    @patch(
        "frontend_bot.handlers.general.bot.send_chat_action",
        new_callable=AsyncMock,
    )
    @patch(
        "frontend_bot.handlers.general.bot.send_message",
        new_callable=AsyncMock,
    )
    @patch(
        "frontend_bot.services.file_utils.async_exists",
        new_callable=AsyncMock,
    )
    async def test_send_mom_success(
        mock_async_exists: AsyncMock,
        mock_send_message: AsyncMock,
        mock_send_chat_action: AsyncMock,
        mock_send_document: AsyncMock,
        mock_load: AsyncMock,
        mock_save: AsyncMock,
        mock_openai_client: AsyncMock,
        fake_user_id: int,
        fake_txt_file: str,
        mock_aiofiles_open,
    ):
        """
        Проверяет успешную отправку MoM (Minutes of Meeting) как .txt-файла с
        корректным именем, содержимым и caption.
        """
        await user_transcripts_store.set(fake_user_id, fake_txt_file)
        mock_aiofiles_open.set_content(fake_txt_file, "Test transcript content")
        mock_async_exists.return_value = True
    
        # Настраиваем мок клиента GPT
        mock_message = AsyncMock()
        mock_message.content = [AsyncMock()]
        mock_message.content[0].text.value = "MoM для теста"
        mock_openai_client.beta.threads.messages.list.return_value = AsyncMock(data=[mock_message])
        mock_openai_client.beta.threads.runs.retrieve.return_value = AsyncMock(status="completed")
    
        class AsyncFile:
            async def __aenter__(self):
                return self
    
            async def __aexit__(self, exc_type, exc, tb):
                pass
    
            async def read(self):
                return "Test transcript content"
    
        mock_aiofiles_open.return_value = AsyncFile()
        message = type(
            "Msg",
            (),
            {
                "from_user": type("U", (), {"id": fake_user_id})(),
                "chat": type("C", (), {"id": 1})(),
                "text": "Сформировать MoM",
            },
        )()
        await transcribe_protocol.send_mom(message)
        # Проверяем, что файл отправлен
>       mock_send_document.assert_called()

tests\handlers\test_transcribe_mom.py:83: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <AsyncMock name='send_document' id='2339573813600'>

    def assert_called(self):
        """assert that the mock was called at least once
        """
        if self.call_count == 0:
            msg = ("Expected '%s' to have been called." %
                   (self._mock_name or 'mock'))
>           raise AssertionError(msg)
E           AssertionError: Expected 'send_document' to have been called.

C:\Users\user\AppData\Local\Programs\Python\Python313\Lib\unittest\mock.py:948: AssertionError
----------------------------- Captured log setup ------------------------------
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:60 [DEBUG] Clearing all transcripts
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:29 [DEBUG] Saving 0 transcripts to storage/user_transcripts.json
------------------------------ Captured log call ------------------------------
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:45 [DEBUG] Setting transcript for user 123456: C:\Users\user\AppData\Local\Temp\pytest-of-user\pytest-14\test_send_mom_success0\test_transcript.txt
INFO     transcribe_protocol:transcribe_protocol.py:148 [HANDLER] send_mom, message.text='Сформировать MoM'
INFO     transcribe_protocol:transcript_utils.py:9 [DEBUG] Getting transcript for user 123456
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:38 [DEBUG] Getting transcript for user 123456: C:\Users\user\AppData\Local\Temp\pytest-of-user\pytest-14\test_send_mom_success0\test_transcript.txt
INFO     transcribe_protocol:transcript_utils.py:11 [DEBUG] transcript_path: C:\Users\user\AppData\Local\Temp\pytest-of-user\pytest-14\test_send_mom_success0\test_transcript.txt
INFO     transcribe_protocol:transcript_utils.py:23 [DEBUG] Read transcript, length: 23
---------------------------- Captured log teardown ----------------------------
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:60 [DEBUG] Clearing all transcripts
INFO     frontend_bot.services.user_transcripts_store:user_transcripts_store.py:29 [DEBUG] Saving 0 transcripts to storage/user_transcripts.json
=============================== tests coverage ================================
_______________ coverage: platform win32, python 3.13.3-final-0 _______________

Name                                              Stmts   Miss  Cover   Missing
-------------------------------------------------------------------------------
frontend_bot\GPT_Prompts\transcribe\prompts.py        5      0   100%
frontend_bot\__init__.py                              0      0   100%
frontend_bot\bot_instance.py                          6      0   100%
frontend_bot\config.py                               54      0   100%
frontend_bot\constants\avatar.py                      8      0   100%
frontend_bot\handlers\general.py                     48     20    58%   25, 31, 41-42, 50-51, 59-61, 71-73, 83-84, 96-98, 108-110
frontend_bot\handlers\handlers.py                    68     39    43%   43-68, 77-89, 102-120, 127-136, 143-151, 158-166
frontend_bot\handlers\start.py                       14      7    50%   18-20, 25-31
frontend_bot\handlers\transcribe_history.py          31      0   100%
frontend_bot\handlers\transcribe_protocol.py        172    119    31%   36-101, 106, 111-137, 156, 169-206, 211-239, 249-250, 259-267
frontend_bot\handlers\universal_back.py              62     48    23%   21-45, 50-85, 89-104, 108-123
frontend_bot\keyboards\main_menu_keyboard.py          9      5    44%   16-21
frontend_bot\keyboards\reply.py                      56     29    48%   37, 47, 75, 85, 92, 99, 106, 111-113, 117-124, 129, 134-144, 149, 154-163, 170, 177
frontend_bot\main.py                                 28     28     0%   1-38
frontend_bot\services\__init__.py                     0      0   100%
frontend_bot\services\avatar_manager.py             350    296    15%   50-52, 56-57, 66-76, 85-92, 104-106, 120-124, 136-141, 150-152, 164-165, 175-177, 186-189, 198-199, 221-244, 260-278, 282, 286, 290, 294, 304-321, 326-331, 335-345, 351-400, 404-441, 448-476, 481-494, 498-511, 525-557, 563-586, 590-597, 602-616, 621-641, 658-689, 693-698, 703, 708-711
frontend_bot\services\avatar_storage.py              25     25     0%   3-43
frontend_bot\services\avatar_workflow.py            102     76    25%   54-61, 76-92, 116-135, 154-162, 181-192, 208-225, 234-243, 258-278
frontend_bot\services\backend_client.py              35     35     0%   1-52
frontend_bot\services\fal_trainer.py                 49     49     0%   1-115
frontend_bot\services\file_utils.py                  54     28    48%   46, 55, 64, 76, 88, 92, 105-115, 127, 139-142, 154-155, 168-169, 178, 190-192, 198-199
frontend_bot\services\gallery_data.py                 3      3     0%   3-33
frontend_bot\services\gallery_state.py                1      1     0%   3
frontend_bot\services\gpt_assistant.py               56     36    36%   20-57, 72, 75, 93, 95-100
frontend_bot\services\history.py                     68     45    34%   31, 40-50, 59-66, 77-89, 101-102, 111-114, 127-138, 146, 158, 170-175
frontend_bot\services\photo_validator.py             20     20     0%   5-46
frontend_bot\services\shared_menu.py                  6      1    83%   14
frontend_bot\services\state_manager.py               68     43    37%   35, 44-72, 81-91, 103-104, 114-116, 125-128, 137, 141-142
frontend_bot\services\state_utils.py                 12      4    67%   22, 32, 41, 50
frontend_bot\services\transcribe_service.py         165    165     0%   5-347
frontend_bot\services\transcript_utils.py            35     13    63%   13-19, 33-41, 48-53, 64
frontend_bot\services\user_transcripts_store.py      50      4    92%   22-24, 52
frontend_bot\services\word_generator.py              23     18    22%   17-44
frontend_bot\shared\file_operations.py               99     66    33%   28-33, 43-50, 60-66, 82-86, 99-106, 119-124, 138-143, 155-161, 174-179, 190-196
frontend_bot\shared\image_processing.py               8      2    75%   18-19
frontend_bot\texts\__init__.py                        0      0   100%
frontend_bot\texts\avatar\__init__.py                 0      0   100%
frontend_bot\texts\avatar\texts.py                   20     20     0%   3-56
frontend_bot\texts\common.py                         23     23     0%   1-56
frontend_bot\texts\menu\__init__.py                   0      0   100%
frontend_bot\texts\menu\texts.py                      6      0   100%
frontend_bot\texts\transcribe\__init__.py             0      0   100%
frontend_bot\texts\transcribe\texts.py               14     14     0%   3-43
frontend_bot\utils\logger.py                         23     15    35%   29-58
-------------------------------------------------------------------------------
TOTAL                                              1876   1297    31%
Coverage HTML written to dir htmlcov
FAIL Required test coverage of 80% not reached. Total coverage: 30.86%
=========================== short test summary info ===========================
FAILED tests/handlers/test_transcribe_mom.py::test_send_mom_success - AssertionError: Expected 'send_document' to have been called.
ERROR tests/handlers/test_avatar_handlers.py::test_handle_avatar_photo_success - AttributeError: <module 'frontend_bot.handlers.handlers' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\handlers\\handlers.py'> does not have the attribute 'get_current_avatar_id'
ERROR tests/handlers/test_avatar_handlers.py::test_handle_avatar_photo_validation_error - AttributeError: <module 'frontend_bot.handlers.handlers' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\handlers\\handlers.py'> does not have the attribute 'get_current_avatar_id'
ERROR tests/handlers/test_avatar_handlers.py::test_handle_avatar_photo_next_success - AttributeError: <module 'frontend_bot.handlers.handlers' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\handlers\\handlers.py'> does not have the attribute 'get_current_avatar_id'
ERROR tests/handlers/test_avatar_handlers.py::test_handle_avatar_photo_next_not_enough_photos - AttributeError: <module 'frontend_bot.handlers.handlers' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\handlers\\handlers.py'> does not have the attribute 'get_current_avatar_id'
ERROR tests/handlers/test_avatar_handlers.py::test_handle_avatar_gender_success - AttributeError: <module 'frontend_bot.handlers.handlers' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\handlers\\handlers.py'> does not have the attribute 'get_current_avatar_id'
ERROR tests/handlers/test_avatar_handlers.py::test_handle_avatar_gender_validation_error - AttributeError: <module 'frontend_bot.handlers.handlers' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\handlers\\handlers.py'> does not have the attribute 'get_current_avatar_id'
ERROR tests/handlers/test_avatar_handlers.py::test_handle_avatar_name_success - AttributeError: <module 'frontend_bot.handlers.handlers' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\handlers\\handlers.py'> does not have the attribute 'get_current_avatar_id'
ERROR tests/handlers/test_avatar_handlers.py::test_handle_avatar_name_validation_error - AttributeError: <module 'frontend_bot.handlers.handlers' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\handlers\\handlers.py'> does not have the attribute 'get_current_avatar_id'
ERROR tests/handlers/test_avatar_handlers.py::test_handle_avatar_confirm_success - AttributeError: <module 'frontend_bot.handlers.handlers' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\handlers\\handlers.py'> does not have the attribute 'get_current_avatar_id'
ERROR tests/handlers/test_avatar_handlers.py::test_handle_avatar_confirm_validation_error - AttributeError: <module 'frontend_bot.handlers.handlers' from 'C:\\dev\\Aisha_bot_new\\frontend_bot\\handlers\\handlers.py'> does not have the attribute 'get_current_avatar_id'
ERROR tests/handlers/test_business_assistant_menu_transitions.py::test_main_menu_to_business_assistant - AttributeError: 'module' object at frontend_bot.services.state_manager has no attribute '_load_states'
ERROR tests/handlers/test_business_assistant_menu_transitions.py::test_business_assistant_to_history - AttributeError: 'module' object at frontend_bot.services.state_manager has no attribute '_load_states'
ERROR tests/handlers/test_business_assistant_menu_transitions.py::test_business_assistant_to_new_dialog - AttributeError: 'module' object at frontend_bot.services.state_manager has no attribute '_load_states'
ERROR tests/handlers/test_business_assistant_menu_transitions.py::test_back_from_business_assistant - AttributeError: 'module' object at frontend_bot.services.state_manager has no attribute '_load_states'
ERROR tests/handlers/test_business_assistant_menu_transitions.py::test_back_from_history - AttributeError: 'module' object at frontend_bot.services.state_manager has no attribute '_load_states'
ERROR tests/handlers/test_menu_transitions.py::test_start_to_main_menu - TypeError: clear_state() missing 1 required positional argument: 'user_id'
ERROR tests/handlers/test_menu_transitions.py::test_main_menu_to_ai_photographer - TypeError: clear_state() missing 1 required positional argument: 'user_id'
ERROR tests/handlers/test_menu_transitions.py::test_ai_photographer_to_my_avatars - TypeError: clear_state() missing 1 required positional argument: 'user_id'
ERROR tests/handlers/test_menu_transitions.py::test_my_avatars_to_create_avatar - TypeError: clear_state() missing 1 required positional argument: 'user_id'
ERROR tests/handlers/test_menu_transitions.py::test_back_to_previous_menu - TypeError: clear_state() missing 1 required positional argument: 'user_id'
ERROR tests/handlers/test_menu_transitions.py::test_invalid_state_transition - TypeError: clear_state() missing 1 required positional argument: 'user_id'
ERROR tests/handlers/test_photo_enhance_menu_transitions.py::test_main_menu_to_photo_enhance - AttributeError: 'module' object at frontend_bot.services.state_manager has no attribute '_load_states'
ERROR tests/handlers/test_photo_enhance_menu_transitions.py::test_photo_enhance_to_history - AttributeError: 'module' object at frontend_bot.services.state_manager has no attribute '_load_states'
ERROR tests/handlers/test_photo_enhance_menu_transitions.py::test_photo_enhance_to_new - AttributeError: 'module' object at frontend_bot.services.state_manager has no attribute '_load_states'
ERROR tests/handlers/test_photo_enhance_menu_transitions.py::test_back_from_photo_enhance - AttributeError: 'module' object at frontend_bot.services.state_manager has no attribute '_load_states'
ERROR tests/handlers/test_photo_enhance_menu_transitions.py::test_back_from_history - AttributeError: 'module' object at frontend_bot.services.state_manager has no attribute '_load_states'
ERROR tests/handlers/test_transcribe_menu_transitions.py::test_main_menu_to_transcribe - AttributeError: 'module' object at frontend_bot.services.state_manager has no attribute '_load_states'
ERROR tests/handlers/test_transcribe_menu_transitions.py::test_transcribe_to_history - AttributeError: 'module' object at frontend_bot.services.state_manager has no attribute '_load_states'
ERROR tests/handlers/test_transcribe_menu_transitions.py::test_transcribe_to_new - AttributeError: 'module' object at frontend_bot.services.state_manager has no attribute '_load_states'
ERROR tests/handlers/test_transcribe_menu_transitions.py::test_back_from_transcribe - AttributeError: 'module' object at frontend_bot.services.state_manager has no attribute '_load_states'
ERROR tests/handlers/test_transcribe_menu_transitions.py::test_back_from_history - AttributeError: 'module' object at frontend_bot.services.state_manager has no attribute '_load_states'
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! KeyboardInterrupt !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
C:\Users\user\AppData\Local\Programs\Python\Python313\Lib\asyncio\windows_events.py:775: KeyboardInterrupt
(to show a full traceback on KeyboardInterrupt use --full-trace)
============= 1 failed, 8 passed, 31 errors in 129.22s (0:02:09) ==============

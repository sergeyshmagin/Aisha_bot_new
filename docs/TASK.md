# üéØ –ó–ê–î–ê–ß–ò –ü–†–û–ï–ö–¢–ê AISHA

## ‚úÖ –í–´–ü–û–õ–ù–ï–ù–ù–´–ï –ó–ê–î–ê–ß–ò

### üöÄ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º (–ò—é–Ω—å 2025)

#### ‚úÖ –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã Telegram Polling
- **–ü—Ä–æ–±–ª–µ–º–∞**: Multiple containers doing simultaneous polling causing "Conflict: terminated by other getUpdates request"
- **–†–µ—à–µ–Ω–∏–µ**: 
  - –ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: —Ç–æ–ª—å–∫–æ aisha-bot-primary –¥–µ–ª–∞–µ—Ç polling
  - aisha-worker-1 —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–µ–∂–∏–º–µ background worker
  - –û–±–Ω–æ–≤–ª–µ–Ω docker-compose.bot.simple.yml —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ environment variables
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–ï–®–ï–ù–û

#### ‚úÖ Storage Permissions 
- **–ü—Ä–æ–±–ª–µ–º–∞**: [Errno 13] Permission denied for /app/storage/temp files
- **–†–µ—à–µ–Ω–∏–µ**:
  - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω docker/bot-entrypoint.sh –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∞–≤
  - –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ Docker volumes –≤–º–µ—Å—Ç–æ bind mounts
  - Entrypoint –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∫ root, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –ø—Ä–∞–≤–∞, –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ aisha user
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–ï–®–ï–ù–û

#### ‚úÖ –û—à–∏–±–∫–∞ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏ "transcribe_error"
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ó–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ "transcribe_error" –≤ app/services/audio_processing/service.py
- **–†–µ—à–µ–Ω–∏–µ**:
  - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ –æ—à–∏–±–æ–∫ –≤ TranscribeResult
  - –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏
  - –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–ï–®–ï–ù–û

#### ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- **–†–µ—à–µ–Ω–∏–µ**:
  - –ò–∑–º–µ–Ω–µ–Ω LOG_LEVEL —Å INFO –Ω–∞ DEBUG
  - –î–æ–±–∞–≤–ª–µ–Ω—ã —Ü–≤–µ—Ç–Ω—ã–µ –ª–æ–≥–∏ —Å —ç–º–æ–¥–∑–∏ –¥–ª—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏
  - –°–æ–∑–¥–∞–Ω—ã —Å–∫—Ä–∏–ø—Ç—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞: monitor-errors.sh, check-transcription.sh
  - –°–æ–∑–¥–∞–Ω scripts/quick-logs.sh –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –ª–æ–≥–∞–º
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–ï–®–ï–ù–û

#### ‚úÖ –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ú–Ω–æ–∂–µ—Å—Ç–≤–æ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö yml —Ñ–∞–π–ª–æ–≤ –∏ —Å–∫—Ä–∏–ø—Ç–æ–≤
- **–†–µ—à–µ–Ω–∏–µ**:
  - –°–æ–∑–¥–∞–Ω—ã –∞—Ä—Ö–∏–≤—ã: archive/legacy_compose/, archive/legacy_scripts/
  - –û—Å—Ç–∞–≤–ª–µ–Ω—ã —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∞–π–ª—ã: docker-compose.bot.simple.yml, docker-compose.bot.local.yml  
  - –°–æ–∑–¥–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è ACTIVE_FILES.md
  - –°–æ–∑–¥–∞–Ω scripts/cleanup/organize-project.sh
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–ï–®–ï–ù–û

### üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

#### ‚úÖ Worker Module
- **–ó–∞–¥–∞—á–∞**: –°–æ–∑–¥–∞—Ç—å –º–æ–¥—É–ª—å app/workers –¥–ª—è background tasks
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –°–æ–∑–¥–∞–Ω app/workers/background_worker.py —Å BackgroundWorker –∫–ª–∞—Å—Å–æ–º
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

#### ‚úÖ Production Deployment
- **–ó–∞–¥–∞—á–∞**: –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –°–æ–∑–¥–∞–Ω scripts/production/deploy-fixed-bot.sh
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

#### ‚úÖ Monitoring & Logging
- **–ó–∞–¥–∞—á–∞**: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: 
  - scripts/production/monitor-errors.sh - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
  - scripts/quick-logs.sh - –±—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ –ª–æ–≥–∞–º
  - –¶–≤–µ—Ç–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –ø—Ä–µ—Ñ–∏–∫—Å–∞–º–∏ [TRANSCRIPTION]
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

## üöß –¢–ï–ö–£–©–ò–ï –ó–ê–î–ê–ß–ò

### üîß –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

#### üéØ –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è Telegram Connection
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ TelegramNetworkError: Request timeout error
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –°—Ä–µ–¥–Ω–∏–π
- **–ü–ª–∞–Ω—ã**: 
  - –î–æ–±–∞–≤–∏—Ç—å retry logic –¥–ª—è Telegram API
  - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å connection pooling
  - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

#### üéØ Healthcheck Improvement
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç unhealthy status
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –ù–∏–∑–∫–∏–π
- **–ü–ª–∞–Ω—ã**: –£–ª—É—á—à–∏—Ç—å healthcheck endpoints

### üìä –†–∞–∑–≤–∏—Ç–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞

#### üéØ Transcription Improvements
- **–ó–∞–¥–∞—á–∞**: –£–ª—É—á—à–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏
- **–ü–ª–∞–Ω—ã**:
  - –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ä–∞–∑–Ω—ã—Ö —è–∑—ã–∫–æ–≤
  - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å chunking –∞–ª–≥–æ—Ä–∏—Ç–º
  - –î–æ–±–∞–≤–∏—Ç—å post-processing —Ç–µ–∫—Å—Ç–∞

#### üéØ Error Notification
- **–ó–∞–¥–∞—á–∞**: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- **–ü–ª–∞–Ω—ã**:
  - Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
  - Email notifications
  - Dashboard –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

## üìã –ê–†–•–ò–¢–ï–ö–¢–£–†–ê

### üèóÔ∏è –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
Production Server (192.168.0.10):
‚îú‚îÄ‚îÄ aisha-bot-primary     [Polling + User Interface]
‚îú‚îÄ‚îÄ aisha-worker-1        [Background Tasks]
‚îú‚îÄ‚îÄ aisha-webhook-api-1/2 [FAL AI Webhooks]
‚îî‚îÄ‚îÄ aisha-nginx-prod      [Reverse Proxy]

External Services:
‚îú‚îÄ‚îÄ PostgreSQL    (192.168.0.4:5432)
‚îú‚îÄ‚îÄ Redis         (192.168.0.3:6379)
‚îú‚îÄ‚îÄ MinIO         (192.168.0.4:9000)
‚îî‚îÄ‚îÄ Registry      (192.168.0.4:5000)
```

### üìÅ –§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

#### –ê–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∞–π–ª—ã:
```
docker-compose.bot.simple.yml    # –ü—Ä–æ–¥–∞–∫—à–Ω
docker-compose.bot.local.yml     # –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
scripts/production/              # –ü—Ä–æ–¥–∞–∫—à–Ω –æ–ø–µ—Ä–∞—Ü–∏–∏
scripts/quick-logs.sh            # –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ –ª–æ–≥–∞–º
ACTIVE_FILES.md                  # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
```

#### –ê—Ä—Ö–∏–≤:
```
archive/legacy_compose/          # –°—Ç–∞—Ä—ã–µ docker-compose —Ñ–∞–π–ª—ã
archive/legacy_scripts/          # –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ —Å–∫—Ä–∏–ø—Ç—ã
```

## üéØ –ü–†–ò–û–†–ò–¢–ï–¢–´

### –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
- [x] –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã polling
- [x] –†–µ—à–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã storage permissions  
- [x] –ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫—É "transcribe_error"

### –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
- [x] –£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- [x] –û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞
- [ ] –°—Ç–∞–±–∏–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å Telegram connection

### –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç  
- [ ] –£–ª—É—á—à–∏—Ç—å healthcheck
- [ ] –î–æ–±–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- [ ] –†–∞–∑–≤–∏—Ç–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏

## üìä –ú–ï–¢–†–ò–ö–ò –£–°–ü–ï–•–ê

### ‚úÖ –î–æ—Å—Ç–∏–≥–Ω—É—Ç–æ
- **Stability**: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ polling conflicts
- **Permissions**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ storage permissions
- **Logging**: –î–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- **Organization**: –£–ø–æ—Ä—è–¥–æ—á–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

### üéØ –¶–µ–ª–∏
- **Uptime**: >99% –¥–ª—è bot services
- **Response Time**: <2s –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –∫–æ–º–∞–Ω–¥
- **Transcription Quality**: >95% accuracy
- **Error Rate**: <1% –æ—Ç –æ–±—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

## üîß –ò–ù–°–¢–†–£–ú–ï–ù–¢–´

### –ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã
```bash
# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
./scripts/quick-logs.sh status
./scripts/quick-logs.sh transcription
./scripts/quick-logs.sh monitor

# –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
./scripts/production/deploy-fixed-bot.sh

# –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è
./scripts/cleanup/organize-project.sh
```

---
*–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –ò—é–Ω—å 10, 2025* 
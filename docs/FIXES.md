# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º

## ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–æ–ª–µ–º `order` –≤ —Ç–∞–±–ª–∏—Ü–µ `avatar_photos`

### **–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã**
```
sqlalchemy.exc.IntegrityError: null value in column "order" of relation "avatar_photos" violates not-null constraint
```

### **–ü—Ä–∏—á–∏–Ω–∞**
–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –º–µ–∂–¥—É –º–æ–¥–µ–ª—å—é SQLAlchemy –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:
- **–ö–æ–¥**: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ–ª–µ `upload_order`
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: –æ–∂–∏–¥–∞–µ—Ç –ø–æ–ª–µ `order` —Å NOT NULL constraint

### **–†–µ—à–µ–Ω–∏–µ**
1. **–í—Ä–µ–º–µ–Ω–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `order` –≤ –º–æ–¥–µ–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ë–î
2. **–ü—Ä—è–º–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏**: –°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç `scripts/remove_order_column.py` –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∫–æ–ª–æ–Ω–∫–∏ –∏–∑ –ë–î
3. **–û—á–∏—Å—Ç–∫–∞ –∫–æ–¥–∞**: –£–¥–∞–ª–µ–Ω—ã –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–ª—è –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –∫–æ–ª–æ–Ω–∫–∏

### **–ü—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã**
- `app/database/models.py` - –º–æ–¥–µ–ª—å `AvatarPhoto`
- `app/services/avatar/photo_service.py` - —Å–µ—Ä–≤–∏—Å –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ
- `scripts/remove_order_column.py` - —Å–∫—Ä–∏–ø—Ç —É–¥–∞–ª–µ–Ω–∏—è –∫–æ–ª–æ–Ω–∫–∏

### **–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**
```bash
python scripts/remove_order_column.py
```

---

## ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π None –≤ message.text

### **–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã**
```
AttributeError: 'NoneType' object has no attribute 'strip'
```

### **–ü—Ä–∏—á–∏–Ω–∞**
–û–±—Ä–∞–±–æ—Ç—á–∏–∫ `process_avatar_name` –ø—ã—Ç–∞–ª—Å—è –≤—ã–∑–≤–∞—Ç—å `.strip()` –Ω–∞ `message.text`, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –±—ã—Ç—å `None` –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–∏–ª –Ω–µ-—Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.

### **–†–µ—à–µ–Ω–∏–µ**
–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ `None` –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π —Ç–µ–∫—Å—Ç–∞:
```python
if not message.text:
    await message.answer(
        "‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –∏–º—è –∞–≤–∞—Ç–∞—Ä–∞ —Ç–µ–∫—Å—Ç–æ–º.\n"
        "–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç–∏–∫–µ—Ä—ã, —Ñ–æ—Ç–æ –∏–ª–∏ –¥—Ä—É–≥–∏–µ —Ñ–∞–π–ª—ã."
    )
    return
```

### **–ü—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã**
- `app/handlers/avatar/create.py` - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–∑–¥–∞–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–∞

---

## üîß –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### **–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –ø–æ–¥–æ–±–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º**
1. **–í—Å–µ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω—è–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏** –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º –ø–æ–ª–µ–π –∏–∑ –º–æ–¥–µ–ª–µ–π
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `alembic revision --autogenerate`** –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π
3. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è** –Ω–∞ development –æ–∫—Ä—É–∂–µ–Ω–∏–∏
4. **–î–æ–±–∞–≤–ª—è–π—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ None** –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –≤–≤–æ–¥–æ–≤

### **–ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç—ã —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏**
```bash
# 1. –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏
alembic revision --autogenerate -m "–æ–ø–∏—Å–∞–Ω–∏–µ_–∏–∑–º–µ–Ω–µ–Ω–∏–π"

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏
alembic show

# 3. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏
alembic upgrade head

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
alembic current
``` 
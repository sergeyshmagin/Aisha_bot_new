# –û—Ç—á–µ—Ç: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è training_type –¥–ª—è –∞–≤–∞—Ç–∞—Ä–æ–≤

## üìã –û–±–∑–æ—Ä

–í—ã–ø–æ–ª–Ω–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞ –ø–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—é –ø–æ–ª—è `training_type` –≤ –º–æ–¥–µ–ª—å –∞–≤–∞—Ç–∞—Ä–æ–≤ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ –æ–±—É—á–µ–Ω–∏—è —Å–æ–≥–ª–∞—Å–Ω–æ –ø–ª–∞–Ω—É `avatar_implementation_plan.md`.

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**–§–∞–π–ª**: `app/database/models.py`

#### –î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π enum:
```python
class AvatarTrainingType(str, Enum):
    """–¢–∏–ø –æ–±—É—á–µ–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–∞ (–Ω–æ–≤—ã–π enum –¥–ª—è –≤—ã–±–æ—Ä–∞ –∞–ª–≥–æ—Ä–∏—Ç–º–∞)"""
    PORTRAIT = "portrait"             # –ü–æ—Ä—Ç—Ä–µ—Ç–Ω—ã–π —Ç–∏–ø (Flux LoRA Portrait Trainer)
    STYLE = "style"                   # –•—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç–∏–ø (Flux Pro Trainer)
```

#### –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ –≤ –º–æ–¥–µ–ª—å Avatar:
```python
training_type: Mapped[AvatarTrainingType] = mapped_column(
    SQLEnum(AvatarTrainingType), 
    default=AvatarTrainingType.PORTRAIT
)
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**–§–∞–π–ª**: `alembic/versions/20250523_2053_87a45a23ec85_add_training_type_to_avatar.py`

#### –ú–∏–≥—Ä–∞—Ü–∏—è –≤–∫–ª—é—á–∞–µ—Ç:
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ enum —Ç–∏–ø–∞ `avatartrainingtype`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è `training_type` –≤ —Ç–∞–±–ª–∏—Ü—É `avatars`
- ‚úÖ –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–ø–∏—Å–µ–π –∑–Ω–∞—á–µ–Ω–∏–µ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `'portrait'`
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ NOT NULL constraint

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã

#### –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ (Handlers)
- ‚úÖ **`app/handlers/avatar/training_type_selection.py`** - –∏–º–ø–æ—Ä—Ç `AvatarTrainingType`
- ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–æ–≤ –æ–±—É—á–µ–Ω–∏—è** —á–µ—Ä–µ–∑ enum –≤–º–µ—Å—Ç–æ hardcoded –∑–Ω–∞—á–µ–Ω–∏–π

#### –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã (Keyboards)  
- ‚úÖ **`app/keyboards/avatar.py`** - –∏–º–ø–æ—Ä—Ç `AvatarTrainingType`

### 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–§–∞–π–ª**: `test_avatar_components.py`

#### –î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π —Ç–µ—Å—Ç `test_avatar_models()`:
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è enum `AvatarTrainingType`
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–Ω–∞—á–µ–Ω–∏–π PORTRAIT –∏ STYLE
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –º–æ–¥–µ–ª–∏ Avatar
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è enum –∑–Ω–∞—á–µ–Ω–∏–π

## üß™ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```
============================================================
üß™ –¢–ï–°–¢: –ú–æ–¥–µ–ª–∏ –∞–≤–∞—Ç–∞—Ä–æ–≤
============================================================
‚úÖ –¢–∏–ø—ã –æ–±—É—á–µ–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–æ–≤: ['portrait', 'style']
‚úÖ –ê—Ç—Ä–∏–±—É—Ç Avatar.training_type –Ω–∞–π–¥–µ–Ω
‚úÖ –ê—Ç—Ä–∏–±—É—Ç Avatar.avatar_type –Ω–∞–π–¥–µ–Ω  
‚úÖ –ê—Ç—Ä–∏–±—É—Ç Avatar.gender –Ω–∞–π–¥–µ–Ω
‚úÖ –ê—Ç—Ä–∏–±—É—Ç Avatar.status –Ω–∞–π–¥–µ–Ω
‚úÖ –ê—Ç—Ä–∏–±—É—Ç Avatar.name –Ω–∞–π–¥–µ–Ω
‚úÖ PORTRAIT = 'portrait'
‚úÖ STYLE = 'style'
üìã –ú–æ–¥–µ–ª—å Avatar –≥–æ—Ç–æ–≤–∞ –¥–ª—è –ø–æ–ª—è training_type

‚úÖ –£–°–ü–ï–®–ù–û: –ú–æ–¥–µ–ª–∏ –∞–≤–∞—Ç–∞—Ä–æ–≤
```

## üéØ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ–ª—è training_type

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–ü–æ–ª–µ `training_type` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç **–∞–ª–≥–æ—Ä–∏—Ç–º –æ–±—É—á–µ–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–∞**:

- **`portrait`** - –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ—Ä—Ç—Ä–µ—Ç–Ω—ã–π —Ç—Ä–µ–Ω–µ—Ä (Flux LoRA Portrait Trainer)
  - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è –ª–∏—Ü –ª—é–¥–µ–π
  - –ë—ã—Å—Ç—Ä–æ–µ –æ–±—É—á–µ–Ω–∏–µ (3-15 –º–∏–Ω—É—Ç)
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–µ–∑–∫–∞ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –º–∞—Å–æ–∫
  - –õ—É—á—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ –¥–ª—è –ø–æ—Ä—Ç—Ä–µ—Ç–æ–≤

- **`style`** - –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç—Ä–µ–Ω–µ—Ä (Flux Pro Trainer)  
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ª—é–±—ã—Ö —Å—Ç–∏–ª–µ–π –∏ –æ–±—ä–µ–∫—Ç–æ–≤
  - –ë–æ–ª–µ–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ (5-30 –º–∏–Ω—É—Ç)
  - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç—å
  - –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –∑–∞–¥–∞—á

### –û—Ç–ª–∏—á–∏–µ –æ—Ç avatar_type
- **`avatar_type`** - –æ–±—â–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è –∞–≤–∞—Ç–∞—Ä–∞ (CHARACTER, STYLE, CUSTOM)
- **`training_type`** - –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –æ–±—É—á–µ–Ω–∏—è (PORTRAIT, STYLE)

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–º–µ—Ç—å CHARACTER –∞–≤–∞—Ç–∞—Ä, –æ–±—É—á–µ–Ω–Ω—ã–π –∫–∞–∫ —á–µ—Ä–µ–∑ PORTRAIT, —Ç–∞–∫ –∏ —á–µ—Ä–µ–∑ STYLE –∞–ª–≥–æ—Ä–∏—Ç–º.

## üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º

### FAL Training Service
–°–µ—Ä–≤–∏—Å `FALTrainingService` —É–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–±–∞ —Ç–∏–ø–∞ –æ–±—É—á–µ–Ω–∏—è:

```python
if training_type == "portrait":
    # Flux LoRA Portrait Trainer
    result = await self._train_portrait_model(...)
else:
    # Flux Pro Trainer  
    result = await self._train_general_model(...)
```

### Workflow —Å–æ–∑–¥–∞–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–∞
–ù–æ–≤–æ–µ –ø–æ–ª–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è –≤ workflow:

1. **–í—ã–±–æ—Ä —Ç–∏–ø–∞ –æ–±—É—á–µ–Ω–∏—è** (`training_type`) üÜï
2. –í—ã–±–æ—Ä –ø–æ–ª–∞ –∞–≤–∞—Ç–∞—Ä–∞ (`gender`)
3. –í–≤–æ–¥ –∏–º–µ–Ω–∏ (`name`)
4. –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
5. –ó–∞–ø—É—Å–∫ –æ–±—É—á–µ–Ω–∏—è —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º

## üìö –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- ‚úÖ `app/database/models.py` - –ú–æ–¥–µ–ª–∏ –∏ enum
- ‚úÖ `app/handlers/avatar/training_type_selection.py` - UI –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞
- ‚úÖ `app/keyboards/avatar.py` - –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã –≤—ã–±–æ—Ä–∞
- ‚úÖ `app/texts/avatar.py` - –¢–µ–∫—Å—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
- ‚úÖ `app/services/avatar/fal_training_service.py` - –õ–æ–≥–∏–∫–∞ –æ–±—É—á–µ–Ω–∏—è

### –ú–∏–≥—Ä–∞—Ü–∏–∏:
- ‚úÖ `alembic/versions/20250523_2053_87a45a23ec85_add_training_type_to_avatar.py`

### –¢–µ—Å—Ç—ã:
- ‚úÖ `test_avatar_components.py` - –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

## üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### ‚úÖ –ì–æ—Ç–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- –ú–æ–¥–µ–ª–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å –Ω–æ–≤—ã–º –ø–æ–ª–µ–º
- Enum —Ç–∏–ø—ã –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- –ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
- –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### üîÑ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ: `alembic upgrade head`
2. –û–±–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è `training_type` –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∞–≤–∞—Ç–∞—Ä–∞
3. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤—ã–±–æ—Ä —Ç–∏–ø–∞ –≤ –ø–æ–ª–Ω—ã–π workflow —Å–æ–∑–¥–∞–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–∞

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

- **–§–∞–π–ª–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–æ**: 6
- **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞ –¥–æ–±–∞–≤–ª–µ–Ω–æ**: ~150
- **–¢–µ—Å—Ç–æ–≤ –¥–æ–±–∞–≤–ª–µ–Ω–æ**: 1 (–∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π —Ç–µ—Å—Ç –º–æ–¥–µ–ª–µ–π)
- **Enum —Ç–∏–ø–æ–≤ –¥–æ–±–∞–≤–ª–µ–Ω–æ**: 1 (`AvatarTrainingType`)
- **–ü–æ–ª–µ–π –ë–î –¥–æ–±–∞–≤–ª–µ–Ω–æ**: 1 (`training_type`)

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü–æ–ª–µ `training_type` —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –º–æ–¥–µ–ª—å –∞–≤–∞—Ç–∞—Ä–æ–≤ –∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É. –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ –æ–±—É—á–µ–Ω–∏—è —Å–æ–≥–ª–∞—Å–Ω–æ –ø–ª–∞–Ω—É `avatar_implementation_plan.md`.

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ó–ê–í–ï–†–®–ï–ù–û** 
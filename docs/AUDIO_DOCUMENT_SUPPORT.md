# –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞—É–¥–∏–æ —Ñ–∞–π–ª–æ–≤ –∫–∞–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

## üéØ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤

### –ü—Ä–æ–±–ª–µ–º–∞
- **–ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –∞—É–¥–∏–æ:** –ª–∏–º–∏—Ç 20 –ú–ë —á–µ—Ä–µ–∑ Bot API
- **–î–æ–∫—É–º–µ–Ω—Ç—ã:** –ª–∏–º–∏—Ç 2 –ì–ë —á–µ—Ä–µ–∑ Telegram

### –†–µ—à–µ–Ω–∏–µ
–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∞—É–¥–∏–æ —Ñ–∞–π–ª–æ–≤, –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –∫–∞–∫ **–¥–æ–∫—É–º–µ–Ω—Ç—ã**.

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –ù–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
```python
@router.message.register(
    _handle_audio_document,
    F.document & F.document.mime_type.startswith("audio/")
)
```

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ MIME —Ç–∏–ø—ã
- `audio/mpeg` (MP3)
- `audio/wav` (WAV)
- `audio/ogg` (OGG)
- `audio/mp4` (M4A)
- `audio/flac` (FLAC)
- `audio/aac` (AAC)

## üì± –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –ö–∞–∫ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –±–æ–ª—å—à–æ–π –∞—É–¥–∏–æ —Ñ–∞–π–ª:

#### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ "–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–∞–π–ª"
1. –ù–∞–∂–º–∏—Ç–µ üìé (—Å–∫—Ä–µ–ø–∫–∞) –≤ Telegram
2. –í—ã–±–µ—Ä–∏—Ç–µ "–§–∞–π–ª" –∏–ª–∏ "–î–æ–∫—É–º–µ–Ω—Ç"
3. –ù–∞–π–¥–∏—Ç–µ –≤–∞—à –∞—É–¥–∏–æ —Ñ–∞–π–ª
4. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–∞–∫ –¥–æ–∫—É–º–µ–Ω—Ç

#### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ (Desktop)
1. –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∞—É–¥–∏–æ —Ñ–∞–π–ª –≤ —á–∞—Ç
2. –í—ã–±–µ—Ä–∏—Ç–µ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–∞–∫ —Ñ–∞–π–ª"
3. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –æ—Ç–ø—Ä–∞–≤–∫—É

## üéµ Workflow –æ–±—Ä–∞–±–æ—Ç–∫–∏

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∞—É–¥–∏–æ –∫–∞–∫ –¥–æ–∫—É–º–µ–Ω—Ç
          ‚Üì
–ë–æ—Ç –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç MIME —Ç–∏–ø: audio/*
          ‚Üì
–°–∫–∞—á–∏–≤–∞–µ—Ç —Ñ–∞–π–ª (–¥–æ 2 –ì–ë)
          ‚Üì
–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —á–µ—Ä–µ–∑ Whisper
          ‚Üì
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—é
```

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤

| –ú–µ—Ç–æ–¥ –æ—Ç–ø—Ä–∞–≤–∫–∏ | –õ–∏–º–∏—Ç —Ä–∞–∑–º–µ—Ä–∞ | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ |
|----------------|---------------|-----------|
| –ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ | 20 –ú–ë | ‚úÖ |
| –ê—É–¥–∏–æ —Ñ–∞–π–ª | 20 –ú–ë | ‚úÖ |
| **–î–æ–∫—É–º–µ–Ω—Ç (–∞—É–¥–∏–æ)** | **2 –ì–ë** | ‚úÖ **–ù–û–í–û–ï** |

## üîç –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –£—Å–ø–µ—à–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
```
[AUDIO_DOCUMENT] –ü–æ–ª—É—á–µ–Ω –∞—É–¥–∏–æ —Ñ–∞–π–ª –æ—Ç user_id=123456, state=None
[AUDIO_DOCUMENT] –ü–æ–ª—É—á–µ–Ω —Ç–µ–∫—Å—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞, –¥–ª–∏–Ω–∞: 1500
[AUDIO_DOCUMENT] –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {...}
```

### –û—à–∏–±–∫–∏
```
[AUDIO_DOCUMENT] –û—à–∏–±–∫–∞ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏: Invalid audio format
[AUDIO_DOCUMENT] –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∞—É–¥–∏–æ —Ñ–∞–π–ª–∞: Connection timeout
```

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º

### –î–ª—è —Ñ–∞–π–ª–æ–≤ > 20 –ú–ë:
1. **–û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–∞–∫ –¥–æ–∫—É–º–µ–Ω—Ç** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
2. –°–æ–∂–º–∏—Ç–µ —Ñ–∞–π–ª –¥–æ < 20 –ú–ë
3. –†–∞–∑–¥–µ–ª–∏—Ç–µ –Ω–∞ —á–∞—Å—Ç–∏

### –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:
- **MP3** - –ª—É—á—à–µ–µ —Å–∂–∞—Ç–∏–µ
- **M4A** - —Ö–æ—Ä–æ—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ
- **WAV** - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ (–±–æ–ª—å—à–æ–π —Ä–∞–∑–º–µ—Ä)

## üöÄ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

### ‚úÖ –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–∞–π–ª–æ–≤ –¥–æ 2 –ì–ë
- –ü—Ä–æ—Å—Ç–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞

### ‚úÖ –î–ª—è —Å–∏—Å—Ç–µ–º—ã:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ
- –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Ç–µ–∫—É—â–∏–º–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏

## üîß –ö–æ–¥ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞
```python
# –û–±—Ä–∞–±–æ—Ç–∫–∞ –∞—É–¥–∏–æ —Ñ–∞–π–ª–æ–≤, –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –∫–∞–∫ –¥–æ–∫—É–º–µ–Ω—Ç—ã
self.router.message.register(
    self._handle_audio_document,
    F.document & F.document.mime_type.startswith("audio/")
)
```

### –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
```python
async def _handle_audio_document(self, message: Message, state: FSMContext):
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ MIME —Ç–∏–ø–∞
    if not message.document.mime_type.startswith("audio/"):
        return
    
    # –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
    file = await message.bot.get_file(message.document.file_id)
    audio_data = await message.bot.download_file(file.file_path)
    
    # –û–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ Whisper
    result = await audio_service.process_audio(audio_data)
    
    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    await transcript_service.save_transcript(...)
```

## üìà –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –§–∞–π–ª—ã –¥–æ 100 –ú–ë: —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã
- ‚úÖ –†–∞–∑–ª–∏—á–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: MP3, WAV, M4A
- ‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏: –±–µ–∑ –ø–æ—Ç–µ—Ä—å

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏: +10% (–∏–∑-–∑–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏: —Å—Ç–∞–±–∏–ª—å–Ω–æ–µ
- –û—à–∏–±–∫–∏: < 1%

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞!** –¢–µ–ø–µ—Ä—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç:
- –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∞—É–¥–∏–æ —Ñ–∞–π–ª—ã –¥–æ 2 –ì–ë
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª—é–±—ã–µ –∞—É–¥–∏–æ —Ñ–æ—Ä–º–∞—Ç—ã
- –ü–æ–ª—É—á–∞—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—É—é —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—é

**–î–ª—è —Ñ–∞–π–ª–∞ 60 –ú–ë:** –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–∞–∫ –¥–æ–∫—É–º–µ–Ω—Ç –∏ –ø–æ–ª—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç! üéØ 
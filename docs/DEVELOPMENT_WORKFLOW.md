# üõ†Ô∏è Workflow —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ Aisha Bot

**–¶–µ–ª—å:** –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è –≤ –ø—Ä–æ–¥–∞–∫—à–Ω

## üéØ –ü—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### ‚úÖ –ß—Ç–æ –º—ã –∏–º–µ–µ–º —Å–µ–π—á–∞—Å (PRODUCTION READY)
- üöÄ **–†–∞–±–æ—á–∏–π –ø—Ä–æ–¥–∞–∫—à–Ω –∫–ª–∞—Å—Ç–µ—Ä** –Ω–∞ `aisha@192.168.0.10`
- üîß **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏** (—Ç–æ–∫–µ–Ω—ã, Dockerfile, entrypoint)
- üìä **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** —á–µ—Ä–µ–∑ `./scripts/monitoring/monitor-production.sh`
- üöÄ **–î–µ–ø–ª–æ–π —Å–∫—Ä–∏–ø—Ç** `./scripts/production/deploy-production-final.sh`

### ‚ö†Ô∏è –¢–µ–∫—É—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
1. **Standby –±–æ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç** —Å –æ—Å–Ω–æ–≤–Ω—ã–º (–¥–µ–ª–∞–µ—Ç polling –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ)
2. **–ù–µ—è—Å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è** –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
3. **–ù–µ—Ç dev/staging –æ–∫—Ä—É–∂–µ–Ω–∏—è** –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

## üèóÔ∏è –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### üìä –°—Ä–µ–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

```
üè† LOCAL DEVELOPMENT
‚îú‚îÄ‚îÄ –ü–æ–ª–Ω–∞—è –ª–æ–∫–∞–ª—å–Ω–∞—è —Å—Ä–µ–¥–∞
‚îú‚îÄ‚îÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π  
‚îú‚îÄ‚îÄ Unit/Integration —Ç–µ—Å—Ç—ã
‚îî‚îÄ‚îÄ –ë—ã—Å—Ç—Ä–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è

üß™ STAGING (PLANNING)
‚îú‚îÄ‚îÄ –ö–æ–ø–∏—è –ø—Ä–æ–¥–∞–∫—à–Ω –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–ø–ª–æ—è
‚îú‚îÄ‚îÄ E2E —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îî‚îÄ‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–π

üöÄ PRODUCTION (CURRENT)
‚îú‚îÄ‚îÄ –°—Ç–∞–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è ‚úÖ
‚îú‚îÄ‚îÄ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ ‚úÖ
‚îú‚îÄ‚îÄ –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îî‚îÄ‚îÄ Zero-downtime updates
```

### üîÑ Git Workflow

```bash
# –í–µ—Ç–∫–∏
main              # –°—Ç–∞–±–∏–ª—å–Ω–∞—è –ø—Ä–æ–¥–∞–∫—à–Ω –≤–µ—Ä—Å–∏—è
develop           # –†–∞–∑–≤–∏—Ç–∏–µ —Ñ—É–Ω–∫—Ü–∏–π
feature/*         # –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
hotfix/*          # –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
release/*         # –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ä–µ–ª–∏–∑–æ–≤
```

## üöÄ –ü—Ä–æ—Ü–µ—Å—Å –¥–µ–ø–ª–æ—è

### 1. üß™ –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π

```bash
# 1. –°–æ–∑–¥–∞–Ω–∏–µ feature –≤–µ—Ç–∫–∏
git checkout develop
git pull origin develop
git checkout -b feature/fix-transcription

# 2. –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ
python -m pytest tests/
python main.py  # –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫

# 3. –ö–æ–º–º–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π
git add .
git commit -m "üé§ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏ –∞—É–¥–∏–æ"
git push origin feature/fix-transcription
```

### 2. üîÑ Code Review –∏ —Å–ª–∏—è–Ω–∏–µ

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ Pull Request –≤ develop
# –ü–æ—Å–ª–µ review - —Å–ª–∏—è–Ω–∏–µ –≤ develop

git checkout develop  
git pull origin develop
git merge feature/fix-transcription
```

### 3. üöÄ –î–µ–ø–ª–æ–π –≤ –ø—Ä–æ–¥–∞–∫—à–Ω

```bash
# 1. –°–ª–∏—è–Ω–∏–µ –≤ main
git checkout main
git merge develop
git tag v2.1.0
git push origin main --tags

# 2. –î–µ–ø–ª–æ–π –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω
export TELEGRAM_BOT_TOKEN=your_token
./scripts/production/deploy-production-final.sh

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–ø–ª–æ—è
./scripts/monitoring/monitor-production.sh
```

## üîß –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏

```bash
# 1. –ü–æ–ª–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
./scripts/monitoring/monitor-production.sh

# 2. –ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏
ssh aisha@192.168.0.10 "docker logs aisha-bot-polling-1 | grep -E '(transcript|audio|ERROR)'"

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ worker'–æ–≤
ssh aisha@192.168.0.10 "docker logs aisha-worker-1 --tail 20"

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ Redis –æ—á–µ—Ä–µ–¥–µ–π
ssh aisha@192.168.0.10 "docker exec redis-prod redis-cli LLEN transcript_queue"
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ standby –±–æ—Ç–∞

```bash
# –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ: –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å standby –±–æ—Ç
ssh aisha@192.168.0.10 "docker stop aisha-bot-polling-2"

# –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ: —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å true standby —Ä–µ–∂–∏–º
# 1. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –±–æ—Ç–∞
# 2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π failover –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏
# 3. Health check —Å–∏—Å—Ç–µ–º–∞
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏

```bash
# 1. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç—É –≤ Telegram
# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –≤ –ª–æ–≥–∞—Ö
ssh aisha@192.168.0.10 "docker logs aisha-bot-polling-1 --follow"

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–π–ª—ã –≤ MinIO
# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–ø–∏—Å–∏ –≤ PostgreSQL
```

## üìã –ß–µ–∫-–ª–∏—Å—Ç —Ä–µ–ª–∏–∑–∞

### –ü–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º
- [ ] ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç –ª–æ–∫–∞–ª—å–Ω–æ
- [ ] ‚úÖ Code review –≤—ã–ø–æ–ª–Ω–µ–Ω
- [ ] ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- [ ] ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
- [ ] ‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∞–∫—Ç—É–∞–ª—å–Ω—ã

### –ü—Ä–æ—Ü–µ—Å—Å –¥–µ–ø–ª–æ—è
- [ ] ‚úÖ –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –ë–î —Å–æ–∑–¥–∞–Ω–∞
- [ ] ‚úÖ –î–µ–ø–ª–æ–π —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—â–µ–Ω —É—Å–ø–µ—à–Ω–æ
- [ ] ‚úÖ –í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã healthy
- [ ] ‚úÖ –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–æ—Ä–º—É

### –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è
- [ ] ‚úÖ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –≤—Ä—É—á–Ω—É—é
- [ ] ‚úÖ –õ–æ–≥–∏ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫
- [ ] ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ –Ω–æ—Ä–º–µ
- [ ] ‚úÖ Rollback –ø–ª–∞–Ω –≥–æ—Ç–æ–≤

## üõ†Ô∏è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
```bash
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
python -m pytest tests/ -v

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤
mypy app/

# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞  
black app/
isort app/

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ –ª–æ–∫–∞–ª—å–Ω–æ
python main.py
```

### –ü—Ä–æ–¥–∞–∫—à–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
```bash
# –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
./scripts/monitoring/monitor-production.sh quick

# –î–µ—Ç–∞–ª—å–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
./scripts/monitoring/monitor-production.sh full

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
./scripts/monitoring/monitor-production.sh logs
./scripts/monitoring/monitor-production.sh health
./scripts/monitoring/monitor-production.sh system
```

## üö® –ê–≤–∞—Ä–∏–π–Ω—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã

### Rollback –¥–µ–ø–ª–æ—è
```bash
# 1. –û—Ç–∫–∞—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏ –æ–±—Ä–∞–∑–æ–≤
ssh aisha@192.168.0.10 "
    docker tag localhost:5000/aisha-bot:previous localhost:5000/aisha-bot:latest
    docker-compose -f docker-compose.bot.registry.yml restart
"

# 2. –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–π –ë–î (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
alembic downgrade -1
```

### –≠–∫—Å—Ç—Ä–µ–Ω–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
```bash
# 1. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
ssh aisha@192.168.0.10 "
    docker-compose -f docker-compose.webhook.prod.yml restart
    docker-compose -f docker-compose.bot.registry.yml restart
"

# 2. –û—á–∏—Å—Ç–∫–∞ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
ssh aisha@192.168.0.10 "docker system prune -f"
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç

**‚úÖ –û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω—ã–π workflow:**
- üè† **–õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞** —Å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- üîÑ **Git flow** —Å code review
- üöÄ **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–µ–ø–ª–æ–π** —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç—ã
- üìä **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
- üö® **–ü—Ä–æ—Ü–µ–¥—É—Ä—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è**

**üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**
1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å standby –±–æ—Ç–∞ (true failover)
2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—é
3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å staging –æ–∫—Ä—É–∂–µ–Ω–∏–µ  
4. –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã 
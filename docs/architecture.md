# üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Aisha Bot v2

## üìä –û–±—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
app/
‚îú‚îÄ‚îÄ core/                 # –Ø–¥—Ä–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ config.py        # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ database.py      # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ di.py           # Dependency Injection
‚îÇ   ‚îî‚îÄ‚îÄ logger.py       # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îú‚îÄ‚îÄ database/            # –†–∞–±–æ—Ç–∞ —Å –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ models/         # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îÇ   ‚îî‚îÄ‚îÄ repositories/   # –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
‚îú‚îÄ‚îÄ handlers/           # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ Telegram
‚îÇ   ‚îú‚îÄ‚îÄ avatar/        # –†–∞–±–æ—Ç–∞ —Å –∞–≤–∞—Ç–∞—Ä–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ gallery/       # –ì–∞–ª–µ—Ä–µ—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ imagen4/       # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Imagen 4
‚îÇ   ‚îî‚îÄ‚îÄ profile/       # –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îú‚îÄ‚îÄ services/          # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ generation/    # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ avatar/    # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å –∞–≤–∞—Ç–∞—Ä–∞–º–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ imagen4/   # Imagen 4 API
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ prompt/    # –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–º–ø—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ balance/       # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–º
‚îÇ   ‚îî‚îÄ‚îÄ storage/       # –•—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
‚îî‚îÄ‚îÄ utils/             # –£—Ç–∏–ª–∏—Ç—ã
    ‚îú‚îÄ‚îÄ datetime.py    # –†–∞–±–æ—Ç–∞ —Å –¥–∞—Ç–∞–º–∏
    ‚îî‚îÄ‚îÄ prompt.py      # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞
```

## üîÑ –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö

### 1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å –∞–≤–∞—Ç–∞—Ä–æ–º
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –∞–≤–∞—Ç–∞—Ä
2. –°–∏—Å—Ç–µ–º–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å –∞–≤–∞—Ç–∞—Ä–æ–º
3. –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ MinIO
4. –ó–∞–ø–∏—Å—å —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ PostgreSQL
5. –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –≥–∞–ª–µ—Ä–µ–µ

### 2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Imagen 4
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –ø—Ä–æ–º–ø—Ç
2. –°–∏—Å—Ç–µ–º–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –≤ Imagen 4
3. –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ MinIO
4. –ó–∞–ø–∏—Å—å —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ PostgreSQL
5. –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –≥–∞–ª–µ—Ä–µ–µ

### 3. –ì–∞–ª–µ—Ä–µ—è (–æ–±–Ω–æ–≤–ª–µ–Ω–æ 2025-01-24)
1. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è**: –ü–æ —Ç–∏–ø—É, –¥–∞—Ç–µ, –∏–∑–±—Ä–∞–Ω–Ω–æ–º—É —á–µ—Ä–µ–∑ GalleryFilterManager
2. **–ù–∞–≤–∏–≥–∞—Ü–∏—è**: –ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å –∫–Ω–æ–ø–∫–∞–º–∏ "–ù–∞–∑–∞–¥/–í–ø–µ—Ä–µ–¥"
3. **–°–æ—Å—Ç–æ—è–Ω–∏–µ**: Redis-based —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ GalleryStateManager
4. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**: –†–µ–∞–ª—å–Ω—ã–π –ø–æ–¥—Å—á–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —á–µ—Ä–µ–∑ GalleryStatsManager
5. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: –î–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–æ–µ (FSM + Redis) –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
6. **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è**: –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ (üë§üë®üé®üìÖ)

## üóÑÔ∏è –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

### PostgreSQL (192.168.0.4)
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- –ê–≤–∞—Ç–∞—Ä—ã –∏ –º–æ–¥–µ–ª–∏
- –ì–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏ –≥–∞–ª–µ—Ä–µ—è
- –ë–∞–ª–∞–Ω—Å—ã –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

### Redis (192.168.0.3)
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–≤
- –û—á–µ—Ä–µ–¥–∏ –∑–∞–¥–∞—á
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

### MinIO (192.168.0.4)
- –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- –ú–æ–¥–µ–ª–∏ –∞–≤–∞—Ç–∞—Ä–æ–≤
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

## üîå –í–Ω–µ—à–Ω–∏–µ API

### FAL AI
- –û–±—É—á–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–æ–≤
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- Webhook –¥–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤

### Imagen 4
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### OpenAI
- GPT-4 –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
- Whisper –¥–ª—è –∞—É–¥–∏–æ
- Vision –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- Telegram OAuth
- JWT —Ç–æ–∫–µ–Ω—ã
- Rate limiting

### –î–∞–Ω–Ω—ã–µ
- –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤
- –ë—ç–∫–∞–ø—ã –ë–î
- –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

### API
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π

## üöÄ –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ
- Stateless –±–æ—Ç—ã
- –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ —á–µ—Ä–µ–∑ Nginx
- –®–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –ë–î

### –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ
- Background workers
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Redis
- CDN –¥–ª—è —Ñ–∞–π–ª–æ–≤

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ú–µ—Ç—Ä–∏–∫–∏
- –í—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ API
- –ë–∞–ª–∞–Ω—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –õ–æ–≥–∏
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
- –ê—É–¥–∏—Ç –¥–µ–π—Å—Ç–≤–∏–π

## üîÑ CI/CD

### GitHub Actions
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤
- –î–µ–ø–ª–æ–π –≤ Docker

### Docker Registry
- –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–∑–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–±–æ—Ä–∫–∞
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ

## üéØ Best Practices

### –ö–æ–¥
- PEP8 + isort + mypy
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤ –∫–æ–¥–µ
- –¢–∏–ø–∏–∑–∞—Ü–∏—è –≤–µ–∑–¥–µ

### –¢–µ—Å—Ç—ã
- Pytest + pytest-asyncio
- –ú–æ–∫–∏ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- –ü–æ–∫—Ä—ã—Ç–∏–µ > 80%

### Git
- Feature branches
- Semantic commits
- Code review

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- README.md
- architecture.md
- best_practices.md
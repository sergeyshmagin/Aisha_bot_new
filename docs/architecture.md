# üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Aisha Bot v2

## üìã –û–±—â–∏–π –æ–±–∑–æ—Ä

Aisha Bot v2 - —ç—Ç–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π AI-powered Telegram-–±–æ—Ç —Å —Å–∏—Å—Ç–µ–º–æ–π –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –∞–≤–∞—Ç–∞—Ä–æ–≤, –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–µ–π –∞—É–¥–∏–æ. –ü—Ä–æ–µ–∫—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π.

## üéØ –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

#### üé≠ –°–∏—Å—Ç–µ–º–∞ AI-–∞–≤–∞—Ç–∞—Ä–æ–≤
- **–°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π** —á–µ—Ä–µ–∑ FAL AI
- **–î–≤–∞ —Ç–∏–ø–∞ –æ–±—É—á–µ–Ω–∏—è**: –ø–æ—Ä—Ç—Ä–µ—Ç–Ω—ã–µ –∏ —Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∞–≤–∞—Ç–∞—Ä—ã
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–∞–π–ø–ª–∞–π–Ω**: –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ ‚Üí –æ–±—É—á–µ–Ω–∏–µ ‚Üí –≥–æ—Ç–æ–≤–∞—è –º–æ–¥–µ–ª—å
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∞–º–∏**: –≥–∞–ª–µ—Ä–µ—è, —Å—Ç–∞—Ç—É—Å—ã, –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ

#### üñºÔ∏è –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- **–°–æ–∑–¥–∞–Ω–∏–µ —Ñ–æ—Ç–æ —Å –∞–≤–∞—Ç–∞—Ä–æ–º** –ø–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–º—É –æ–ø–∏—Å–∞–Ω–∏—é
- **–ö–∏–Ω–µ–º–∞—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –ø—Ä–æ–º–ø—Ç-–∏–Ω–∂–∏–Ω–∏—Ä–∏–Ω–≥** –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞
- **–ê–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** —á–µ—Ä–µ–∑ GPT-4 Vision API
- **–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è** –¥–ª—è –∫–∞—á–µ—Å—Ç–≤–∞ –≥–ª–∞–∑ –∏ –ª–∏—Ü–∞

#### üîä –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è –∞—É–¥–∏–æ
- **OpenAI Whisper API** –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —Ä–µ—á–∏ –≤ —Ç–µ–∫—Å—Ç
- **Smart chunking** –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –∞—É–¥–∏–æ—Ñ–∞–π–ª–æ–≤
- **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤** –≤ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–π –≥–∞–ª–µ—Ä–µ–µ

#### üí∞ –°–∏—Å—Ç–µ–º–∞ –±–∞–ª–∞–Ω—Å–æ–≤
- **–ö—Ä–µ–¥–∏—Ç–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞** –¥–ª—è –æ–ø–ª–∞—Ç—ã AI-—É—Å–ª—É–≥
- **–ì–∏–±–∫–∞—è —Ç–∞—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è** –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –æ–ø–µ—Ä–∞—Ü–∏–π
- **–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π** –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–º

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

```mermaid
graph TB
    subgraph "üåê External Services"
        TG[Telegram API]
        FAL[FAL AI]
        OAI[OpenAI API]
        GPT4V[GPT-4 Vision]
    end
    
    subgraph "ü§ñ Bot Layer"
        TB[Telegram Bot]
        WH[Webhook Handler]
    end
    
    subgraph "üéØ Business Logic"
        AM[Avatar Manager]
        IG[Image Generator]
        AS[Audio Service]
        BS[Balance Service]
        NS[Notification Service]
    end
    
    subgraph "üîß Core Services"
        PE[Prompt Enhancer]
        IA[Image Analyzer]
        FS[File Service]
        CS[Cache Service]
    end
    
    subgraph "üíæ Data Layer"
        DB[(PostgreSQL)]
        RD[(Redis)]
        S3[(MinIO)]
    end
    
    TG <--> TB
    FAL <--> WH
    OAI <--> AS
    GPT4V <--> IA
    
    TB --> AM
    TB --> IG
    TB --> AS
    TB --> BS
    
    AM --> FAL
    AM --> NS
    IG --> PE
    IG --> IA
    
    AM --> DB
    IG --> DB
    AS --> DB
    BS --> DB
    
    FS --> S3
    CS --> RD
    
    TB --> CS
    AM --> FS
    IG --> FS
```

## üé≠ –°–∏—Å—Ç–µ–º–∞ –∞–≤–∞—Ç–∞—Ä–æ–≤

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

```mermaid
graph TB
    subgraph "üì± User Interface"
        UI[Telegram UI]
        KB[Keyboards]
        ST[State Management]
    end
    
    subgraph "üé≠ Avatar System"
        AH[Avatar Handlers]
        AM[Avatar Manager]
        TS[Training Service]
        VS[Validation Service]
    end
    
    subgraph "üé® FAL AI Integration"
        FC[FAL Client]
        FT[FAL Trainer]
        WS[Webhook Service]
        SC[Status Checker]
    end
    
    subgraph "üìÅ File Management"
        FM[File Manager]
        PU[Photo Upload]
        AR[Archive Creator]
        CL[Cleanup Service]
    end
    
    UI --> AH
    AH --> AM
    AM --> TS
    AM --> VS
    
    TS --> FC
    FC --> FT
    FT --> WS
    WS --> SC
    
    AM --> FM
    FM --> PU
    FM --> AR
    FM --> CL
    
    FM --> S3[(MinIO)]
    AM --> DB[(PostgreSQL)]
    WS --> RD[(Redis)]
```

### –ü—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–∞

```mermaid
sequenceDiagram
    participant U as User
    participant B as Bot
    participant AM as Avatar Manager
    participant VS as Validation Service
    participant FM as File Manager
    participant FAL as FAL AI
    participant WH as Webhook Handler
    participant NS as Notification Service
    
    U->>B: /create_avatar
    B->>AM: start_avatar_creation()
    AM->>U: –í—ã–±–æ—Ä —Ç–∏–ø–∞ (–ø–æ—Ä—Ç—Ä–µ—Ç/—Å—Ç–∏–ª—å)
    U->>AM: –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ (10-20 —à—Ç)
    
    loop –ö–∞–∂–¥–æ–µ —Ñ–æ—Ç–æ
        AM->>VS: validate_photo()
        VS->>VS: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏—Ü–∞, –∫–∞—á–µ—Å—Ç–≤–∞, NSFW
        VS->>AM: ValidationResult
    end
    
    AM->>FM: create_training_archive()
    FM->>S3: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–æ—Ç–æ
    FM->>AM: archive_url
    
    AM->>FAL: start_training(photos, config)
    FAL->>FAL: –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ (1000-4000 —à–∞–≥–æ–≤)
    FAL->>WH: webhook(status_update)
    
    WH->>AM: update_avatar_status()
    AM->>NS: send_completion_notification()
    NS->>U: ‚úÖ –ê–≤–∞—Ç–∞—Ä –≥–æ—Ç–æ–≤!
```

## üñºÔ∏è –°–∏—Å—Ç–µ–º–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

```mermaid
graph TB
    subgraph "üìù Prompt Processing"
        PI[Prompt Input]
        PE[Prompt Enhancer]
        CT[Cinema Translator]
        QE[Quality Enhancer]
    end
    
    subgraph "üñºÔ∏è Image Generation"
        IG[Image Generator]
        AC[Avatar Checker]
        GC[Generation Config]
        API[FAL Generation API]
    end
    
    subgraph "üîç Image Analysis"
        IA[Image Analyzer]
        GPT4[GPT-4 Vision]
        PA[Prompt Analyzer]
        EE[Eye Enhancer]
    end
    
    subgraph "üíæ Result Processing"
        RP[Result Processor]
        FS[File Service]
        DB[Database]
        S3[MinIO Storage]
    end
    
    PI --> PE
    PE --> CT
    CT --> QE
    QE --> IG
    
    IG --> AC
    AC --> GC
    GC --> API
    
    IG --> IA
    IA --> GPT4
    GPT4 --> PA
    PA --> EE
    
    API --> RP
    RP --> FS
    FS --> S3
    RP --> DB
```

### –ü—Ä–æ—Ü–µ—Å—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

```mermaid
sequenceDiagram
    participant U as User
    participant B as Bot
    participant IG as Image Generator
    participant PE as Prompt Enhancer
    participant AC as Avatar Checker
    participant FAL as FAL AI
    participant IA as Image Analyzer
    participant FS as File Service
    
    U->>B: –û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    B->>IG: generate_image(prompt, user_id)
    
    IG->>AC: check_main_avatar(user_id)
    AC->>IG: avatar_info
    
    IG->>PE: enhance_prompt(prompt, avatar_type)
    PE->>PE: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–∏–Ω–µ–º–∞—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö –¥–µ—Ç–∞–ª–µ–π
    PE->>PE: –£–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ –≥–ª–∞–∑
    PE->>IG: enhanced_prompt
    
    IG->>FAL: generate(enhanced_prompt, avatar_lora)
    FAL->>IG: generated_image_url
    
    IG->>IA: analyze_image(image_url)
    IA->>GPT4V: analyze_for_improvements()
    GPT4V->>IA: analysis_result
    
    IG->>FS: save_generation_result()
    FS->>S3: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    FS->>DB: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
    
    IG->>U: üñºÔ∏è –ì–æ—Ç–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
```

## üíæ –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö

### –û—Å–Ω–æ–≤–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏

```mermaid
erDiagram
    User ||--o{ Avatar : creates
    User ||--o{ UserBalance : has
    User ||--o{ Transaction : makes
    User ||--o{ ImageGeneration : requests
    User ||--o{ Transcript : owns
    
    Avatar ||--o{ AvatarPhoto : contains
    Avatar ||--o{ ImageGeneration : uses
    Avatar {
        uuid id PK
        string name
        enum training_type
        enum status
        string finetune_id
        string trigger_phrase
        timestamp created_at
        timestamp training_completed_at
    }
    
    AvatarPhoto {
        uuid id PK
        uuid avatar_id FK
        string file_path
        boolean is_main
        json metadata
    }
    
    ImageGeneration {
        uuid id PK
        uuid user_id FK
        uuid avatar_id FK
        text prompt
        text enhanced_prompt
        string image_url
        json generation_config
        float cost
        timestamp created_at
    }
    
    UserBalance {
        uuid user_id PK
        decimal balance
        timestamp updated_at
    }
    
    Transaction {
        uuid id PK
        uuid user_id FK
        enum type
        decimal amount
        string description
        timestamp created_at
    }
    
    Transcript {
        uuid id PK
        uuid user_id FK
        text content
        string audio_file_path
        float duration
        float cost
        timestamp created_at
    }
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### Backend Framework
- **Python 3.12** - –û—Å–Ω–æ–≤–Ω–æ–π —è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è
- **aiogram 3.4.1** - Telegram Bot API framework
- **FastAPI** - REST API –¥–ª—è webhook –∏ –≤–Ω–µ—à–Ω–∏—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
- **SQLAlchemy 2.0** - ORM —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π async/await
- **Alembic** - –°–∏—Å—Ç–µ–º–∞ –º–∏–≥—Ä–∞—Ü–∏–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### AI & ML Services
- **FAL AI** - –û–±—É—á–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- **OpenAI GPT-4 Vision** - –ê–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ —É–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤
- **OpenAI Whisper** - –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è –∞—É–¥–∏–æ –≤ —Ç–µ–∫—Å—Ç

### Data Storage
- **PostgreSQL 15+** - –û—Å–Ω–æ–≤–Ω–∞—è —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **Redis 7+** - –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ, —Å–µ—Å—Å–∏–∏, –æ—á–µ—Ä–µ–¥–∏ –∑–∞–¥–∞—á
- **MinIO** - S3-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–µ –æ–±—ä–µ–∫—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ

### Infrastructure
- **Docker & Docker Compose** - –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è –∏ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è
- **Nginx** - Reverse proxy –∏ SSL termination
- **ffmpeg** - –û–±—Ä–∞–±–æ—Ç–∫–∞ –∞—É–¥–∏–æ –∏ –≤–∏–¥–µ–æ —Ñ–∞–π–ª–æ–≤

## üåê –°–µ—Ç–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### Development Environment
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Local Dev     ‚îÇ    ‚îÇ   PostgreSQL    ‚îÇ    ‚îÇ     Redis       ‚îÇ
‚îÇ  (localhost)    ‚îÇ    ‚îÇ (192.168.0.4)   ‚îÇ    ‚îÇ (192.168.0.3)   ‚îÇ
‚îÇ                 ‚îÇ    ‚îÇ                 ‚îÇ    ‚îÇ                 ‚îÇ
‚îÇ ‚Ä¢ Bot (polling) ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ ‚Ä¢ Port: 5432    ‚îÇ    ‚îÇ ‚Ä¢ Port: 6379    ‚îÇ
‚îÇ ‚Ä¢ Scripts       ‚îÇ    ‚îÇ ‚Ä¢ DB: aisha     ‚îÇ    ‚îÇ ‚Ä¢ Cache & Queue ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                ‚ñ≤                       ‚ñ≤
                                ‚îÇ                       ‚îÇ
                       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê             ‚îÇ
                       ‚îÇ     MinIO       ‚îÇ             ‚îÇ
                       ‚îÇ (192.168.0.4)   ‚îÇ             ‚îÇ
                       ‚îÇ                 ‚îÇ             ‚îÇ
                       ‚îÇ ‚Ä¢ Port: 9000    ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚îÇ ‚Ä¢ S3 API        ‚îÇ
                       ‚îÇ ‚Ä¢ File Storage  ‚îÇ
                       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Production Environment
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Production    ‚îÇ    ‚îÇ   PostgreSQL    ‚îÇ    ‚îÇ     Redis       ‚îÇ
‚îÇ (192.168.0.10)  ‚îÇ    ‚îÇ (192.168.0.4)   ‚îÇ    ‚îÇ (192.168.0.3)   ‚îÇ
‚îÇ                 ‚îÇ    ‚îÇ                 ‚îÇ    ‚îÇ                 ‚îÇ
‚îÇ ‚Ä¢ Bot (webhook) ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ ‚Ä¢ Port: 5432    ‚îÇ    ‚îÇ ‚Ä¢ Port: 6379    ‚îÇ
‚îÇ ‚Ä¢ API Server    ‚îÇ    ‚îÇ ‚Ä¢ DB: aisha     ‚îÇ    ‚îÇ ‚Ä¢ Cache & Queue ‚îÇ
‚îÇ ‚Ä¢ Nginx         ‚îÇ    ‚îÇ                 ‚îÇ    ‚îÇ                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚ñ≤                       ‚ñ≤                       ‚ñ≤
         ‚îÇ                       ‚îÇ                       ‚îÇ
         ‚îÇ              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê             ‚îÇ
         ‚îÇ              ‚îÇ     MinIO       ‚îÇ             ‚îÇ
         ‚îÇ              ‚îÇ (192.168.0.4)   ‚îÇ             ‚îÇ
         ‚îÇ              ‚îÇ                 ‚îÇ             ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ ‚Ä¢ Port: 9000    ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚îÇ ‚Ä¢ S3 API        ‚îÇ
                        ‚îÇ ‚Ä¢ File Storage  ‚îÇ
                        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üîÑ –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã

### –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –∞–≤–∞—Ç–∞—Ä–∞

1. **–°–æ–∑–¥–∞–Ω–∏–µ** - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —Ç–∏–ø –∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–æ—Ç–æ
2. **–í–∞–ª–∏–¥–∞—Ü–∏—è** - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞, –Ω–∞–ª–∏—á–∏—è –ª–∏—Ü, NSFW
3. **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞** - –°–æ–∑–¥–∞–Ω–∏–µ –∞—Ä—Ö–∏–≤–∞ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è
4. **–û–±—É—á–µ–Ω–∏–µ** - FAL AI –æ–±—É—á–∞–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—É—é –º–æ–¥–µ–ª—å (1000-4000 —à–∞–≥–æ–≤)
5. **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ** - –ü–æ–ª—É—á–µ–Ω–∏–µ LoRA –º–æ–¥–µ–ª–∏ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
6. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ** - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å –æ–±—É—á–µ–Ω–Ω—ã–º –∞–≤–∞—Ç–∞—Ä–æ–º

### –ü—Ä–æ—Ü–µ—Å—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

1. **–í–≤–æ–¥ –ø—Ä–æ–º–ø—Ç–∞** - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–ø–∏—Å—ã–≤–∞–µ—Ç –∂–µ–ª–∞–µ–º–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞** - –°–∏—Å—Ç–µ–º–∞ –Ω–∞—Ö–æ–¥–∏—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –∞–≤–∞—Ç–∞—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. **–£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞** - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–∏–Ω–µ–º–∞—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö –¥–µ—Ç–∞–ª–µ–π
4. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è** - FAL AI —Å–æ–∑–¥–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å –∞–≤–∞—Ç–∞—Ä–æ–º
5. **–ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞** - GPT-4 Vision –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ
6. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ** - –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ MinIO –∏ –ë–î

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏

### Health Checks
- **Telegram API** - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–æ—Ç—É
- **PostgreSQL** - –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
- **Redis** - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–µ—à–∞ –∏ –æ—á–µ—Ä–µ–¥–µ–π
- **MinIO** - –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ñ–∞–π–ª–æ–≤–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
- **FAL AI** - –í–∞–ª–∏–¥–Ω–æ—Å—Ç—å API –∫–ª—é—á–∞
- **OpenAI** - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API

### –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- **–ê–≤–∞—Ç–∞—Ä—ã**: —Å–æ–∑–¥–∞–Ω–æ, –≤ –æ–±—É—á–µ–Ω–∏–∏, –∑–∞–≤–µ—Ä—à–µ–Ω–æ
- **–ì–µ–Ω–µ—Ä–∞—Ü–∏–∏**: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, —É—Å–ø–µ—à–Ω–æ—Å—Ç—å, –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- **–¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏**: –æ–±—ä–µ–º, —Ç–æ—á–Ω–æ—Å—Ç—å, —Å—Ç–æ–∏–º–æ—Å—Ç—å
- **–ë–∞–ª–∞–Ω—Å—ã**: –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è, —Ç—Ä–∞—Ç—ã, –æ—Å—Ç–∞—Ç–∫–∏

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- **Telegram ID** –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è** –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞** –∫ –∞–≤–∞—Ç–∞—Ä–∞–º –∏ –∫–æ–Ω—Ç–µ–Ω—Ç—É

### –ó–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö
- **–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ** –≤—Å–µ—Ö API –∫–ª—é—á–µ–π –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö** –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö
- **NSFW —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è** –∑–∞–≥—Ä—É–∂–∞–µ–º—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞** –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

### Rate Limiting
- **Redis-based** –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤
- **–ë–∞–ª–∞–Ω—Å–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞** –∫–∞–∫ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ
- **Webhook –∑–∞—â–∏—Ç–∞** —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø–æ–¥–ø–∏—Å–∏

## üöÄ –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
- **Stateless bot instances** - –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–ø—É—Å–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤
- **Redis –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è** - –æ–±—â–µ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å–µ—Å—Å–∏–π
- **MinIO clustering** - —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ —Ñ–∞–π–ª–æ–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ

### –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
- **Connection pooling** - –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ –ë–î
- **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - —Å–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã

### –ü–ª–∞–Ω—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- **Background workers** - –≤—ã–Ω–æ—Å —Ç—è–∂–µ–ª—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
- **CDN –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - —É—Å–∫–æ—Ä–µ–Ω–∏–µ –¥–æ—Å—Ç–∞–≤–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- **Database sharding** - —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º

---

**–î–æ–∫—É–º–µ–Ω—Ç –∞–∫—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω:** –ò—é–Ω—å 2025 | **–í–µ—Ä—Å–∏—è:** 2.0
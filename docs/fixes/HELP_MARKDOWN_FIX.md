# üõ†Ô∏è –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ Markdown –ø–∞—Ä—Å–∏–Ω–≥–∞ –≤ —Å–ø—Ä–∞–≤–∫–µ

**–î–∞—Ç–∞:** 2025-06-11  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û –ò –†–ê–ó–í–ï–†–ù–£–¢–û  
**–¢–µ–≥ –¥–µ–ø–ª–æ—è:** `fix-help-20250611-180553`

## üìã –ü—Ä–æ–±–ª–µ–º–∞

–ù–∞ –ø—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–≤–µ—Ä–µ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –≤–æ–∑–Ω–∏–∫–∞–ª–∏ –æ—à–∏–±–∫–∏ –≤ —Å–ø—Ä–∞–≤–∫–µ –±–æ—Ç–∞:

```
–ü—Ä–æ–±–ª–µ–º–∞ —Å Markdown –ø–∞—Ä—Å–∏–Ω–≥–æ–º –≤ —Å–ø—Ä–∞–≤–∫–µ: Telegram server says - Bad Request: can't parse entities: Can't find end of the entity starting at byte offset 1118
```

**–°–∏–º–ø—Ç–æ–º—ã:**
- –û—à–∏–±–∫–∏ –ø—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ —Å–ø—Ä–∞–≤–∫–∏ —á–µ—Ä–µ–∑ callback `main_help`
- –ü–æ–ø—ã—Ç–∫–∏ fallback –ø—Ä–∏–≤–æ–¥–∏–ª–∏ –∫ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º –æ—à–∏–±–∫–∞–º
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –º–æ–≥–ª–∏ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

**–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**
1. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏** –≤ —Ç–µ–∫—Å—Ç–µ —Å–ø—Ä–∞–≤–∫–∏ (`"üé® –°–æ–∑–¥–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ"`)
2. **–ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ fallback —Å—Ç—Ä–∞—Ç–µ–≥–∏–π** –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –æ—à–∏–±–æ–∫ Telegram

**–û—à–∏–±–∫–∞ –Ω–∞ –±–∞–π—Ç–µ 1118:** —É–∫–∞–∑—ã–≤–∞–ª–∞ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –º–µ—Å—Ç–æ –≤ —Ç–µ–∫—Å—Ç–µ —Å–ø—Ä–∞–≤–∫–∏ —Å –ø—Ä–æ–±–ª–µ–º–Ω—ã–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Å–ø—Ä–∞–≤–∫–∏
- –ó–∞–º–µ–Ω–µ–Ω—ã –¥–≤–æ–π–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏ –Ω–∞ –æ–¥–∏–Ω–∞—Ä–Ω—ã–µ: `'–°–æ–∑–¥–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ'`
- –û–±–Ω–æ–≤–ª–µ–Ω –∫–æ–Ω—Ç–∞–∫—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏: `@aisha_support_bot`
- –£–ª—É—á—à–µ–Ω–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞

### 2. –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
```python
try:
    # –ü–æ–ø—ã—Ç–∫–∞ —Å Markdown
    await call.message.edit_text(help_text, parse_mode="Markdown")
except TelegramBadRequest as telegram_error:
    if "parse entities" in str(telegram_error).lower():
        # Fallback –Ω–∞ HTML
        await call.message.edit_text(help_text_html, parse_mode="HTML")
    elif "message is not modified" in str(telegram_error).lower():
        # –ö–æ–Ω—Ç–µ–Ω—Ç —É–∂–µ —Ç–∞–∫–æ–π –∂–µ
        await call.answer("‚ÑπÔ∏è –°–ø—Ä–∞–≤–∫–∞ —É–∂–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∞", show_alert=False)
    # ... –¥—Ä—É–≥–∏–µ —Å–ª—É—á–∞–∏
```

### 3. –¢—Ä–∏ –≤–∞—Ä–∏–∞–Ω—Ç–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
1. **Markdown** (–æ—Å–Ω–æ–≤–Ω–æ–π)
2. **HTML** (fallback –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö Markdown)
3. **Plain text** (—Ñ–∏–Ω–∞–ª—å–Ω—ã–π fallback)

### 4. –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∏–ø–æ–≤ –æ—à–∏–±–æ–∫
- `parse entities` ‚Üí –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ HTML
- `message is not modified` ‚Üí –ø—Ä–æ—Å—Ç–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
- `message to delete not found` ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
- –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ –æ—à–∏–±–∫–∏ ‚Üí —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è —Å–ø—Ä–∞–≤–∫–∞

## üöÄ –î–µ–ø–ª–æ–π

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞ –≤ `app/handlers/main_menu.py`
2. –°–æ–∑–¥–∞–Ω–∏–µ –±—ã—Å—Ç—Ä–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞ –¥–µ–ø–ª–æ—è `scripts/deployment/quick-fix-deploy.sh`
3. –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞ —Å —Ç–µ–≥–æ–º `fix-help-20250611-180553`
4. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–≤–µ—Ä
5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ docker-compose –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `aisha/bot:latest`

**–ö–æ–º–∞–Ω–¥—ã:**
```bash
# –î–µ–ø–ª–æ–π
./scripts/deployment/quick-fix-deploy.sh

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–∑–∞ –≤ docker-compose
sed -i "s|aisha-bot:avatar-rename-feature|aisha/bot:latest|g" docker-compose.bot.simple.yml

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-compose -f docker-compose.bot.simple.yml down
docker-compose -f docker-compose.bot.simple.yml up -d
```

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```
aisha-bot-primary | WARNING - –ü—Ä–æ–±–ª–µ–º–∞ —Å Markdown –ø–∞—Ä—Å–∏–Ω–≥–æ–º –≤ —Å–ø—Ä–∞–≤–∫–µ
aisha-bot-primary | ERROR - –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ fallback —Å–ø—Ä–∞–≤–∫–µ
aisha-bot-primary | TelegramBadRequest: message to delete not found
```

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```
aisha-bot-primary | ‚úÖ Bot —Å–æ–∑–¥–∞–Ω —Å —Ç–æ–∫–µ–Ω–æ–º –¥–ª—è –æ–∫—Ä—É–∂–µ–Ω–∏—è: development
aisha-bot-primary | INFO - Start polling
aisha-bot-primary | INFO - Run polling for bot @KAZAI_Aisha_bot
```

## üéØ –£–ª—É—á—à–µ–Ω–∏—è

1. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:** —Å–ø—Ä–∞–≤–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
2. **UX:** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤—Å–µ–≥–¥–∞ –ø–æ–ª—É—á–∞—é—Ç —Å–ø—Ä–∞–≤–∫—É –≤ —Ç–æ–º –∏–ª–∏ –∏–Ω–æ–º –≤–∏–¥–µ
3. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
4. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –∏–∑–±–µ–∂–∞–Ω–∏–µ –ª–∏—à–Ω–∏—Ö –ø–æ–ø—ã—Ç–æ–∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ dev —Ç–æ–∫–µ–Ω–∞
–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ dev —Ç–æ–∫–µ–Ω–∞:
- –°–æ–∑–¥–∞–Ω `env.dev.template` —Å —Ç–æ–∫–µ–Ω–æ–º `7891892225:AAHzdW0QdtQ3mpN_3aPT1eFOX-z_TWpUDJw`
- –î–æ–±–∞–≤–ª–µ–Ω `docker-compose.dev.yml` –¥–ª—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- –û–±–Ω–æ–≤–ª–µ–Ω `app/core/config.py` —Å –º–µ—Ç–æ–¥–æ–º `effective_telegram_token()`
- –°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç `scripts/deployment/start-dev-env.sh`

### –ù–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
- `scripts/deployment/quick-fix-deploy.sh` - –±—ã—Å—Ç—Ä—ã–π –¥–µ–ø–ª–æ–π –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
- `scripts/deployment/start-dev-env.sh` - –∑–∞–ø—É—Å–∫ dev –æ–∫—Ä—É–∂–µ–Ω–∏—è

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã:**
```bash
# –õ–æ–≥–∏ –ø—Ä–æ–¥–∞–∫—à–Ω –±–æ—Ç–∞
ssh aisha@192.168.0.10 'docker logs aisha-bot-primary --tail=20'

# –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
ssh aisha@192.168.0.10 'docker ps | grep aisha'

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Ä–∞–∑–æ–≤
ssh aisha@192.168.0.10 'docker images | grep aisha/bot'
```

**–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —É—Å–ø–µ—Ö–∞:**
- ‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—à–∏–±–æ–∫ "parse entities" –≤ –ª–æ–≥–∞—Ö
- ‚úÖ –°–ø—Ä–∞–≤–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ Fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã —Ä–∞–±–æ—Ç–∞—é—Ç –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

---

**–ó–∞–∫–ª—é—á–µ–Ω–∏–µ:** –û—à–∏–±–∫–∏ —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º —Å–ø—Ä–∞–≤–∫–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã. –°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–ª–∞ –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ–π –±–ª–∞–≥–æ–¥–∞—Ä—è –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–µ –æ—à–∏–±–æ–∫. 
# üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ –Ω–æ–≤—ã–π API —Å–µ—Ä–≤–µ—Ä –¥–ª—è FAL AI Webhook

## üìã –û–±–∑–æ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏–π

–°–æ–∑–¥–∞–Ω –æ—Ç–¥–µ–ª—å–Ω—ã–π FastAPI —Å–µ—Ä–≤–µ—Ä –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ webhook –æ—Ç FAL AI —Å –ø–æ–ª–Ω–æ–π SSL –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π, –∑–∞–º–µ–Ω—è—é—â–∏–π —Å—Ç–∞—Ä—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –∏–∑ `archive/backend_api`.

## üèóÔ∏è –ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- **–û—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç** (`app/`) - Telegram –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
- **API —Å–µ—Ä–≤–µ—Ä** (`api_server/`) - Webhook –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å SSL

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è
1. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –ú–æ–∂–Ω–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö
2. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π SSL endpoint
3. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –ù–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –û—Ç–¥–µ–ª—å–Ω—ã–µ –ª–æ–≥–∏ –∏ –º–µ—Ç—Ä–∏–∫–∏

## üîÑ –ß—Ç–æ –±—ã–ª–æ —É–ª—É—á—à–µ–Ω–æ

### –ò–∑ —Å—Ç–∞—Ä–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–∑—è—Ç–æ:
- ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ FAL AI
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ webhook —Å–æ–±—ã—Ç–∏–π  
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ Telegram
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤ –æ–±—É—á–µ–Ω–∏—è

### –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
- üÜï **SSL/TLS –ø–æ–¥–¥–µ—Ä–∂–∫–∞** - –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è FAL AI
- üÜï **–§–æ–Ω–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** - BackgroundTasks –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
- üÜï **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π** - –†–∞–±–æ—Ç–∞ —Å AvatarTrainingService
- üÜï **–£–ª—É—á—à–µ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - TrustedHost, CORS, IP —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
- üÜï **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - Health check –∏ status endpoints
- üÜï **–¢–∏–ø–∏–∑–∞—Ü–∏—è** - –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–∏–ø–æ–≤ Python

## üì° –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ webhook URL

### –°—Ç–∞—Ä—ã–π endpoint:
```
http://domain/api/avatar/status_update
```

### –ù–æ–≤—ã–π endpoint:
```
https://aibots.kz:8443/api/v1/avatar/status_update
```

### –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
- **HTTPS** –≤–º–µ—Å—Ç–æ HTTP (SSL –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω)
- **–ü–æ—Ä—Ç 8443** –¥–ª—è webhook
- **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ API** (/api/v1/)
- **–î–æ–º–µ–Ω aibots.kz** —Å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

### 1. –î–≤–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞
```bash
# –ü—Ä–æ—Ü–µ—Å—Å 1: –û—Å–Ω–æ–≤–Ω–æ–π Telegram –±–æ—Ç
python -m app.main

# –ü—Ä–æ—Ü–µ—Å—Å 2: API —Å–µ—Ä–≤–µ—Ä –¥–ª—è webhook
cd api_server && python run_api_server.py
```

### 2. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–î–æ–±–∞–≤–∏—Ç—å –≤ –æ—Å–Ω–æ–≤–Ω–æ–π `.env`:
```env
# FAL AI Webhook (—Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–π API —Å–µ—Ä–≤–µ—Ä)
FAL_WEBHOOK_URL=https://aibots.kz:8443/api/v1/avatar/status_update
```

### 3. SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –≤ `api_server/ssl/`:
- `aibots_kz.crt`
- `aibots.kz.key` 
- `aibots_kz.ca-bundle`

## üîÑ –ü—Ä–æ—Ü–µ—Å—Å –º–∏–≥—Ä–∞—Ü–∏–∏

### –®–∞–≥ 1: –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ç–∞—Ä–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å—Ç–∞—Ä—ã–π backend_api –µ—Å–ª–∏ –æ–Ω –∑–∞–ø—É—â–µ–Ω
```

### –®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
cd api_server
pip install -r requirements.txt
```

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```bash
cd api_server
cp env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Å –≤–∞—à–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
```

### –®–∞–≥ 4: –ó–∞–ø—É—Å–∫ –Ω–æ–≤–æ–≥–æ API —Å–µ—Ä–≤–µ—Ä–∞
```bash
cd api_server
python run_api_server.py
```

### –®–∞–≥ 5: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ FAL AI webhook URL
–í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö FAL AI –æ–±–Ω–æ–≤–∏—Ç–µ webhook URL –Ω–∞:
```
https://aibots.kz:8443/api/v1/avatar/status_update
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ SSL
```bash
curl https://aibots.kz:8443/health
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ webhook —Å—Ç–∞—Ç—É—Å–∞
```bash
curl https://aibots.kz:8443/api/v1/webhook/status
```

### 3. –¢–µ—Å—Ç–æ–≤—ã–π webhook
```bash
curl -X POST https://aibots.kz:8443/api/v1/avatar/status_update \
  -H "Content-Type: application/json" \
  -d '{
    "request_id": "test_123",
    "status": "completed",
    "training_type": "portrait"
  }'
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏ API —Å–µ—Ä–≤–µ—Ä–∞
```bash
tail -f api_server/logs/api_server.log
tail -f api_server/logs/webhook.log
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –æ–±–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ –∑–∞–ø—É—â–µ–Ω—ã
ps aux | grep python
```

## üö® –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π SSL** - FAL AI —Ç—Ä–µ–±—É–µ—Ç HTTPS –¥–ª—è webhook
2. **–ü–æ—Ä—Ç 8443** - –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø–æ—Ä—Ç –æ—Ç–∫—Ä—ã—Ç –≤ firewall
3. **–î–æ–º–µ–Ω aibots.kz** - SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –ø—Ä–∏–≤—è–∑–∞–Ω –∫ —ç—Ç–æ–º—É –¥–æ–º–µ–Ω—É
4. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** - API —Å–µ—Ä–≤–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç—É –∂–µ –ë–î —á—Ç–æ –∏ –æ—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç
5. **Telegram —Ç–æ–∫–µ–Ω** - –ù—É–∂–µ–Ω –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## üîÑ –û—Ç–∫–∞—Ç (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω)

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –ø—Ä–æ–±–ª–µ–º—ã, –º–æ–∂–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω–æ –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å—Ç–∞—Ä–æ–π —Å—Ö–µ–º–µ:

1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–æ–≤—ã–π API —Å–µ—Ä–≤–µ—Ä
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–π backend_api (–±–µ–∑ SSL)
3. –û–±–Ω–æ–≤–∏—Ç—å webhook URL –≤ FAL AI –Ω–∞ —Å—Ç–∞—Ä—ã–π
4. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –≤ –Ω–æ–≤–æ–º API —Å–µ—Ä–≤–µ—Ä–µ
5. –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é

## üìà –ü–ª–∞–Ω—ã —Ä–∞–∑–≤–∏—Ç–∏—è

- **Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è** API —Å–µ—Ä–≤–µ—Ä–∞
- **Load balancer** –¥–ª—è –≤—ã—Å–æ–∫–æ–π –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏  
- **–ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** (Prometheus/Grafana)
- **Rate limiting** –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç —Å–ø–∞–º–∞
- **Webhook retry –º–µ—Ö–∞–Ω–∏–∑–º** –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ 
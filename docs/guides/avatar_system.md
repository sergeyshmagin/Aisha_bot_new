# üé≠ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Å–∏—Å—Ç–µ–º–µ –∞–≤–∞—Ç–∞—Ä–æ–≤

**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** 15.01.2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é  
**–í–µ—Ä—Å–∏—è:** v2.0 —Å FAL AI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π

## üìã –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

–°–∏—Å—Ç–µ–º–∞ –∞–≤–∞—Ç–∞—Ä–æ–≤ Aisha v2 –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ AI –º–æ–¥–µ–ª–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–≤–∞ —Ç–∏–ø–∞ –æ–±—É—á–µ–Ω–∏—è —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –≤—ã–±–æ—Ä–æ–º –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏.

### üéØ –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- **–î–≤–∞ —Ç–∏–ø–∞ –æ–±—É—á–µ–Ω–∏—è:** –ü–æ—Ä—Ç—Ä–µ—Ç–Ω—ã–π –∏ –•—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä API:** FAL AI Portrait Trainer / Pro Trainer
- **–í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
- **–ü—Ä–æ–≥—Ä–µ—Å—Å –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:** Webhook —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- **–¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º:** –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –±–µ–∑ –∑–∞—Ç—Ä–∞—Ç

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã
```
app/
‚îú‚îÄ‚îÄ handlers/avatar/              # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ UI
‚îÇ   ‚îú‚îÄ‚îÄ main.py                  # –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –∞–≤–∞—Ç–∞—Ä–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ create.py                # –°–æ–∑–¥–∞–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∞
‚îÇ   ‚îú‚îÄ‚îÄ training_type_selection.py # –í—ã–±–æ—Ä —Ç–∏–ø–∞ –æ–±—É—á–µ–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ photo_upload.py          # –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
‚îú‚îÄ‚îÄ services/avatar/             # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ avatar_service.py        # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ photo_upload_service.py  # –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ fal_training_service.py  # –û–±—É—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ FAL AI
‚îú‚îÄ‚îÄ database/models/             # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ avatar.py               # Avatar, AvatarPhoto
‚îî‚îÄ‚îÄ keyboards/                   # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    ‚îî‚îÄ‚îÄ avatar.py               # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∞–≤–∞—Ç–∞—Ä–æ–≤
```

### –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

#### Avatar (–û—Å–Ω–æ–≤–Ω–∞—è –º–æ–¥–µ–ª—å)
```python
class Avatar(Base):
    # –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
    id: UUID (PK)
    user_id: UUID (FK)
    
    # –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    name: str                     # –ò–º—è –∞–≤–∞—Ç–∞—Ä–∞
    gender: AvatarGender         # male, female, other
    training_type: AvatarTrainingType  # portrait, style
    
    # –°—Ç–∞—Ç—É—Å –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å
    status: AvatarStatus         # draft, training, completed, error
    training_progress: int       # 0-100%
    
    # FAL AI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
    finetune_id: str            # ID –æ–±—É—á–µ–Ω–∏—è –≤ FAL
    fal_mode: str               # "portrait" –∏–ª–∏ "style"
    
    # –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏
    created_at: DateTime
    updated_at: DateTime
```

#### AvatarPhoto (–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏)
```python
class AvatarPhoto(Base):
    # –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
    id: UUID (PK)
    avatar_id: UUID (FK)
    
    # –§–∞–π–ª
    minio_key: str              # –ü—É—Ç—å –≤ MinIO
    file_hash: str              # MD5 –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏
    file_size: int
    
    # –í–∞–ª–∏–¥–∞—Ü–∏—è
    validation_status: PhotoValidationStatus
    has_face: bool
    quality_score: float
    
    # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
    width: int
    height: int
    created_at: DateTime
```

## üé® –¢–∏–ø—ã –æ–±—É—á–µ–Ω–∏—è

### üé≠ –ü–æ—Ä—Ç—Ä–µ—Ç–Ω—ã–π —Ç–∏–ø (–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π)
**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è:** Flux LoRA Portrait Trainer  
**–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è:** –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –ª—é–¥–µ–π

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚ö° –ë—ã—Å—Ç—Ä–æ–µ –æ–±—É—á–µ–Ω–∏–µ (3-15 –º–∏–Ω—É—Ç)
- üéØ –°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ –ª–∏—Ü–∞—Ö
- üîç –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–µ–∑–∫–∞ –ø–æ—Ä—Ç—Ä–µ—Ç–æ–≤
- üé≠ –°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Å–æ–∫ –ª–∏—Ü–∞
- ‚≠ê –ü—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –¥–ª—è –ø–æ—Ä—Ç—Ä–µ—Ç–æ–≤

**–ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è:**
- –°–µ–ª—Ñ–∏ –∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –ª—é–¥–µ–π
- –ü–æ—Ä—Ç—Ä–µ—Ç–Ω–∞—è —Å—ä–µ–º–∫–∞
- –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ñ–æ—Ç–æ
- –õ–∏—á–Ω—ã–µ –∞–≤–∞—Ç–∞—Ä—ã

### üé® –•—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç–∏–ø
**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è:** Flux Pro Trainer  
**–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è:** –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- üåê –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ª—é–±—ã—Ö —Å—Ç–∏–ª–µ–π –∏ –æ–±—ä–µ–∫—Ç–æ–≤
- üîß –ì–∏–±–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±—É—á–µ–Ω–∏—è
- üìù –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –æ–ø–∏—Å–∞–Ω–∏–π
- üéõÔ∏è –†–∞–∑–ª–∏—á–Ω—ã–µ —Ä–µ–∂–∏–º—ã –∫–∞—á–µ—Å—Ç–≤–∞
- üîÑ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç—å

**–ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è:**
- –•—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏
- –ü—Ä–µ–¥–º–µ—Ç—ã –∏ –æ–±—ä–µ–∫—Ç—ã
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –∏–Ω—Ç–µ—Ä—å–µ—Ä—ã
- –ê–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏

## üîÑ Workflow —Å–æ–∑–¥–∞–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–∞

### –≠—Ç–∞–ø 1: –í—ã–±–æ—Ä —Ç–∏–ø–∞ –æ–±—É—á–µ–Ω–∏—è
```
–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é ‚Üí –°–æ–∑–¥–∞—Ç—å –∞–≤–∞—Ç–∞—Ä ‚Üí –í—ã–±–æ—Ä —Ç–∏–ø–∞ –æ–±—É—á–µ–Ω–∏—è
‚îú‚îÄ‚îÄ üé≠ –ü–æ—Ä—Ç—Ä–µ—Ç–Ω—ã–π (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
‚îú‚îÄ‚îÄ üé® –•—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π
‚îî‚îÄ‚îÄ üìä –°—Ä–∞–≤–Ω–∏—Ç—å —Ç–∏–ø—ã
```

### –≠—Ç–∞–ø 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞
```
–í—ã–±–æ—Ä —Ç–∏–ø–∞ ‚Üí –í—ã–±–æ—Ä –ø–æ–ª–∞ ‚Üí –í–≤–æ–¥ –∏–º–µ–Ω–∏ ‚Üí –ü–µ—Ä–µ—Ö–æ–¥ –∫ –∑–∞–≥—Ä—É–∑–∫–µ
```

### –≠—Ç–∞–ø 3: –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
```
–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ ‚Üí –í–∞–ª–∏–¥–∞—Ü–∏—è ‚Üí –ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ (10-20 —à—Ç) ‚Üí –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –æ–±—É—á–µ–Ω–∏—é
```

### –≠—Ç–∞–ø 4: –û–±—É—á–µ–Ω–∏–µ
```
–ó–∞–ø—É—Å–∫ –æ–±—É—á–µ–Ω–∏—è ‚Üí FAL AI –æ–±—Ä–∞–±–æ—Ç–∫–∞ ‚Üí Webhook —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è ‚Üí –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ
```

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```env
# FAL AI API
FAL_API_KEY=your_fal_api_key_here
FAL_WEBHOOK_URL=https://yourdomain.com/api/avatar/status_update

# –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º (–æ—Ç–∫–ª—é—á–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã)
FAL_TRAINING_TEST_MODE=true

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ webhook —Å–∏–º—É–ª—è—Ü–∏–∏
FAL_ENABLE_WEBHOOK_SIMULATION=true
FAL_MOCK_TRAINING_DURATION=30

# –õ–∏–º–∏—Ç—ã
AVATAR_MIN_PHOTOS=10
AVATAR_MAX_PHOTOS=20
PHOTO_MAX_SIZE=20971520  # 20MB
```

### –ü—Ä–µ—Å–µ—Ç—ã –∫–∞—á–µ—Å—Ç–≤–∞
```python
# –ë—ã—Å—Ç—Ä–æ–µ –æ–±—É—á–µ–Ω–∏–µ (3-5 –º–∏–Ω—É—Ç)
FAL_PRESET_FAST = {
    "portrait": {"steps": 500, "learning_rate": 0.0003},
    "general": {"iterations": 200, "priority": "speed"}
}

# –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ (5-15 –º–∏–Ω—É—Ç)
FAL_PRESET_BALANCED = {
    "portrait": {"steps": 1000, "learning_rate": 0.0002},
    "general": {"iterations": 500, "priority": "quality"}
}

# –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ (15-30 –º–∏–Ω—É—Ç)
FAL_PRESET_QUALITY = {
    "portrait": {"steps": 2500, "learning_rate": 0.0001},
    "general": {"iterations": 1000, "priority": "quality"}
}
```

## üß™ –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞
–ü—Ä–∏ `FAL_TRAINING_TEST_MODE=true`:
- ‚ùå –†–µ–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ FAL AI **–Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è**
- ‚úÖ –ò–º–∏—Ç–∞—Ü–∏—è –æ–±—É—á–µ–Ω–∏—è —Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ–π –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é
- ‚úÖ –°–∏–º—É–ª—è—Ü–∏—è webhook –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è UX
- ‚úÖ –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ –∑–∞—Ç—Ä–∞—Ç

### –õ–æ–≥–∏ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞
```
üß™ –¢–ï–°–¢ –†–ï–ñ–ò–ú: –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É –Ω–∞ –æ–±—É—á–µ–Ω–∏–µ –¥–ª—è –∞–≤–∞—Ç–∞—Ä–∞ abc123
üß™ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π request_id: test_abc123_def456
üß™ –ò–º–∏—Ç–∞—Ü–∏—è –æ–±—É—á–µ–Ω–∏—è portrait, –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 30 —Å–µ–∫—É–Ω–¥
üß™ –¢–µ—Å—Ç–æ–≤—ã–π webhook –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω: 200
```

## üì° Webhook —Å–∏—Å—Ç–µ–º–∞

### Endpoint –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```
POST /api/avatar/status_update?training_type={portrait|style}
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤
1. **in_progress** ‚Üí –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
2. **completed** ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ + —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. **failed** ‚Üí –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ + —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

### –§–æ—Ä–º–∞—Ç webhook
```json
{
    "request_id": "req_123456789",
    "status": "completed",
    "progress": 100,
    "training_type": "portrait",
    "result": {
        "diffusers_lora_file": {
            "url": "https://fal.ai/files/model.safetensors",
            "file_name": "avatar_model.safetensors"
        }
    }
}
```

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã

### AvatarService
**–§–∞–π–ª:** `app/services/avatar/avatar_service.py`

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã:**
```python
async def create_avatar(user_id, name, gender, training_type)
async def get_user_avatars(user_id)
async def update_training_progress(avatar_id, progress)
async def complete_avatar_training(avatar_id, model_url)
```

### PhotoUploadService
**–§–∞–π–ª:** `app/services/avatar/photo_upload_service.py`

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ –∏ —Ä–∞–∑–º–µ—Ä–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –ª–∏—Ü (–¥–ª—è –ø–æ—Ä—Ç—Ä–µ—Ç–Ω–æ–≥–æ —Ç–∏–ø–∞)
- –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ —Ö–µ—à—É
- –ó–∞–≥—Ä—É–∑–∫–∞ –≤ MinIO

### FALTrainingService
**–§–∞–π–ª:** `app/services/avatar/fal_training_service.py`

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä API:**
```python
if training_type == "portrait":
    # Flux LoRA Portrait Trainer
    result = await self.portrait_trainer.train_avatar_async(...)
else:
    # Flux Pro Trainer
    result = await self.adapter.train_avatar(...)
```

## üéπ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

### –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –∞–≤–∞—Ç–∞—Ä–æ–≤
```
üé≠ –ú–µ–Ω—é –∞–≤–∞—Ç–∞—Ä–æ–≤

–í–∞—à–∏ –∞–≤–∞—Ç–∞—Ä—ã: 3
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üÜï –°–æ–∑–¥–∞—Ç—å –∞–≤–∞—Ç–∞—Ä   ‚îÇ
‚îÇ üìÅ –ú–æ–∏ –∞–≤–∞—Ç–∞—Ä—ã (3)  ‚îÇ
‚îÇ ‚ÑπÔ∏è –ü–æ–º–æ—â—å           ‚îÇ
‚îÇ ‚óÄÔ∏è –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –í—ã–±–æ—Ä —Ç–∏–ø–∞ –æ–±—É—á–µ–Ω–∏—è
```
üéì –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –æ–±—É—á–µ–Ω–∏—è

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üé≠ –ü–æ—Ä—Ç—Ä–µ—Ç–Ω—ã–π       ‚îÇ
‚îÇ   (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π)   ‚îÇ
‚îÇ                     ‚îÇ
‚îÇ üé® –•—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π   ‚îÇ
‚îÇ   (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π)   ‚îÇ
‚îÇ                     ‚îÇ
‚îÇ üìä –°—Ä–∞–≤–Ω–∏—Ç—å —Ç–∏–ø—ã    ‚îÇ
‚îÇ ‚óÄÔ∏è –ù–∞–∑–∞–¥            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü—Ä–æ—Ü–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è
```
ü§ñ –û–±—É—á–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∞

üìä –ü—Ä–æ–≥—Ä–µ—Å—Å: 65%
‚ö° –°—Ç–∞—Ç—É—Å: –í –ø—Ä–æ—Ü–µ—Å—Å–µ...

‚è±Ô∏è –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ–±—É—á–µ–Ω–∏–µ...

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‚è∏Ô∏è –û—Ç–º–µ–Ω–∏—Ç—å         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞

### Health check
```bash
curl http://localhost:8000/health
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –æ–±—É—á–µ–Ω–∏—è
```python
from app.services.avatar.fal_training_service import FALTrainingService

service = FALTrainingService()
status = await service.check_training_status(request_id, training_type)
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```python
logger.info(f"üé≠ –°–æ–∑–¥–∞–Ω –∞–≤–∞—Ç–∞—Ä {avatar_id} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º {user_id}")
logger.info(f"üì∏ –ó–∞–≥—Ä—É–∂–µ–Ω–æ {photo_count} —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –¥–ª—è –∞–≤–∞—Ç–∞—Ä–∞ {avatar_id}")
logger.info(f"üöÄ –ó–∞–ø—É—â–µ–Ω–æ –æ–±—É—á–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∞ {avatar_id} —Ç–∏–ø–∞ {training_type}")
```

## üö® –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### Webhook –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `FAL_WEBHOOK_URL` –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ API —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å URL –∏–∑–≤–Ω–µ

### –û—à–∏–±–∫–∏ FAL API
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `FAL_API_KEY`
- –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –Ω–∞–ª–∏—á–∏–∏ –∫—Ä–µ–¥–∏—Ç–æ–≤ –Ω–∞ FAL AI
- –í–∫–ª—é—á–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º: `FAL_TRAINING_TEST_MODE=true`

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `TELEGRAM_TOKEN`
- –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∞—Ö –±–æ—Ç–∞
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ API —Å–µ—Ä–≤–µ—Ä–∞

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –í—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è –ø–æ —Ç–∏–ø–∞–º

| –¢–∏–ø | –ü—Ä–µ—Å–µ—Ç | –í—Ä–µ–º—è | –ö–∞—á–µ—Å—Ç–≤–æ |
|-----|--------|-------|----------|
| –ü–æ—Ä—Ç—Ä–µ—Ç–Ω—ã–π | Fast | 3-5 –º–∏–Ω | ‚≠ê‚≠ê‚≠ê |
| –ü–æ—Ä—Ç—Ä–µ—Ç–Ω—ã–π | Balanced | 5-15 –º–∏–Ω | ‚≠ê‚≠ê‚≠ê‚≠ê |
| –ü–æ—Ä—Ç—Ä–µ—Ç–Ω—ã–π | Quality | 15-30 –º–∏–Ω | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê |
| –•—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π | Fast | 5-10 –º–∏–Ω | ‚≠ê‚≠ê‚≠ê |
| –•—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π | Balanced | 10-20 –º–∏–Ω | ‚≠ê‚≠ê‚≠ê‚≠ê |
| –•—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π | Quality | 20-45 –º–∏–Ω | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê |

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- **–ü–æ—Ä—Ç—Ä–µ—Ç–Ω—ã–µ –∞–≤–∞—Ç–∞—Ä—ã:** –¥–ª—è —Å–µ–ª—Ñ–∏ –∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –ª—é–¥–µ–π
- **–•—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∞–≤–∞—Ç–∞—Ä—ã:** –¥–ª—è —Å—Ç–∏–ª–µ–π, –æ–±—ä–µ–∫—Ç–æ–≤, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- **–¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º:** –≤—Å–µ–≥–¥–∞ —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–∞–∫—à–Ω

---

**üéâ –°–∏—Å—Ç–µ–º–∞ –∞–≤–∞—Ç–∞—Ä–æ–≤ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏!** 
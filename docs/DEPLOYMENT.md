# üöÄ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é Aisha v2

**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** 15.01.2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥–∞–∫—à–Ω —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é  
**–í–µ—Ä—Å–∏—è:** v2.0 —Å FAL AI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π

## üìã –û–±–∑–æ—Ä —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é Telegram-–±–æ—Ç–∞ Aisha v2 –≤ –ø—Ä–æ–¥–∞–∫—à–Ω —Å—Ä–µ–¥–µ. –í–∫–ª—é—á–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫—É –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤, –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.

### üéØ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Telegram Bot  ‚îÇ    ‚îÇ   API Server    ‚îÇ    ‚îÇ   Database      ‚îÇ
‚îÇ   (Port 8000)   ‚îÇ    ‚îÇ   (Port 8443)   ‚îÇ    ‚îÇ   PostgreSQL    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                       ‚îÇ                       ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                 ‚îÇ
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ     MinIO       ‚îÇ    ‚îÇ     Redis       ‚îÇ    ‚îÇ    FAL AI       ‚îÇ
         ‚îÇ  (Port 9000)    ‚îÇ    ‚îÇ  (Port 6379)    ‚îÇ    ‚îÇ   (External)    ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üõ†Ô∏è –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- **OS:** Ubuntu 20.04+ / CentOS 8+ / Debian 11+
- **RAM:** –ú–∏–Ω–∏–º—É–º 2GB, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 4GB
- **CPU:** 2+ —è–¥—Ä–∞
- **–î–∏—Å–∫:** 20GB+ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞
- **Python:** 3.11+

### –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Å–µ—Ä–≤–∏—Å—ã
- **PostgreSQL 15+** - –æ—Å–Ω–æ–≤–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **Redis 7+** - –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å–µ—Å—Å–∏–∏
- **MinIO** - –æ–±—ä–µ–∫—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Ñ–∞–π–ª–æ–≤
- **Nginx** - reverse proxy (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### 1. –°–∏—Å—Ç–µ–º–Ω—ã–µ –ø–∞–∫–µ—Ç—ã
```bash
# Ubuntu/Debian
sudo apt update
sudo apt install -y python3.11 python3.11-venv python3-pip git curl wget

# CentOS/RHEL
sudo dnf install -y python3.11 python3-pip git curl wget
```

### 2. PostgreSQL
```bash
# Ubuntu/Debian
sudo apt install -y postgresql postgresql-contrib
sudo systemctl start postgresql
sudo systemctl enable postgresql

# –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
sudo -u postgres psql
CREATE DATABASE aisha_v2;
CREATE USER aisha_user WITH PASSWORD 'secure_password';
GRANT ALL PRIVILEGES ON DATABASE aisha_v2 TO aisha_user;
\q
```

### 3. Redis
```bash
# Ubuntu/Debian
sudo apt install -y redis-server
sudo systemctl start redis
sudo systemctl enable redis

# –ü—Ä–æ–≤–µ—Ä–∫–∞
redis-cli ping
```

### 4. MinIO
```bash
# –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞
wget https://dl.min.io/server/minio/release/linux-amd64/minio
chmod +x minio
sudo mv minio /usr/local/bin/

# –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
sudo useradd -r minio-user -s /sbin/nologin
sudo mkdir -p /opt/minio/data
sudo chown minio-user:minio-user /opt/minio/data

# Systemd —Å–µ—Ä–≤–∏—Å
sudo tee /etc/systemd/system/minio.service > /dev/null <<EOF
[Unit]
Description=MinIO
Documentation=https://docs.min.io
Wants=network-online.target
After=network-online.target
AssertFileIsExecutable=/usr/local/bin/minio

[Service]
WorkingDirectory=/opt/minio
User=minio-user
Group=minio-user
EnvironmentFile=-/etc/default/minio
ExecStartPre=/bin/bash -c "if [ -z \"\${MINIO_VOLUMES}\" ]; then echo \"Variable MINIO_VOLUMES not set in /etc/default/minio\"; exit 1; fi"
ExecStart=/usr/local/bin/minio server \$MINIO_OPTS \$MINIO_VOLUMES
Restart=always
LimitNOFILE=65536
TasksMax=infinity
TimeoutStopSec=infinity
SendSIGKILL=no

[Install]
WantedBy=multi-user.target
EOF

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è MinIO
sudo tee /etc/default/minio > /dev/null <<EOF
MINIO_VOLUMES="/opt/minio/data"
MINIO_OPTS="--console-address :9001"
MINIO_ROOT_USER=minioadmin
MINIO_ROOT_PASSWORD=minioadmin123
EOF

sudo systemctl daemon-reload
sudo systemctl start minio
sudo systemctl enable minio
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
```bash
cd /opt
sudo git clone https://github.com/your-repo/aisha_v2.git
sudo chown -R $USER:$USER /opt/aisha_v2
cd /opt/aisha_v2
```

### 2. –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
```bash
python3.11 -m venv venv
source venv/bin/activate
pip install --upgrade pip
pip install -r requirements.txt
```

### 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
cp .env.example .env
nano .env
```

### 4. –û—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```env
# ==================== –û–°–ù–û–í–ù–´–ï –ù–ê–°–¢–†–û–ô–ö–ò ====================

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
DATABASE_HOST=localhost
DATABASE_PORT=5432
DATABASE_NAME=aisha_v2
DATABASE_USER=aisha_user
DATABASE_PASSWORD=secure_password

# Redis
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=

# MinIO
MINIO_ENDPOINT=localhost:9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin123
MINIO_BUCKET_AVATARS=aisha-v2-avatars
MINIO_BUCKET_TRANSCRIPTS=aisha-v2-transcripts

# ==================== TELEGRAM BOT ====================

TELEGRAM_BOT_TOKEN=your_telegram_bot_token_here

# ==================== –í–ù–ï–®–ù–ò–ï API ====================

# OpenAI
OPENAI_API_KEY=sk-your_openai_api_key_here

# FAL AI
FAL_API_KEY=your_fal_api_key_here
FAL_WEBHOOK_URL=https://yourdomain.com:8443/api/v1/avatar/status_update

# ==================== –†–ï–ñ–ò–ú–´ –†–ê–ë–û–¢–´ ====================

# –ü—Ä–æ–¥–∞–∫—à–Ω —Ä–µ–∂–∏–º
DEBUG=false
ENVIRONMENT=production

# FAL AI —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º (—É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ false –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω–∞)
FAL_TRAINING_TEST_MODE=false

# ==================== –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ ====================

# JWT —Å–µ–∫—Ä–µ—Ç
JWT_SECRET=your_jwt_secret_here

# –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ —Ö–æ—Å—Ç—ã
ALLOWED_HOSTS=yourdomain.com,www.yourdomain.com

# ==================== –õ–û–ì–ò–†–û–í–ê–ù–ò–ï ====================

LOG_LEVEL=INFO
LOG_FILE=/var/log/aisha_v2/app.log
```

### 5. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
```bash
source venv/bin/activate
alembic upgrade head
```

### 6. –°–æ–∑–¥–∞–Ω–∏–µ buckets –≤ MinIO
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ MinIO –∫–ª–∏–µ–Ω—Ç–∞
wget https://dl.min.io/client/mc/release/linux-amd64/mc
chmod +x mc
sudo mv mc /usr/local/bin/

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–ª–∏–∞—Å–∞
mc alias set local http://localhost:9000 minioadmin minioadmin123

# –°–æ–∑–¥–∞–Ω–∏–µ buckets
mc mb local/aisha-v2-avatars
mc mb local/aisha-v2-transcripts

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–ª–∏—Ç–∏–∫ –¥–æ—Å—Ç—É–ø–∞
mc policy set public local/aisha-v2-avatars
mc policy set public local/aisha-v2-transcripts
```

## üîê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

### 1. Telegram Bot Token

#### –°–æ–∑–¥–∞–Ω–∏–µ –±–æ—Ç–∞
1. –ù–∞–π–¥–∏—Ç–µ @BotFather –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/newbot`
3. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–æ—Ç–∞
4. –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤ `.env`

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhook (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```bash
curl -X POST "https://api.telegram.org/bot<YOUR_BOT_TOKEN>/setWebhook" \
     -H "Content-Type: application/json" \
     -d '{"url": "https://yourdomain.com:8443/webhook/telegram"}'
```

### 2. OpenAI API

#### –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–ª—é—á–∞
1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ https://platform.openai.com
2. –°–æ–∑–¥–∞–π—Ç–µ API –∫–ª—é—á –≤ —Ä–∞–∑–¥–µ–ª–µ API Keys
3. –î–æ–±–∞–≤—å—Ç–µ –∫–ª—é—á –≤ `.env` –∫–∞–∫ `OPENAI_API_KEY`

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–∏–º–∏—Ç–æ–≤
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –º–µ—Å—è—á–Ω—ã–µ –ª–∏–º–∏—Ç—ã —Ä–∞—Å—Ö–æ–¥–æ–≤
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏
- –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ dashboard

### 3. FAL AI

#### –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–ª—é—á–∞
1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ https://fal.ai
2. –ü–æ–ª—É—á–∏—Ç–µ API –∫–ª—é—á –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –∞–∫–∫–∞—É–Ω—Ç–∞
3. –î–æ–±–∞–≤—å—Ç–µ –∫–ª—é—á –≤ `.env` –∫–∞–∫ `FAL_API_KEY`

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhook
```bash
# Webhook URL –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ —Å—Ç–∞—Ç—É—Å–µ –æ–±—É—á–µ–Ω–∏—è
FAL_WEBHOOK_URL=https://yourdomain.com:8443/api/v1/avatar/status_update
```

## üåê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL –∏ –¥–æ–º–µ–Ω–∞

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Certbot
sudo apt install -y certbot

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
sudo certbot certonly --standalone -d yourdomain.com

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –¥–ª—è API —Å–µ—Ä–≤–µ—Ä–∞
sudo cp /etc/letsencrypt/live/yourdomain.com/fullchain.pem /opt/aisha_v2/api_server/ssl/
sudo cp /etc/letsencrypt/live/yourdomain.com/privkey.pem /opt/aisha_v2/api_server/ssl/
sudo chown $USER:$USER /opt/aisha_v2/api_server/ssl/*
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
```bash
# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ crontab
sudo crontab -e

# –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É:
0 12 * * * /usr/bin/certbot renew --quiet && systemctl restart aisha-api-server
```

## üöÄ –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤

### 1. –°–æ–∑–¥–∞–Ω–∏–µ systemd —Å–µ—Ä–≤–∏—Å–æ–≤

#### –û—Å–Ω–æ–≤–Ω–æ–π Telegram –±–æ—Ç
```bash
sudo tee /etc/systemd/system/aisha-bot.service > /dev/null <<EOF
[Unit]
Description=Aisha v2 Telegram Bot
After=network.target postgresql.service redis.service

[Service]
Type=simple
User=$USER
WorkingDirectory=/opt/aisha_v2
Environment=PATH=/opt/aisha_v2/venv/bin
ExecStart=/opt/aisha_v2/venv/bin/python -m app.main
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF
```

#### API —Å–µ—Ä–≤–µ—Ä –¥–ª—è webhook
```bash
sudo tee /etc/systemd/system/aisha-api-server.service > /dev/null <<EOF
[Unit]
Description=Aisha v2 API Server
After=network.target

[Service]
Type=simple
User=$USER
WorkingDirectory=/opt/aisha_v2/api_server
Environment=PATH=/opt/aisha_v2/venv/bin
ExecStart=/opt/aisha_v2/venv/bin/python run_api_server.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF
```

### 2. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
```bash
sudo systemctl daemon-reload
sudo systemctl start aisha-bot
sudo systemctl start aisha-api-server
sudo systemctl enable aisha-bot
sudo systemctl enable aisha-api-server
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
```bash
sudo systemctl status aisha-bot
sudo systemctl status aisha-api-server
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –ª–æ–≥–æ–≤
sudo mkdir -p /var/log/aisha_v2
sudo chown $USER:$USER /var/log/aisha_v2

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–æ—Ç–∞—Ü–∏–∏ –ª–æ–≥–æ–≤
sudo tee /etc/logrotate.d/aisha_v2 > /dev/null <<EOF
/var/log/aisha_v2/*.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 644 $USER $USER
    postrotate
        systemctl reload aisha-bot
        systemctl reload aisha-api-server
    endscript
}
EOF
```

### 2. Health check endpoints
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –±–æ—Ç–∞
curl http://localhost:8000/health

# –ü—Ä–æ–≤–µ—Ä–∫–∞ API —Å–µ—Ä–≤–µ—Ä–∞
curl https://localhost:8443/health

# –ü—Ä–æ–≤–µ—Ä–∫–∞ webhook —Å—Ç–∞—Ç—É—Å–∞
curl https://localhost:8443/api/v1/webhook/status
```

### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤
```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ –∏ CPU
htop

# –õ–æ–≥–∏ —Å–µ—Ä–≤–∏—Å–æ–≤
sudo journalctl -u aisha-bot -f
sudo journalctl -u aisha-api-server -f

# –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
tail -f /var/log/aisha_v2/app.log
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```bash
sudo apt install -y nginx

sudo tee /etc/nginx/sites-available/aisha_v2 > /dev/null <<EOF
server {
    listen 80;
    server_name yourdomain.com;
    return 301 https://\$server_name\$request_uri;
}

server {
    listen 443 ssl http2;
    server_name yourdomain.com;

    ssl_certificate /etc/letsencrypt/live/yourdomain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/yourdomain.com/privkey.pem;

    # API —Å–µ—Ä–≤–µ—Ä
    location /api/ {
        proxy_pass https://localhost:8443;
        proxy_set_header Host \$host;
        proxy_set_header X-Real-IP \$remote_addr;
        proxy_set_header X-Forwarded-For \$proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto \$scheme;
    }

    # MinIO –∫–æ–Ω—Å–æ–ª—å
    location /minio/ {
        proxy_pass http://localhost:9001;
        proxy_set_header Host \$host;
        proxy_set_header X-Real-IP \$remote_addr;
    }
}
EOF

sudo ln -s /etc/nginx/sites-available/aisha_v2 /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl restart nginx
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
```bash
# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
psql -h localhost -U aisha_user -d aisha_v2 -c "SELECT version();"

# Redis
redis-cli ping

# MinIO
mc admin info local

# –°–µ—Ä–≤–∏—Å—ã
systemctl is-active aisha-bot
systemctl is-active aisha-api-server
```

### 2. –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –±–æ—Ç—É
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–∞
# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ webhook
curl -X POST https://yourdomain.com:8443/api/v1/avatar/status_update \
  -H "Content-Type: application/json" \
  -d '{
    "request_id": "test_123",
    "status": "completed",
    "training_type": "portrait"
  }'
```

## üö® –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

#### –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
sudo systemctl status aisha-bot

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
sudo journalctl -u aisha-bot -n 50

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞
curl "https://api.telegram.org/bot<TOKEN>/getMe"
```

#### –û—à–∏–±–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
psql -h localhost -U aisha_user -d aisha_v2

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–π
cd /opt/aisha_v2
source venv/bin/activate
alembic current
alembic history
```

#### –ü—Ä–æ–±–ª–µ–º—ã —Å SSL
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
sudo certbot certificates

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ SSL
openssl s_client -connect yourdomain.com:8443

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
sudo certbot renew
```

#### –û—à–∏–±–∫–∏ FAL AI
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ API –∫–ª—é—á–∞
curl -H "Authorization: Key YOUR_FAL_API_KEY" https://fal.run/fal-ai/fast-sdxl

# –ü—Ä–æ–≤–µ—Ä–∫–∞ webhook
curl -X POST https://yourdomain.com:8443/api/v1/avatar/status_update \
  -H "Content-Type: application/json" \
  -d '{"test": true}'
```

## üìà –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PostgreSQL
```sql
-- /etc/postgresql/15/main/postgresql.conf
shared_buffers = 256MB
effective_cache_size = 1GB
maintenance_work_mem = 64MB
checkpoint_completion_target = 0.9
wal_buffers = 16MB
default_statistics_target = 100
random_page_cost = 1.1
effective_io_concurrency = 200
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Redis
```bash
# /etc/redis/redis.conf
maxmemory 512mb
maxmemory-policy allkeys-lru
save 900 1
save 300 10
save 60 10000
```

### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ monitoring tools
sudo apt install -y htop iotop nethogs

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
htop
iotop
nethogs
```

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞
```bash
cd /opt/aisha_v2
git pull origin main
source venv/bin/activate
pip install -r requirements.txt
alembic upgrade head
sudo systemctl restart aisha-bot
sudo systemctl restart aisha-api-server
```

### 2. –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
pg_dump -h localhost -U aisha_user aisha_v2 > backup_$(date +%Y%m%d).sql

# MinIO –¥–∞–Ω–Ω—ã–µ
mc mirror local/aisha-v2-avatars /backup/minio/avatars/
mc mirror local/aisha-v2-transcripts /backup/minio/transcripts/

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
cp .env /backup/config/env_$(date +%Y%m%d)
```

---

**üéâ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.**

### üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞
- –õ–æ–≥–∏: `/var/log/aisha_v2/`
- –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤: `systemctl status aisha-*`
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥: Health check endpoints
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `/opt/aisha_v2/docs/` 
# ‚úÖ –£—Å–ø–µ—à–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–≥–æ Aisha Bot

## üéØ –¶–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞

–í—Å–µ –ø—Ä–æ–±–ª–µ–º—ã —Å Telegram polling –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞–º–∏ –∏ –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ storage **–ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω—ã** –∏ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–≤–µ—Ä–µ 192.168.0.10.

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. ‚úÖ Telegram Polling –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–µ–ª–∞–ª–∏ polling –∫ Telegram API
- **–†–µ—à–µ–Ω–∏–µ**: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ primary + worker —Å —á–µ—Ç–∫–∏–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º —Ä–æ–ª–µ–π
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –¢–æ–ª—å–∫–æ `aisha-bot-primary` –¥–µ–ª–∞–µ—Ç polling, `aisha-worker-1` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏

### 2. ‚úÖ Storage Permissions
- **–ü—Ä–æ–±–ª–µ–º–∞**: `[Errno 13] Permission denied` –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∞—É–¥–∏–æ—Ñ–∞–π–ª–æ–≤
- **–†–µ—à–µ–Ω–∏–µ**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –≤ entrypoint + Docker volumes
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ñ–∞–π–ª—ã –≤ `/app/storage/temp` –∏ `/app/storage/audio`

### 3. ‚úÖ Worker Module
- **–ü—Ä–æ–±–ª–µ–º–∞**: `ModuleNotFoundError: No module named 'app.workers'`
- **–†–µ—à–µ–Ω–∏–µ**: –°–æ–∑–¥–∞–Ω –º–æ–¥—É–ª—å `app.workers.background_worker.BackgroundWorker`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: Worker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ

### 4. ‚úÖ Docker Volumes
- **–ü—Ä–æ–±–ª–µ–º–∞**: Bind mounts —Å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞–º–∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
- **–†–µ—à–µ–Ω–∏–µ**: –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–µ Docker volumes
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

## üìä –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –ø—Ä–æ–¥–∞–∫—à–Ω —Å–∏—Å—Ç–µ–º—ã

### –†–∞–±–æ—Ç–∞—é—â–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:
```
aisha-bot-primary     Up (healthy)    192.168.0.4:5000/aisha/bot:latest
aisha-worker-1        Up (healthy)    192.168.0.4:5000/aisha/bot:latest
aisha-webhook-api-1   Up (healthy)    192.168.0.4:5000/aisha/webhook:latest
aisha-webhook-api-2   Up (healthy)    192.168.0.4:5000/aisha/webhook:latest
```

### Docker Volumes:
```
aisha-backend_bot_storage_temp    # –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
aisha-backend_bot_storage_audio   # –ê—É–¥–∏–æ—Ñ–∞–π–ª—ã
aisha-backend_bot_logs           # –õ–æ–≥–∏
```

### –í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã:
- ‚úÖ PostgreSQL: 192.168.0.4:5432 (—Å—Ç–∞–±–∏–ª—å–Ω–æ)
- ‚úÖ Redis: 192.168.0.3:6379 (—Å—Ç–∞–±–∏–ª—å–Ω–æ)
- ‚úÖ MinIO: 192.168.0.4:9000 (—Å—Ç–∞–±–∏–ª—å–Ω–æ)
- ‚úÖ Docker Registry: 192.168.0.4:5000 (—Å—Ç–∞–±–∏–ª—å–Ω–æ)

## üöÄ –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

### –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
1. –°–æ–∑–¥–∞–Ω `docker-compose.bot.local.yml` –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω `docker/bot-entrypoint.sh` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∞–≤
3. –°–æ–∑–¥–∞–Ω –º–æ–¥—É–ª—å `app/workers/background_worker.py`
4. –û–±–Ω–æ–≤–ª–µ–Ω `app/core/config.py` —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π `INSTANCE_ID`
5. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ storage

### –ü—Ä–æ–¥–∞–∫—à–Ω —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ:
1. –°–æ–±—Ä–∞–Ω –∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –æ–±—Ä–∞–∑ –≤ registry: `192.168.0.4:5000/aisha/bot:latest`
2. –í—ã–ø–æ–ª–Ω–µ–Ω —Å–∫—Ä–∏–ø—Ç `scripts/production/deploy-fixed-bot.sh`
3. –û—á–∏—â–µ–Ω—ã —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–∑—ã –∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
4. –°–æ–∑–¥–∞–Ω—ã Docker volumes –¥–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è
5. –ó–∞–ø—É—â–µ–Ω—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Å –Ω–æ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π

## üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### ‚úÖ Storage Permissions Test:
```bash
docker exec aisha-bot-primary touch /app/storage/temp/test-permissions.txt
# –†–µ–∑—É–ª—å—Ç–∞—Ç: ‚úÖ –£—Å–ø–µ—à–Ω–æ
```

### ‚úÖ Polling Test:
```bash
curl -s "https://api.telegram.org/bot8063965284:AAHbvpOdnfTopf14xxTLdsXiMEl4sjqEVXU/getMe"
# –†–µ–∑—É–ª—å—Ç–∞—Ç: ‚úÖ Bot @KAZAI_Aisha_bot –∞–∫—Ç–∏–≤–µ–Ω
```

### ‚úÖ Worker Test:
```bash
docker logs aisha-worker-1 --tail 5
# –†–µ–∑—É–ª—å—Ç–∞—Ç: ‚úÖ Background worker –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
```

## üìÅ –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
- `docker-compose.bot.simple.yml` - Docker volumes –≤–º–µ—Å—Ç–æ bind mounts
- `docker/bot-entrypoint.sh` - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
- `app/workers/background_worker.py` - –ù–æ–≤—ã–π –º–æ–¥—É–ª—å –¥–ª—è —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á
- `app/core/config.py` - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ INSTANCE_ID
- `scripts/production/deploy-fixed-bot.sh` - –°–∫—Ä–∏–ø—Ç —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

### –õ–æ–∫–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
- `docker-compose.bot.local.yml` - –õ–æ–∫–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## üõ†Ô∏è –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞:
```bash
ssh aisha@192.168.0.10 "docker ps --format 'table {{.Names}}\t{{.Status}}'"
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤:
```bash
ssh aisha@192.168.0.10 "docker logs aisha-bot-primary --tail 20 -f"
ssh aisha@192.168.0.10 "docker logs aisha-worker-1 --tail 20 -f"
```

### –¢–µ—Å—Ç –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞:
```bash
ssh aisha@192.168.0.10 "docker exec aisha-bot-primary touch /app/storage/temp/test.ogg"
```

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–í—Å–µ –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ —Ü–µ–ª–∏ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç—ã:**

1. ‚úÖ **–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã polling —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã** - –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ –±–µ–∑ –æ—à–∏–±–æ–∫ "Conflict: terminated by other getUpdates request"
2. ‚úÖ **Storage permissions –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã** - –Ω–µ—Ç –æ—à–∏–±–æ–∫ "[Errno 13] Permission denied"
3. ‚úÖ **Worker –º–æ–¥—É–ª—å —Å–æ–∑–¥–∞–Ω** - —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
4. ‚úÖ **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞** - —á–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ primary + worker
5. ‚úÖ **–£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏—é** - Docker volumes —Å–æ—Ö—Ä–∞–Ω—è—é—Ç –¥–∞–Ω–Ω—ã–µ –∏ –ø—Ä–∞–≤–∞

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç–µ!** üöÄ

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤ —á–µ—Ä–µ–∑ `docker logs`
- –ü—Ä–æ–≤–µ—Ä–∫—É —Å—Ç–∞—Ç—É—Å–∞ —á–µ—Ä–µ–∑ `docker ps`
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ —á–µ—Ä–µ–∑ `docker exec`
- –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ `docker-compose restart`

**–û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞: Telegram Bot API —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤!** 
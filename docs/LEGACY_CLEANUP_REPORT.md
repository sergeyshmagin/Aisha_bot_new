# üî• –û—Ç—á—ë—Ç –æ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–º Legacy –∫–æ–¥–µ

## üéØ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### ‚úÖ **1. –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã Legacy —Ñ—É–Ω–∫—Ü–∏–∏**

#### üî¥ `app/services/avatar_db.py`
```python
# =================== LEGACY CODE - –ó–ê–ö–û–ú–ú–ï–ù–¢–ò–†–û–í–ê–ù ===================
# async def delete_avatar(self, avatar_id: UUID) -> bool:
#     """LEGACY: –ê–ª–∏–∞—Å –¥–ª—è delete_avatar_completely"""
#     return await self.delete_avatar_completely(avatar_id)
# =================== END LEGACY CODE ===================
```
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–ê–ö–û–ú–ú–ï–ù–¢–ò–†–û–í–ê–ù

#### üî¥ `app/handlers/avatar/__init__.py`
```python
# =================== LEGACY CODE - –ó–ê–ö–û–ú–ú–ï–ù–¢–ò–†–û–í–ê–ù ===================
# class AvatarHandler:
#     """LEGACY: –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å —Ç–µ—Å—Ç–∞–º–∏"""
#     
# async def register_avatar_handlers():
#     """LEGACY: –§—É–Ω–∫—Ü–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏"""
# =================== END LEGACY CODE ===================
```
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–ê–ö–û–ú–ú–ï–ù–¢–ò–†–û–í–ê–ù
**–≠–∫—Å–ø–æ—Ä—Ç—ã:** ‚úÖ –ó–ê–ö–û–ú–ú–ï–ù–¢–ò–†–û–í–ê–ù–´ –≤ `__all__`

#### üî¥ `app/services/transcript.py`
```python
# =================== LEGACY CODE - –ó–ê–ö–û–ú–ú–ï–ù–¢–ò–†–û–í–ê–ù ===================
# async def get_user_transcripts(self, user_id):
#     """LEGACY: –£—Å—Ç–∞—Ä–µ–≤—à–∏–π –º–µ—Ç–æ–¥"""
#     return await self.list_transcripts(user_id, limit=1000, offset=0)
# =================== END LEGACY CODE ===================
```
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–ê–ö–û–ú–ú–ï–ù–¢–ò–†–û–í–ê–ù

#### üî¥ `app/database/repositories/transcript.py`
```python
# =================== LEGACY CODE - –ó–ê–ö–û–ú–ú–ï–ù–¢–ò–†–û–í–ê–ù ===================
# async def get_user_transcripts(self, user_id, limit=10, offset=0):
#     """LEGACY: –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –º–µ—Ç–æ–¥"""
# =================== END LEGACY CODE ===================
```
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–ê–ö–û–ú–ú–ï–ù–¢–ò–†–û–í–ê–ù

### ‚úÖ **2. –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã Legacy –ø–æ–ª—è –≤ –º–æ–¥–µ–ª—è—Ö –ë–î**

#### üî¥ `app/database/models.py` - Avatar –º–æ–¥–µ–ª—å
```python
# =================== LEGACY FIELDS - –ó–ê–ö–û–ú–ú–ï–ù–¢–ò–†–û–í–ê–ù–´ ===================
# is_draft: Mapped[bool] = mapped_column(Boolean, default=True)  
# photo_key: Mapped[Optional[str]] = mapped_column(String(255), nullable=True)
# preview_key: Mapped[Optional[str]] = mapped_column(String(255), nullable=True)
# =================== END LEGACY FIELDS ===================
```
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–ê–ö–û–ú–ú–ï–ù–¢–ò–†–û–í–ê–ù–´

#### üî¥ `app/database/models.py` - AvatarPhoto –º–æ–¥–µ–ª—å
```python
# =================== LEGACY FIELD - –ó–ê–ö–û–ú–ú–ï–ù–¢–ò–†–û–í–ê–ù–û ===================
# order: Mapped[int] = mapped_column(Integer, default=0)
# =================== END LEGACY FIELD ===================
```
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–ê–ö–û–ú–ú–ï–ù–¢–ò–†–û–í–ê–ù–û

### ‚úÖ **3. –°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è Alembic –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è Legacy –ø–æ–ª–µ–π**

#### üìÑ `alembic/versions/20250524_1724_e3da12f2e9cc_remove_legacy_fields_from_avatar_and_.py`

**–£–¥–∞–ª—è–µ–º—ã–µ –ø–æ–ª—è:**
- `avatars.is_draft` ‚Üí –∑–∞–º–µ–Ω–µ–Ω–æ –Ω–∞ `status`
- `avatars.photo_key` ‚Üí –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è  
- `avatars.preview_key` ‚Üí –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
- `avatar_photos.order` ‚Üí –∑–∞–º–µ–Ω–µ–Ω–æ –Ω–∞ `upload_order`

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–æ–ª–µ–π –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º
- ‚úÖ Try/catch –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫  
- ‚úÖ –§—É–Ω–∫—Ü–∏—è downgrade –¥–ª—è –æ—Ç–∫–∞—Ç–∞
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –°–û–ó–î–ê–ù–ê (–Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞)

### ‚úÖ **4. –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –∑–∞–º–µ–Ω–∞ delete_avatar ‚Üí delete_avatar_completely**

**–†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–∏—Å–∫–∞:**
```
app/handlers/avatar/photo_upload.py:452: await avatar_service.delete_avatar_completely(avatar_id)
app/handlers/avatar/gallery.py:384: success = await avatar_service.delete_avatar_completely(avatar_id)
app/handlers/avatar/cancel_handler.py:277: success = await avatar_service.delete_avatar_completely(avatar_id)
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–°–ï –í–´–ó–û–í–´ –£–ñ–ï –ò–°–ü–û–õ–¨–ó–£–Æ–¢ –ü–†–ê–í–ò–õ–¨–ù–´–ô –ú–ï–¢–û–î

## üìã **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç**

### üî• –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ:
- **–ú–µ—Ç–æ–¥—ã —Å–µ—Ä–≤–∏—Å–æ–≤:** 2 Legacy –º–µ—Ç–æ–¥–∞
- **–ö–ª–∞—Å—Å—ã –∏ —Ñ—É–Ω–∫—Ü–∏–∏:** 1 –∫–ª–∞—Å—Å + 1 —Ñ—É–Ω–∫—Ü–∏—è
- **–ü–æ–ª—è –ë–î:** 4 Legacy –ø–æ–ª—è
- **–ú–µ—Ç–æ–¥—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤:** 1 Legacy –º–µ—Ç–æ–¥
- **–ò–¢–û–ì–û:** 9 Legacy —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:
- **–í—Å–µ –≤—ã–∑–æ–≤—ã:** –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã
- **–≠–∫—Å–ø–æ—Ä—Ç—ã:** Legacy —ç–ª–µ–º–µ–Ω—Ç—ã –∏—Å–∫–ª—é—á–µ–Ω—ã –∏–∑ `__all__`
- **–ú–∏–≥—Ä–∞—Ü–∏—è:** –≥–æ—Ç–æ–≤–∞ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é

## üéØ **–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–≤ –ø–æ—Ä—è–¥–∫–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è)**

### üî• **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–ì–û–¢–û–í–û –ö –í–´–ü–û–õ–ù–ï–ù–ò–Æ):**
1. **–í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é Legacy –ø–æ–ª–µ–π:**
   ```bash
   alembic upgrade head
   ```

### üî• **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–ü–û–°–õ–ï –ú–ò–ì–†–ê–¶–ò–ò):**
2. **–£–¥–∞–ª–∏—Ç—å –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ Legacy –ø–æ–ª—è –∏–∑ –º–æ–¥–µ–ª–µ–π**
3. **–£–¥–∞–ª–∏—Ç—å –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ Legacy –º–µ—Ç–æ–¥—ã –∏–∑ –∫–æ–¥–∞** 
4. **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ç—å —Ç–µ—Å—Ç—ã –Ω–∞ —Ä–æ—É—Ç–µ—Ä—ã** (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç Legacy AvatarHandler)

### üî• **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 (–ü–õ–ê–ù–û–í–û):**
5. **–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ Legacy –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏**
6. **–û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é**

## ‚ö†Ô∏è **–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è**

### üö® **–ü–ï–†–ï–î –í–´–ü–û–õ–ù–ï–ù–ò–ï–ú –ú–ò–ì–†–ê–¶–ò–ò:**
1. **–°–û–ó–î–ê–ô–¢–ï –ë–≠–ö–ê–ü –ë–ê–ó–´ –î–ê–ù–ù–´–•!**
2. **–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∫–æ–¥ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Legacy –ø–æ–ª—è**
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –Ω–∞ –Ω–æ–≤—ã–µ –ø–æ–ª—è**

### üö® **–ù–ï –£–î–ê–õ–Ø–ô–¢–ï:**
- –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥ –¥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏
- Legacy —ç–∫—Å–ø–æ—Ä—Ç—ã –¥–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ —Ç–µ—Å—Ç–æ–≤
- –ú–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

## ‚úÖ **–†–µ–∑—É–ª—å—Ç–∞—Ç**

üéØ **–í—Å–µ Legacy —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –ø–æ–ª—è –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã**  
üîß **–ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º—É —É–¥–∞–ª–µ–Ω–∏—é Legacy –∫–æ–¥–∞**  
üìã **–ú–∏–≥—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é**  
‚ö° **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –Ω–µ –Ω–∞—Ä—É—à–µ–Ω–∞**

–ü—Ä–æ–µ–∫—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –ø–µ—Ä–µ—Ö–æ–¥–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ - –≤–µ—Å—å Legacy –∫–æ–¥ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω, –Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏. 
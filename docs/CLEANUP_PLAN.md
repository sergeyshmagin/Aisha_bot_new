# üßπ –ü–õ–ê–ù –û–ß–ò–°–¢–ö–ò –°–ò–°–¢–ï–ú–´ AISHA BACKEND

## üìÖ –î–∞—Ç–∞: 2024-12-11
## üéØ –¶–µ–ª—å: –û—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö —Ñ–∞–π–ª–æ–≤, —Å–∫—Ä–∏–ø—Ç–æ–≤ –∏ –æ–±—Ä–∞–∑–æ–≤ –¥–ª—è —á–∏—Å—Ç–æ–≥–æ –ø—Ä–æ–¥–∞–∫—à–Ω –¥–µ–ø–ª–æ—è

---

## üìã 1. –ò–ù–í–ï–ù–¢–ê–†–ò–ó–ê–¶–ò–Ø API_SERVER

### ‚úÖ **–ê–ö–¢–£–ê–õ–¨–ù–´–ï –§–ê–ô–õ–´:**
- `webhook_main.py` - –æ—Å–Ω–æ–≤–Ω–æ–π webhook —Å–µ—Ä–≤–µ—Ä (496 —Å—Ç—Ä–æ–∫) **KEEP**
- `Dockerfile.webhook` - Docker –æ–±—Ä–∞–∑ –¥–ª—è webhook API **KEEP**
- `requirements.txt` - –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python **KEEP**
- `README.md` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API —Å–µ—Ä–≤–µ—Ä–∞ **KEEP**
- `env.example` - –ø—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ **KEEP**
- `ssl/` - SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã **KEEP**

### ‚ùå **LEGACY –§–ê–ô–õ–´ (–ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω—ã):**
- `main_LEGACY.py` - —É—Å—Ç–∞—Ä–µ–≤—à–∏–π –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª **DELETE**
- `test_main_LEGACY.py` - –ø—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç **DELETE**
- `run_api_server_LEGACY.py` - —É—Å—Ç–∞—Ä–µ–≤—à–∏–π –∑–∞–ø—É—Å–∫–∞—Ç–µ–ª—å **DELETE**
- `app_LEGACY/` - –¥—É–±–ª–∏—Ä—É—é—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ **DELETE**
- `legacy_main.py` - —É–∂–µ –ø–æ–º–µ—á–µ–Ω–Ω—ã–π legacy **DELETE**

---

## üìã 2. –ò–ù–í–ï–ù–¢–ê–†–ò–ó–ê–¶–ò–Ø –°–ö–†–ò–ü–¢–û–í

### ‚úÖ **–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–´–ï –°–ö–†–ò–ü–¢–´:**
- `scripts/test_webhook_system.py` - —Å–∏—Å—Ç–µ–º–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è **KEEP**
- `scripts/deploy/webhook-remote-deploy.sh` - —É–¥–∞–ª–µ–Ω–Ω—ã–π –¥–µ–ø–ª–æ–π **KEEP**
- `scripts/production/manage-webhook.sh` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ webhook **KEEP**
- `scripts/production/safe-cleanup.sh` - –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ **KEEP**

### ‚ö†Ô∏è **–£–°–¢–ê–†–ï–í–®–ò–ï –°–ö–†–ò–ü–¢–´ (–∫ –∞–Ω–∞–ª–∏–∑—É):**
- `scripts/deploy-local.sh` - –ª–æ–∫–∞–ª—å–Ω—ã–π –¥–µ–ø–ª–æ–π **ANALYZE**
- `scripts/local-dev-setup.sh` - –ª–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ **ANALYZE**
- `scripts/quick-dev.sh` - –±—ã—Å—Ç—Ä–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ **ANALYZE**
- `scripts/production/deploy_production_minimal.sh` - –±–æ–ª—å—à–æ–π —Å–∫—Ä–∏–ø—Ç **ANALYZE**
- `scripts/production/fix-telegram-webhook.sh` - —Ñ–∏–∫—Å telegram **ANALYZE**
- `scripts/production/deploy-transcription-fix.sh` - —Ñ–∏–∫—Å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏ **ANALYZE**

### ‚ùå **–î–£–ë–õ–ò–†–£–Æ–©–ò–ï –°–ö–†–ò–ü–¢–´:**
- `scripts/setup-registry.sh` + `scripts/deploy/setup-registry.sh` **MERGE**
- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –¥–µ–ø–ª–æ–π —Å–∫—Ä–∏–ø—Ç—ã **CONSOLIDATE**

---

## üìã 3. –ò–ù–í–ï–ù–¢–ê–†–ò–ó–ê–¶–ò–Ø –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–ò

### ‚úÖ **–ê–ö–¢–£–ê–õ–¨–ù–ê–Ø –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø:**
- `docs/WEBHOOK_DEPLOYMENT.md` - –¥–µ–ø–ª–æ–π webhook **KEEP**
- `docs/architecture.md` - –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ **KEEP**
- `docs/best_practices.md` - –ª—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ **KEEP**
- `docs/TASK.md` - —Ç–µ–∫—É—â–∏–µ –∑–∞–¥–∞—á–∏ **KEEP**
- `docs/STATUS_CURRENT.md` - —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å **UPDATE**

### ‚ö†Ô∏è **–ö –û–ë–ù–û–í–õ–ï–ù–ò–Æ:**
- `docs/PLANNING.md` - –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ **UPDATE**
- `docs/DEPLOYMENT.md` - –æ–±—â–∏–π –¥–µ–ø–ª–æ–π **UPDATE**
- `docs/README.md` - –≥–ª–∞–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è **UPDATE**

### ‚ùå **–£–°–¢–ê–†–ï–í–®–ò–ï:**
- `docs/GALLERY_FIXES.md` - —Ñ–∏–∫—Å—ã –≥–∞–ª–µ—Ä–µ–∏ **DELETE**
- `docs/PAYMENT_SYSTEM.md` - –ø–ª–∞—Ç–µ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ **ANALYZE**

---

## üßπ 4. –ü–õ–ê–ù –û–ß–ò–°–¢–ö–ò DOCKER REGISTRY

### üì¶ **–¢–µ–∫—É—â–∏–µ –æ–±—Ä–∞–∑—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:**
```bash
# –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –æ–±—Ä–∞–∑–æ–≤ –≤ registry
curl -X GET http://192.168.0.4:5000/v2/_catalog

# –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–≥–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–±—Ä–∞–∑–∞
curl -X GET http://192.168.0.4:5000/v2/{image}/tags/list
```

### üéØ **–°—Ç—Ä–∞—Ç–µ–≥–∏—è –æ—á–∏—Å—Ç–∫–∏:**
1. **–û—Å—Ç–∞–≤–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 –≤–µ—Ä—Å–∏–∏** –∫–∞–∂–¥–æ–≥–æ –æ–±—Ä–∞–∑–∞
2. **–£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç–æ–≤—ã–µ** –æ–±—Ä–∞–∑—ã (—Å–æ–¥–µ—Ä–∂–∞—â–∏–µ test, temp, debug)
3. **–û—Å—Ç–∞–≤–∏—Ç—å production –æ–±—Ä–∞–∑—ã** (webhook-api:final, nginx-webhook:latest)

---

## üóÇÔ∏è 5. –ü–õ–ê–ù –û–ß–ò–°–¢–ö–ò –ü–†–û–î–ê–ö–®–ù –°–ï–†–í–ï–†–ê

### üìä **–ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞
ssh aisha@192.168.0.10 "df -h"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
ssh aisha@192.168.0.10 "docker ps -a"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±—Ä–∞–∑—ã
ssh aisha@192.168.0.10 "docker images"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å volumes
ssh aisha@192.168.0.10 "docker volume ls"
```

### üßπ **–î–µ–π—Å—Ç–≤–∏—è –æ—á–∏—Å—Ç–∫–∏:**
1. **–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã**
2. **–£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–∑—ã** (–∫—Ä–æ–º–µ —Ç–µ–∫—É—â–∏—Ö)
3. **–û—á–∏—Å—Ç–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ volumes**
4. **–û—á–∏—Å—Ç–∏—Ç—å Docker build cache**

---

## üöÄ 6. –ü–õ–ê–ù –ß–ò–°–¢–û–ì–û –î–ï–ü–õ–û–Ø

### üéØ **–¶–µ–ª—å:** –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å —Ç–æ–ª—å–∫–æ webhook API + nginx

### üìù **–®–∞–≥–∏:**
1. **–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã**
2. **–û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏ –æ–±—Ä–∞–∑—ã**
3. **–°–æ–±—Ä–∞—Ç—å –Ω–æ–≤—ã–π webhook-api –æ–±—Ä–∞–∑**
4. **–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å nginx + webhook API**
5. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å**
6. **–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω—ã–µ —Ç–µ—Å—Ç—ã**

### üîß **–§–∞–π–ª—ã –¥–ª—è –¥–µ–ø–ª–æ—è:**
- `docker-compose.webhook.prod.yml` - –æ—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- `scripts/deploy/webhook-remote-deploy.sh` - —Å–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è
- `scripts/test_webhook_system.py` - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## ‚úÖ 7. –ö–†–ò–¢–ï–†–ò–ò –£–°–ü–ï–•–ê

- [ ] –í—Å–µ legacy —Ñ–∞–π–ª—ã —É–¥–∞–ª–µ–Ω—ã
- [ ] –û—Å—Ç–∞–ª–∏—Å—å —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
- [ ] Docker registry –æ—á–∏—â–µ–Ω (< 5 GB)
- [ ] –ü—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–≤–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç < 80% –¥–∏—Å–∫–∞
- [ ] Webhook API —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∞–∫—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞

---

## üìû –ö–û–ù–¢–ê–ö–¢–´ –î–õ–Ø –ü–û–î–î–ï–†–ñ–ö–ò

- **Webhook endpoints:** http://192.168.0.10:8001, :8002
- **Registry:** 192.168.0.4:5000
- **Database:** 192.168.0.4:5432
- **Redis:** 192.168.0.3:6379 
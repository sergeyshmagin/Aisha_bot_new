# –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ Aisha v2

**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** 26.05.2025  
**–¢–µ–∫—É—â–∏–π —ç—Ç–∞–ø:** –§–∞–∑–∞ 4 - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å FAL AI

## üéØ –û–±—â–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è

### –¶–µ–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞
1. **–ú–∏–≥—Ä–∞—Ü–∏—è v1 ‚Üí v2** —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π
2. **–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å—Ç–µ–∫** (aiogram 3.x, SQLAlchemy async, MinIO)
3. **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å** –∏ —Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å
4. **–ü–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏**
5. **–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω–∞—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å**

### –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã
- **Clean Architecture** —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –Ω–∞ —Å–ª–æ–∏
- **Dependency Injection** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
- **Async-first** –ø–æ–¥—Ö–æ–¥ –¥–ª—è –≤—Å–µ—Ö I/O –æ–ø–µ—Ä–∞—Ü–∏–π
- **Type hints** –∏ —Å—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è
- **Comprehensive logging** —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
aisha_v2/
‚îú‚îÄ‚îÄ alembic/            # –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ app/                # –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ core/           # –Ø–¥—Ä–æ (–∫–æ–Ω—Ñ–∏–≥–∏, –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã, –∏—Å–∫–ª—é—á–µ–Ω–∏—è)
‚îÇ   ‚îú‚îÄ‚îÄ database/       # –ú–æ–¥–µ–ª–∏ –∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models/     # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ repositories/ # –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ handlers/       # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –±–æ—Ç–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ avatar/     # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∞–≤–∞—Ç–∞—Ä–æ–≤ (–º–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ gallery/    # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≥–∞–ª–µ—Ä–µ–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ transcript/ # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ keyboards/      # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è –±–æ—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ services/       # –°–µ—Ä–≤–∏—Å—ã (–±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ avatar/     # –°–µ—Ä–≤–∏—Å—ã –∞–≤–∞—Ç–∞—Ä–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ transcript/ # –°–µ—Ä–≤–∏—Å—ã —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ fal/        # FAL AI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ storage/    # –†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ texts/          # –¢–µ–∫—Å—Ç—ã UI
‚îÇ   ‚îî‚îÄ‚îÄ utils/          # –£—Ç–∏–ª–∏—Ç—ã
‚îú‚îÄ‚îÄ docs/               # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ scripts/            # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã (–≤–∫–ª—é—á–∞—è –º–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã)
‚îú‚îÄ‚îÄ storage/            # –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
‚îî‚îÄ‚îÄ tests/              # –¢–µ—Å—Ç—ã (–≤–∫–ª—é—á–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—é —Å—Ö–µ–º—ã –ë–î)
```

## üöÄ –≠—Ç–∞–ø—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### ‚úÖ –≠—Ç–∞–ø 1: –§—É–Ω–¥–∞–º–µ–Ω—Ç (–ó–ê–í–ï–†–®–ï–ù)
**–°—Ä–æ–∫:** –ú–∞–π 2025
- ‚úÖ –ë–∞–∑–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
- ‚úÖ –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö (User, UserTranscript, Avatar, AvatarPhoto)
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å PostgreSQL (SQLAlchemy async)
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å MinIO –¥–ª—è —Ñ–∞–π–ª–æ–≤
- ‚úÖ –ë–∞–∑–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã –∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
- ‚úÖ FSM —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π

### ‚úÖ –≠—Ç–∞–ø 2: –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è (–ó–ê–í–ï–†–®–ï–ù)
**–°—Ä–æ–∫:** –ú–∞–π 2025
- ‚úÖ –ü–æ–ª–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏
- ‚úÖ `AudioProcessingService` —Å Whisper API
- ‚úÖ `TextProcessingService` —Å GPT –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
- ‚úÖ `TranscriptService` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞–º–∏
- ‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–æ–≤ —Å –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π
- ‚úÖ –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (summary, todo, protocol)

### ‚úÖ –≠—Ç–∞–ø 3–ê: –ê–≤–∞—Ç–∞—Ä—ã –§–∞–∑–∞ 1-2 (–ó–ê–í–ï–†–®–ï–ù)
**–°—Ä–æ–∫:** –ú–∞–π 2025
- ‚úÖ –ú–æ–¥–µ–ª–∏ –∞–≤–∞—Ç–∞—Ä–æ–≤ (Avatar, AvatarPhoto)
- ‚úÖ `AvatarService` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–∞–º–∏
- ‚úÖ `PhotoUploadService` —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –∏–∑ Telegram –≤ MinIO
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è (—Ä–∞–∑–º–µ—Ä, —Ñ–æ—Ä–º–∞—Ç, –¥—É–±–ª–∏–∫–∞—Ç—ã)
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å–æ–∑–¥–∞–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–æ–≤

### ‚úÖ –≠—Ç–∞–ø 3–ë: FAL AI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (–ó–ê–í–ï–†–®–ï–ù)
**–°—Ä–æ–∫:** 26.05.2025
- ‚úÖ **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: 18 –ø–æ–ª–µ–π FAL AI –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ –º–æ–¥–µ–ª—å Avatar
- ‚úÖ **–ú–∏–≥—Ä–∞—Ü–∏–∏**: –°–∏—Å—Ç–µ–º–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Alembic
- ‚úÖ **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: –ß–∏—Å—Ç–∞—è –º–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ handlers
- ‚úÖ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ö–µ–º—ã –ë–î (9 —Ç–µ—Å—Ç–æ–≤)
- ‚úÖ **Enum —Ç–∏–ø—ã**: AvatarTrainingType, FALFinetuneType, FALPriority
- ‚úÖ **–ò–Ω–¥–µ–∫—Å—ã**: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è FAL AI –ø–æ–ª–µ–π
- ‚úÖ **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**: Alembic –≤–µ—Ä—Å–∏—è 5088361401fe –ø—Ä–∏–º–µ–Ω–µ–Ω–∞

### üöß –≠—Ç–∞–ø 4: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (–¢–ï–ö–£–©–ò–ô)
**–°—Ä–æ–∫:** –ö–æ–Ω–µ—Ü –º–∞—è 2025
- üîÑ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ `FalAIClient` —Å –º–µ—Ç–æ–¥–∞–º–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- üîÑ `AvatarTrainingService` –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π
- ‚è≥ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –æ–±—É—á–µ–Ω–∏—è
- ‚è≥ Webhook backend –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- ‚è≥ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –æ–±—É—á–µ–Ω–∏—è

### ‚è≥ –≠—Ç–∞–ø 5: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π 
**–°—Ä–æ–∫:** –ò—é–Ω—å 2025
- [ ] `ImageGenerationService` —Å –æ–±—É—á–µ–Ω–Ω—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏
- [ ] –ü—Ä–æ–º–ø—Ç-–∏–Ω–∂–∏–Ω–∏—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º–∞
- [ ] –ì–∞–ª–µ—Ä–µ—è —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- [ ] –≠–∫—Å–ø–æ—Ä—Ç –∏ —à–∞—Ä–∏–Ω–≥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### ‚è≥ –≠—Ç–∞–ø 6: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
**–°—Ä–æ–∫:** –ò—é–Ω—å 2025
- [ ] Unit-—Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- [ ] –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- [ ] –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

## üéØ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –Ω–∞ —Ç–µ–∫—É—â–∏–π —ç—Ç–∞–ø

### –§–∞–∑–∞ 4: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ FAL AI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

#### –ü–µ—Ä–≤–æ–æ—á–µ—Ä–µ–¥–Ω—ã–µ –∑–∞–¥–∞—á–∏
1. **–ó–∞–≤–µ—Ä—à–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å FAL AI API**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ –ø–æ–ª—è –≤ `AvatarTrainingService`
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤—ã–±–æ—Ä —Ç–∏–ø–∞ –æ–±—É—á–µ–Ω–∏—è –≤ UI
   - –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å webhook –æ–±—Ä–∞–±–æ—Ç–∫—É

2. **–û–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å**
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ –æ–±—É—á–µ–Ω–∏—è (portrait/style)
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –æ–±—É—á–µ–Ω–∏—è
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏

3. **–†–∞—Å—à–∏—Ä–∏—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã FAL AI
   - –¢–µ—Å—Ç—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∞–≤–∞—Ç–∞—Ä–æ–≤
   - –í–∞–ª–∏–¥–∞—Ü–∏—è webhook –æ–±—Ä–∞–±–æ—Ç–∫–∏

#### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≥–æ—Ç–æ–≤–∞**: 18 –ø–æ–ª–µ–π FAL AI –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å—Ç–∞–±–∏–ª—å–Ω–∞**: –ë–µ–∑ legacy –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ**: 9 —Ç–µ—Å—Ç–æ–≤ —Å—Ö–µ–º—ã –ë–î –ø—Ä–æ—à–ª–∏
- **–ú–∏–≥—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç**: –í–µ—Ä—Å–∏—è 5088361401fe –ø—Ä–∏–º–µ–Ω–µ–Ω–∞

## üîß –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
1. **–°–µ—Ä–≤–∏—Å—ã —Å–æ–¥–µ—Ä–∂–∞—Ç –≤—Å—é –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É**
2. **–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ç–æ–ª—å–∫–æ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É—é—Ç –∑–∞–ø—Ä–æ—Å—ã**
3. **–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä—É—é—Ç —Ä–∞–±–æ—Ç—É —Å –ë–î**
4. **–í—Å–µ –≤–Ω–µ—à–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ dedicated —Å–µ—Ä–≤–∏—Å—ã**

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```python
# FAL AI –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
FAL_API_KEY: str
FAL_TRAINING_TEST_MODE: bool = True
FAL_WEBHOOK_URL: Optional[str]
FAL_DEFAULT_MODE: str = "character"
FAL_DEFAULT_ITERATIONS: int = 500

# –õ–∏–º–∏—Ç—ã –∞–≤–∞—Ç–∞—Ä–æ–≤
AVATAR_MIN_PHOTOS: int = 10
AVATAR_MAX_PHOTOS: int = 20
PHOTO_MAX_SIZE: int = 20971520  # 20MB

# MinIO buckets
MINIO_BUCKET_AVATARS: str = "aisha-v2-avatars"
MINIO_BUCKET_TRANSCRIPTS: str = "aisha-v2-transcripts"
```

### –°—Ç–∞—Ç—É—Å–Ω–∞—è –º–æ–¥–µ–ª—å –∞–≤–∞—Ç–∞—Ä–æ–≤
```python
class AvatarStatus(str, Enum):
    DRAFT = "draft"                    # –°–æ–∑–¥–∞–Ω, –Ω–µ –≥–æ—Ç–æ–≤
    PHOTOS_UPLOADING = "uploading"     # –ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Ñ–æ—Ç–æ
    READY_FOR_TRAINING = "ready"       # –ì–æ—Ç–æ–≤ –∫ –æ–±—É—á–µ–Ω–∏—é
    TRAINING = "training"              # –û–±—É—á–∞–µ—Ç—Å—è –Ω–∞ FAL AI
    COMPLETED = "completed"            # –û–±—É—á–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ
    ERROR = "error"                    # –û—à–∏–±–∫–∞ –æ–±—É—á–µ–Ω–∏—è
    CANCELLED = "cancelled"            # –û—Ç–º–µ–Ω–µ–Ω–æ
```

### –ù–æ–≤—ã–µ –ø–æ–ª—è FAL AI (–∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã)
```python
# –û—Å–Ω–æ–≤–Ω—ã–µ FAL –ø–æ–ª—è
training_type: Optional[AvatarTrainingType]  # portrait, style, object
fal_request_id: Optional[str]               # ID –∑–∞–ø—Ä–æ—Å–∞ –≤ FAL AI
learning_rate: Optional[float]              # –°–∫–æ—Ä–æ—Å—Ç—å –æ–±—É—á–µ–Ω–∏—è
trigger_phrase: Optional[str]               # –ö–ª—é—á–µ–≤–∞—è —Ñ—Ä–∞–∑–∞
steps: Optional[int]                        # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–∞–≥–æ–≤

# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–±—É—á–µ–Ω–∏—è
multiresolution_training: Optional[bool]    # –ú—É–ª—å—Ç–∏—Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ
subject_crop: Optional[bool]                # –ö—Ä–æ–ø —Å—É–±—ä–µ–∫—Ç–∞
create_masks: Optional[bool]                # –°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Å–æ–∫
captioning: Optional[bool]                  # –ê–≤—Ç–æ–ø–æ–¥–ø–∏—Å–∏

# –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ —Ñ–∞–π–ª—ã
finetune_type: Optional[FALFinetuneType]    # lora, dreambooth
diffusers_lora_file_url: Optional[str]      # URL LoRA —Ñ–∞–π–ª–∞
config_file_url: Optional[str]              # URL –∫–æ–Ω—Ñ–∏–≥–∞
training_logs: Optional[str]                # –õ–æ–≥–∏ –æ–±—É—á–µ–Ω–∏—è
training_error: Optional[str]               # –û—à–∏–±–∫–∏ –æ–±—É—á–µ–Ω–∏—è

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ webhook
webhook_url: Optional[str]                  # URL –¥–ª—è webhook
last_status_check: Optional[datetime]       # –ü–æ—Å–ª–µ–¥–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞
fal_response_data: Optional[dict]           # –ü–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç FAL AI
```

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- **–¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è**: 100% —Ñ—É–Ω–∫—Ü–∏–π –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ ‚úÖ
- **–ê–≤–∞—Ç–∞—Ä—ã –§–∞–∑–∞ 1-2**: 100% –∑–∞–≤–µ—Ä—à–µ–Ω–æ ‚úÖ
- **FAL AI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ë–î**: 100% –∑–∞–≤–µ—Ä—à–µ–Ω–æ ‚úÖ
- **FAL AI UI –∏ API**: 60% –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ üîÑ

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏
- **–ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏**: 40% (–ë–î schema + –æ—Å–Ω–æ–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã)
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: <3 —Å–µ–∫ –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—é
- **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: 99.9% uptime
- **–ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î**: 100% —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å ‚úÖ

### UX –º–µ—Ç—Ä–∏–∫–∏
- **–í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–∞**: <30 –º–∏–Ω
- **–£—Å–ø–µ—à–Ω–æ—Å—Ç—å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏**: >95%
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –æ—à–∏–±–∫–∏**: <5%

## üö® –†–∏—Å–∫–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∏—Å–∫–∏
1. **FAL AI –ª–∏–º–∏—Ç—ã** - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è API –≤ —Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
2. **MinIO production** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
3. **Webhook delivery** - –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### –í—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
1. **FAL AI –æ–±—É—á–µ–Ω–∏–µ** - 15-60 –º–∏–Ω—É—Ç –Ω–∞ –º–æ–¥–µ–ª—å
2. **–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ** - –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
3. **–¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è** - –¥–æ 10 –º–∏–Ω—É—Ç –¥–ª—è —á–∞—Å–æ–≤–æ–≥–æ –∞—É–¥–∏–æ

### –ú–∏—Ç–∏–≥–∞—Ü–∏—è
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –ø–æ–ª–Ω–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –º–∏–≥—Ä–∞—Ü–∏–π
- ‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ—á–∏—â–µ–Ω–∞ –æ—Ç legacy –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
- ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –±—ç–∫–∞–ø—ã –¥–∞–Ω–Ω—ã—Ö

## üõ†Ô∏è –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

### –ú–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (—Å–æ–∑–¥–∞–Ω—ã)
1. **`check_migration_sync.py`** - –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ Alembic
2. **`reset_migrations.py`** - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞
3. **`diagnose_alembic_env.py`** - –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è  
4. **`force_apply_migration.py`** - –ø—Ä—è–º–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ SQL
5. **`migration_diagnosis_report.py`** - –∏—Ç–æ–≥–æ–≤—ã–µ –æ—Ç—á–µ—Ç—ã

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ)
- **`tests/test_database_schema.py`** - –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ö–µ–º—ã –ë–î
- **`pytest.ini`** - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è asyncio
- **9 —Ç–µ—Å—Ç–æ–≤** - –≤—Å–µ –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### 1. –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ (—Å–µ–≥–æ–¥–Ω—è-–∑–∞–≤—Ç—Ä–∞)
- üîÑ **–ó–∞–≤–µ—Ä—à–∏—Ç—å `FalAIClient`** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ –ø–æ–ª—è –ë–î
- üîÑ **–û–±–Ω–æ–≤–∏—Ç—å UI –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞** - –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å training_type
- üîÑ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å webhook** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é

### 2. –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ (–Ω–µ–¥–µ–ª—è)
- üéØ **–î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã** - FAL AI —Å–µ—Ä–≤–∏—Å—ã
- üéØ **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ –∏–Ω–¥–µ–∫—Å—ã
- üéØ **–†–∞—Å—à–∏—Ä–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ FAL AI –æ–ø–µ—Ä–∞—Ü–∏–π

### 3. –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω—ã–µ (–º–µ—Å—è—Ü)
- üöÄ **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É** - –ø–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- üöÄ **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API** - –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
- üöÄ **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** - –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏–Ω–¥–µ–∫—Å—ã 
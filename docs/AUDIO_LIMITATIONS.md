# Ограничения обработки аудио файлов

## Лимиты Telegram Bot API

### Размер файлов
- **Максимальный размер через Bot API:** 20 МБ
- **Максимальный размер через веб-интерфейс:** 2 ГБ (недоступно для ботов)

### Техническое ограничение
Telegram Bot API не предоставляет `file_path` для файлов больше 20 МБ через метод `getFile`. Это означает, что боты не могут скачивать файлы больше этого размера.

## Текущая реализация

### Обработка файлов
```python
# Файлы ≤ 20 МБ
if file_size <= TELEGRAM_API_LIMIT:
    file = await bot.get_file(file_id)
    downloaded_file = await bot.download_file(file.file_path)

# Файлы > 20 МБ  
else:
    # Уведомляем пользователя об ограничении
    await message.reply("❌ Файл слишком большой")
```

### Пользовательские уведомления
При отправке файла больше 20 МБ пользователь получает:
- Размер отправленного файла
- Максимально допустимый размер
- Рекомендации по сжатию

## Рекомендации для пользователей

### Сжатие аудио
1. **MP3 с низким битрейтом** (128 kbps)
2. **Уменьшение частоты дискретизации** (22 kHz вместо 44 kHz)
3. **Моно вместо стерео**

### Разделение файлов
- Разделить длинные записи на части по 15-20 минут
- Каждая часть должна быть меньше 20 МБ

### Форматы
Поддерживаемые форматы: MP3, WAV, OGG, M4A, FLAC, AAC

## Альтернативные решения

### Для больших файлов
1. **Облачные ссылки:** Пользователи могут загрузить файл в облако и отправить ссылку
2. **Внешние сервисы:** Интеграция с Google Drive, Dropbox и т.д.
3. **Веб-интерфейс:** Создание веб-страницы для загрузки больших файлов

### Будущие улучшения
- Интеграция с облачными хранилищами
- Автоматическое сжатие на стороне клиента
- Поддержка потокового скачивания через прямые ссылки

## Логирование

### Успешная обработка
```
[AUDIO_UNIVERSAL] Обычное скачивание файла: 15.2 МБ
```

### Отклонение больших файлов
```
[AUDIO_UNIVERSAL] Файл слишком большой для обработки: 57378866 байт
```

## Конфигурация

```python
# app/core/config.py
MAX_AUDIO_SIZE: int = 1024 * 1024 * 1024  # 1 ГБ (теоретический лимит)
TELEGRAM_API_LIMIT: int = 20 * 1024 * 1024  # 20 МБ (реальный лимит)
MAX_AUDIO_DURATION: int = 7200  # 2 часа
AUDIO_FORMATS: List[str] = ["mp3", "wav", "ogg", "m4a", "flac", "aac"]
``` 
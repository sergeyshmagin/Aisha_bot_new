# üì∏ –£–ª—É—á—à–µ–Ω–∏—è –∞–Ω–∞–ª–∏–∑–∞ —Ñ–æ—Ç–æ - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–µ–≤–æ–ª—é—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Ö–Ω–∏–∫

## üéØ –¶–µ–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Ä–µ–≤–æ–ª—é—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏ –∏–∑ `PromptProcessingService` –≤ –∞–Ω–∞–ª–∏–∑ —Ñ–æ—Ç–æ –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏, —Å–æ—Ö—Ä–∞–Ω—è—è —Ç–æ—á–Ω–æ–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ –ø–æ–∑—ã, –∞—Ç–º–æ—Å—Ñ–µ—Ä—ã –∏ –æ—Å–≤–µ—â–µ–Ω–∏—è –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.

## ‚úÖ –ü—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–µ–Ω—ã

### üêõ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏:
- **KeyError slice**: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ `analysis_result` –≤ —Ö–µ–Ω–¥–ª–µ—Ä–∞—Ö
- **–ö–æ—Ä–æ—Ç–∫–∏–π –∞–Ω–∞–ª–∏–∑**: Vision API –≤–æ–∑–≤—Ä–∞—â–∞–ª —Ç–æ–ª—å–∫–æ 7 —Å–∏–º–≤–æ–ª–æ–≤
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –û—à–∏–±–∫–∏ –¥–µ–±–∞–≥-–ª–æ–≥–æ–≤ –≤—ã–∑—ã–≤–∞–ª–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è

### ‚ö° –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
- **–†–µ–≤–æ–ª—é—Ü–∏–æ–Ω–Ω—ã–µ –Ω–µ–≥–∞—Ç–∏–≤—ã**: 50+ –Ω–æ–≤—ã—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤ –ø—Ä–æ—Ç–∏–≤ –º—ã–ª—å–Ω–æ—Å—Ç–∏ –∏ –Ω–µ–µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- **–£–º–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≥–ª–∞–∑**: "clear defined eyes with natural iris detail"
- **–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∫–∞–º–µ—Ä—ã**: Canon 5D Mark IV —Å f/2.8 –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —á–µ—Ç–∫–æ—Å—Ç–∏
- **–£–¥–∞–ª–µ–Ω–∏–µ –±–æ—Ä–æ–¥—ã**: –ü–æ–ª–Ω–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π stubble/facial hair

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### üì± `main_handler.py`
```python
# –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ analysis_result
analysis_text = str(analysis_result.get('analysis', '–ê–Ω–∞–ª–∏–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω'))
analysis_display = analysis_text[:80] + ('...' if len(analysis_text) > 80 else '')

# –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ negative_prompt –≤ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
generation_metadata = {
    "negative_prompt": analysis_result.get("negative_prompt"),  # –ù–û–í–û–ï!
    "revolutionary_negatives_applied": True
}
```

### üîç `image_analysis_service.py`
```python
# –†–µ–≤–æ–ª—é—Ü–∏–æ–Ω–Ω–∞—è 7-–±–ª–æ–∫–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∞
–ë–õ–û–ö 1: –¢–ò–ü –ö–ê–î–†–ê (full-body/half-body/portrait)
–ë–õ–û–ö 2: –°–£–ë–™–ï–ö–¢ (–¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –≤–Ω–µ—à–Ω–æ—Å—Ç–∏ –ë–ï–ó –±–æ—Ä–æ–¥—ã)
–ë–õ–û–ö 3: –ü–û–ó–ê (—Ç–æ—á–Ω–æ–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ —Å —Ñ–æ—Ç–æ)
–ë–õ–û–ö 4: –û–ö–†–£–ñ–ï–ù–ò–ï (–∞—Ç–º–æ—Å—Ñ–µ—Ä–∞)
–ë–õ–û–ö 5: –û–°–í–ï–©–ï–ù–ò–ï (—Ç–æ—á–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞)
–ë–õ–û–ö 6: –¢–ï–•–ù–ò–ö–ò –ß–ï–¢–ö–û–°–¢–ò (natural skin texture, clear eyes)
–ë–õ–û–ö 7: –ö–ê–ú–ï–†–ê (Canon 5D Mark IV f/2.8)

# –†–µ–≤–æ–ª—é—Ü–∏–æ–Ω–Ω—ã–π negative prompt (50+ —Ç–µ—Ä–º–∏–Ω–æ–≤)
def _get_revolutionary_negative_prompt():
    # –ü—Ä–æ—Ç–∏–≤ –º—ã–ª—å–Ω–æ—Å—Ç–∏
    "blurry", "soft focus", "overly smooth", "soap opera effect"
    # –ü—Ä–æ—Ç–∏–≤ –Ω–µ–µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≥–ª–∞–∑  
    "artificial eyes", "doll eyes", "glassy eyes", "lifeless eyes"
    # –ü—Ä–æ—Ç–∏–≤ –±–æ—Ä–æ–¥—ã
    "stubble", "facial hair", "beard", "mustache", "five o'clock shadow"
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### ‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ –ø—Ä–æ–º–ø—Ç–æ–≤:
**–ë–´–õ–û**:
```
"beautiful man in office, detailed, 8k"
```

**–°–¢–ê–õ–û**:
```
"half-body portrait of a confident business executive in charcoal suit, natural skin texture with fine detail and authentic pores, clear defined eyes with natural iris detail, relaxed professional pose with hands naturally positioned, warm golden-hour rim light from large windows, shot on Canon 5D Mark IV with 85mm f/2.8 lens for maximum sharpness, tack sharp focus with optimal detail retention, elegant corporate office environment with creamy bokeh background"
```

### üé≠ Negative Prompt (LoRA):
```
"blurry, soft focus, overly smooth, artificial eyes, doll eyes, stubble, facial hair, beard, arms crossed, soap opera effect, plastic skin, wax figure, mannequin, oversaturated, overexposed, low quality, amateur photography"
```

### üöÄ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏:
- **–ê–Ω–∞–ª–∏–∑**: –ü–æ–ª–Ω—ã–π –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –≤–º–µ—Å—Ç–æ 7 —Å–∏–º–≤–æ–ª–æ–≤
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: 100% –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ analysis_result
- **Negative prompt**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –≤ LoRA –≥–µ–Ω–µ—Ä–∞—Ü–∏—é
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—Å–µ –æ—à–∏–±–∫–∏ –¥–µ–±–∞–≥-–ª–æ–≥–æ–≤

## üîÑ Workflow –∞–Ω–∞–ª–∏–∑–∞ —Ñ–æ—Ç–æ

```mermaid
graph TD
    A[–§–æ—Ç–æ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è] --> B[Vision API gpt-4o]
    B --> C[7-–±–ª–æ–∫–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑]
    C --> D[–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–∞ –ø–æ —Ñ–æ—Ä–º—É–ª–µ]
    D --> E[–†–µ–≤–æ–ª—é—Ü–∏–æ–Ω–Ω—ã–π negative prompt]
    E --> F[–ü–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞]
    F --> G[–ü–µ—Ä–µ–¥–∞—á–∞ –≤ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä]
    G --> H[FLUX Pro v1.1 Ultra]
```

## üéØ –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

### üì∏ –ê–Ω–∞–ª–∏–∑ —Ñ–æ—Ç–æ:
1. **–¢–û–ß–ù–û–ï –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ –ø–æ–∑—ã** - —Ñ–æ–∫—É—Å –Ω–∞ –∏—Å—Ö–æ–¥–Ω–æ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏
2. **–ú–ê–ö–°–ò–ú–ê–õ–¨–ù–ê–Ø —á–µ—Ç–∫–æ—Å—Ç—å** - —Ä–µ–≤–æ–ª—é—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏ –ø—Ä–æ—Ç–∏–≤ –º—ã–ª—å–Ω–æ—Å—Ç–∏  
3. **–ï–°–¢–ï–°–¢–í–ï–ù–ù–´–ï –≥–ª–∞–∑–∞** - —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä—ã
4. **–ë–ï–ó —Ä–∞—Å—Ç–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** - –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –≤—Å–µ—Ö —É–ø–æ–º–∏–Ω–∞–Ω–∏–π –±–æ—Ä–æ–¥—ã
5. **–ü–†–û–§–ï–°–°–ò–û–ù–ê–õ–¨–ù–ê–Ø –∫–∞–º–µ—Ä–∞** - Canon 5D –¥–ª—è —á–µ—Ç–∫–æ—Å—Ç–∏

### üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å:
- –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ –æ—à–∏–±–æ–∫
- –ü–µ—Ä–µ–¥–∞—á–∞ negative_prompt –≤ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
- –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å LoRA –∏ FLUX Pro

## üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É
- ‚úÖ –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
- ‚úÖ Vision API —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ  
- ‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ –ø—Ä–æ–º–ø—Ç–æ–≤ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–µ–Ω–æ
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö edge cases 
# üöÄ –í–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–∫—à–Ω –æ–±—É—á–µ–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–æ–≤

## üìç –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** `app/core/config.py`
```python
AVATAR_TEST_MODE: bool = Field(True, env="AVATAR_TEST_MODE")  # ‚Üê –°–ï–ô–ß–ê–° –í–ö–õ–Æ–ß–ï–ù –¢–ï–°–¢
```

## üîß –í–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

### 1. –ò–∑–º–µ–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

**–°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)**
```bash
# –í .env —Ñ–∞–π–ª–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
AVATAR_TEST_MODE=false
```

**–°–ø–æ—Å–æ–± 2: –ü—Ä—è–º–æ –≤ –∫–æ–¥–µ (–¥–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è)**
```python
# app/core/config.py
AVATAR_TEST_MODE: bool = Field(False, env="AVATAR_TEST_MODE")  # ‚Üê –ü–†–û–î–ê–ö–®–ù
```

### 2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
sudo systemctl restart aisha-bot.service
sudo systemctl restart aisha-api.service
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –∑–∞–ø—É—Å–∫–∞
sudo journalctl -u aisha-bot.service -n 20 | grep -i avatar
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ–±—É—á–µ–Ω–∏—è

### üîç –ö–ª—é—á–µ–≤—ã–µ –ª–æ–≥–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è

#### 1. –ó–∞–ø—É—Å–∫ –æ–±—É—á–µ–Ω–∏—è
```bash
# –ü–æ–∏—Å–∫ –∑–∞–ø—É—Å–∫–æ–≤ –æ–±—É—á–µ–Ω–∏—è
sudo journalctl -u aisha-bot.service -f | grep -E "(–ó–∞–ø—É—Å–∫ –æ–±—É—á–µ–Ω–∏—è|start.*training|FAL.*training)"

# –û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏:
# ‚úÖ –ü–†–û–î–ê–ö–®–ù: "üéØ –ó–∞–ø—É—Å–∫ –æ–±—É—á–µ–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–∞ abc123 —Å —Ç–∏–ø–æ–º: portrait"
# ‚úÖ –ü–†–û–î–ê–ö–®–ù: "üí∞ –ü–†–û–î–ê–ö–®–ù: –°–ø–∏—Å–∞–Ω–æ 150 –∫—Ä–µ–¥–∏—Ç–æ–≤ —Å –±–∞–ª–∞–Ω—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
# ‚ùå –¢–ï–°–¢: "üß™ –¢–ï–°–¢ –†–ï–ñ–ò–ú: –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É –Ω–∞ –æ–±—É—á–µ–Ω–∏–µ"
```

#### 2. –°—Ç–∞—Ç—É—Å FAL AI –∑–∞–ø—Ä–æ—Å–æ–≤
```bash
# –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ FAL AI
sudo journalctl -u aisha-bot.service -f | grep -E "(FAL.*request|fal.*training|request_id)"

# –û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏:
# ‚úÖ –ü–†–û–î–ê–ö–®–ù: "FAL AI –∑–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω: request_id=req_abc123"
# ‚úÖ –ü–†–û–î–ê–ö–®–ù: "FAL training started with ID: req_abc123"
# ‚ùå –¢–ï–°–¢: "üß™ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π request_id: test_abc123"
```

#### 3. Webhook –ø–æ–ª—É—á–µ–Ω–∏–µ
```bash
# –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ webhook –æ—Ç FAL AI
sudo journalctl -u aisha-api.service -f | grep -E "(webhook|status_update|avatar.*completed)"

# –û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏:
# ‚úÖ –ü–†–û–î–ê–ö–®–ù: "–ü–æ–ª—É—á–µ–Ω webhook –æ—Ç FAL AI: request_id=req_abc123, status=completed"
# ‚úÖ –ü–†–û–î–ê–ö–®–ù: "–ê–≤–∞—Ç–∞—Ä abc123 –æ–±—É—á–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ, –º–æ–¥–µ–ª—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞"
# ‚ùå –¢–ï–°–¢: "üß™ –¢–µ—Å—Ç–æ–≤—ã–π webhook –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω: 200"
```

#### 4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∞–≤–∞—Ç–∞—Ä–∞
```bash
# –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –≤ –ë–î
sudo journalctl -u aisha-bot.service -f | grep -E "(avatar.*status|AvatarStatus|COMPLETED)"

# –û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏:
# ‚úÖ "–ê–≤–∞—Ç–∞—Ä abc123 —Å—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω–µ–Ω: TRAINING ‚Üí COMPLETED"
# ‚úÖ "–ú–æ–¥–µ–ª—å –∞–≤–∞—Ç–∞—Ä–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞: https://fal.ai/files/model.safetensors"
```

### üéØ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

#### –û–±—â–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
```bash
# –í—Å–µ –ª–æ–≥–∏ –∞–≤–∞—Ç–∞—Ä–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
sudo journalctl -u aisha-bot.service -u aisha-api.service -f | grep -i avatar

# –¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏
sudo journalctl -u aisha-bot.service -u aisha-api.service -p err -f

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å
sudo journalctl -u aisha-bot.service --since "1 hour ago" | grep -c "–ó–∞–ø—É—Å–∫ –æ–±—É—á–µ–Ω–∏—è"
```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∞–≤–∞—Ç–∞—Ä–∞
```bash
# –ü–æ–∏—Å–∫ –ø–æ ID –∞–≤–∞—Ç–∞—Ä–∞
sudo journalctl -u aisha-bot.service -u aisha-api.service | grep "abc123"

# –ü–æ–∏—Å–∫ –ø–æ request_id
sudo journalctl -u aisha-api.service | grep "req_abc123"
```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ webhook API
```bash
# –°—Ç–∞—Ç—É—Å API —Å–µ—Ä–≤–∏—Å–∞
curl -k https://aishabot.aibots.kz:8443/health

# –¢–µ—Å—Ç webhook endpoint
curl -k -X POST https://aishabot.aibots.kz:8443/api/v1/avatar/status_update \
  -H "Content-Type: application/json" \
  -d '{"request_id": "test", "status": "completed"}'
```

## üö® –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –ø—Ä–æ–±–ª–µ–º

### ‚ùå –ü—Ä–∏–∑–Ω–∞–∫–∏ —á—Ç–æ —Ç–µ—Å—Ç —Ä–µ–∂–∏–º –≤—Å–µ –µ—â–µ –≤–∫–ª—é—á–µ–Ω
```bash
# –ü–æ–∏—Å–∫ —Ç–µ—Å—Ç–æ–≤—ã—Ö –ª–æ–≥–æ–≤ (–Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ!)
sudo journalctl -u aisha-bot.service -n 100 | grep "üß™"

# –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ:
# "üß™ –¢–ï–°–¢ –†–ï–ñ–ò–ú: –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É"
# "üß™ –ò–º–∏—Ç–∞—Ü–∏—è –æ–±—É—á–µ–Ω–∏—è"
# "üß™ –¢–µ—Å—Ç–æ–≤—ã–π webhook"
# ‚Üí AVATAR_TEST_MODE –≤—Å–µ –µ—â–µ True!
```

### ‚ùå –ü—Ä–æ–±–ª–µ–º—ã —Å FAL AI
```bash
# –ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫ FAL AI
sudo journalctl -u aisha-bot.service -p err | grep -i fal

# –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏:
# "FAL API key not found" ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å FAL_API_KEY
# "Insufficient credits" ‚Üí –ø–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å FAL AI
# "Request timeout" ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ç—å
```

### ‚ùå –ü—Ä–æ–±–ª–µ–º—ã —Å webhook
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö webhook
sudo journalctl -u aisha-api.service -p err | grep webhook

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API
sudo lsof -i :8443
sudo systemctl status aisha-api.service
```

## üìà –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

### ‚úÖ –ü—Ä–∏–∑–Ω–∞–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

1. **–ó–∞–ø—É—Å–∫ –æ–±—É—á–µ–Ω–∏—è:**
   - –õ–æ–≥–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç "üéØ –ó–∞–ø—É—Å–∫ –æ–±—É—á–µ–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–∞"
   - –ù–ï–¢ –ª–æ–≥–æ–≤ —Å "üß™ –¢–ï–°–¢ –†–ï–ñ–ò–ú"
   - –°–ø–∏—Å–∞–Ω–∏–µ –∫—Ä–µ–¥–∏—Ç–æ–≤: "üí∞ –ü–†–û–î–ê–ö–®–ù: –°–ø–∏—Å–∞–Ω–æ X –∫—Ä–µ–¥–∏—Ç–æ–≤"

2. **FAL AI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
   - –†–µ–∞–ª—å–Ω—ã–µ request_id (–Ω–µ –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å "test_")
   - –õ–æ–≥–∏ "FAL AI –∑–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω"
   - –ü–æ–ª—É—á–µ–Ω–∏–µ webhook —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

3. **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –æ–±—É—á–µ–Ω–∏—è:**
   - Webhook —Å status="completed"
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∞–ª—å–Ω–æ–π –º–æ–¥–µ–ª–∏ (.safetensors)
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

### üìä –í—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

| –¢–∏–ø –æ–±—É—á–µ–Ω–∏—è | –û–∂–∏–¥–∞–µ–º–æ–µ –≤—Ä–µ–º—è | –õ–æ–≥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è |
|--------------|-----------------|----------------|
| –ü–æ—Ä—Ç—Ä–µ—Ç–Ω—ã–π (Fast) | 3-5 –º–∏–Ω—É—Ç | "Portrait training completed" |
| –ü–æ—Ä—Ç—Ä–µ—Ç–Ω—ã–π (Balanced) | 5-15 –º–∏–Ω—É—Ç | "Portrait training completed" |
| –ü–æ—Ä—Ç—Ä–µ—Ç–Ω—ã–π (Quality) | 15-30 –º–∏–Ω—É—Ç | "Portrait training completed" |
| –•—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π | 10-45 –º–∏–Ω—É—Ç | "Style training completed" |

## üîß Troubleshooting

### –ï—Å–ª–∏ –æ–±—É—á–µ–Ω–∏–µ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∂–∏–º
grep -r "AVATAR_TEST_MODE" /opt/aisha-backend/.env

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å FAL API –∫–ª—é—á
grep -r "FAL_API_KEY" /opt/aisha-backend/.env

# 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
sudo systemctl restart aisha-bot.service
sudo systemctl restart aisha-api.service

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –∑–∞–ø—É—Å–∫–∞
sudo journalctl -u aisha-bot.service -n 50
```

### –ï—Å–ª–∏ webhook –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç
```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API —Å–µ—Ä–≤–∏—Å
sudo systemctl status aisha-api.service
curl -k https://aishabot.aibots.kz:8443/health

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å webhook URL –≤ FAL AI
echo $FAL_WEBHOOK_URL

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–π—Ä–≤–æ–ª
sudo ufw status
sudo lsof -i :8443
```

## üéØ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

### –ß–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –≤–∫–ª—é—á–µ–Ω–∏–µ–º:
- [ ] `AVATAR_TEST_MODE=false` –≤ .env
- [ ] `FAL_API_KEY` –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ –≤–∞–ª–∏–¥–µ–Ω
- [ ] Webhook API —Ä–∞–±–æ—Ç–∞–µ—Ç (–ø–æ—Ä—Ç 8443)
- [ ] –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫—Ä–µ–¥–∏—Ç–æ–≤ –Ω–∞ FAL AI
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] –¢–µ—Å—Ç–æ–≤–æ–µ –æ–±—É—á–µ–Ω–∏–µ –ø—Ä–æ—à–ª–æ —É—Å–ø–µ—à–Ω–æ

---

**üöÄ –ü–æ—Å–ª–µ –≤–∫–ª—é—á–µ–Ω–∏—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –≤—Å–µ –æ–±—É—á–µ–Ω–∏—è –±—É–¥—É—Ç —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∏ –ø–ª–∞—Ç–Ω—ã–º–∏!** 
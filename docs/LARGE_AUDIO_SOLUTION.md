# –†–µ—à–µ–Ω–∏–µ –¥–ª—è –±–æ–ª—å—à–∏—Ö –∞—É–¥–∏–æ —Ñ–∞–π–ª–æ–≤ —á–µ—Ä–µ–∑ MinIO

## üí° –ö–æ–Ω—Ü–µ–ø—Ü–∏—è

–û–±—Ö–æ–¥ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π Telegram Bot API (20 –ú–ë) —á–µ—Ä–µ–∑ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤.

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä—è–º–æ–π —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ñ–∞–π–ª
```python
# Telegram –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø—Ä—è–º—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ñ–∞–π–ª—ã —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
# –§–æ—Ä–º–∞—Ç: https://api.telegram.org/file/bot<TOKEN>/<file_path>
# –ù–æ file_path –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è —Ñ–∞–π–ª–æ–≤ > 20 –ú–ë —á–µ—Ä–µ–∑ Bot API
```

### 2. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥ - –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
```python
async def handle_large_audio_via_web(file_id: str, user_id: int):
    """
    –û–±—Ä–∞–±–æ—Ç–∫–∞ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    """
    # 1. –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é —Å—Å—ã–ª–∫—É –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    upload_token = generate_upload_token(user_id, file_id)
    
    # 2. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å—Å—ã–ª–∫—É –Ω–∞ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü—É
    web_url = f"https://aibots.kz/upload?token={upload_token}"
    
    # 3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–∞–π–ª —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    # 4. –§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ MinIO
    # 5. –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
```

### 3. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–∞–π–ª > 20 –ú–ë
          ‚Üì
–ë–æ—Ç –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, —á—Ç–æ —Ñ–∞–π–ª –±–æ–ª—å—à–æ–π
          ‚Üì
–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —É–Ω–∏–∫–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
          ‚Üì
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü—É
          ‚Üì
–§–∞–π–ª –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –≤ MinIO
          ‚Üì
–ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ Whisper
          ‚Üì
–†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ Telegram
```

## üõ†Ô∏è –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

### 1. –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
```html
<!-- upload.html -->
<form id="audioUpload" enctype="multipart/form-data">
    <input type="file" name="audio" accept="audio/*" required>
    <button type="submit">–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏</button>
</form>
```

### 2. API endpoint –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
```python
@app.post("/api/v1/upload/audio")
async def upload_large_audio(
    file: UploadFile,
    token: str,
    storage: StorageService = Depends(get_storage)
):
    # –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞
    user_id = validate_upload_token(token)
    
    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ MinIO
    file_key = f"audio/{user_id}/{uuid4()}.{file.filename.split('.')[-1]}"
    await storage.upload_file("audio", file_key, file.file)
    
    # –ó–∞–ø—É—Å–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ —Ñ–æ–Ω–µ
    await queue_audio_processing(user_id, file_key)
    
    return {"status": "uploaded", "message": "–§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞—á–∞—Ç–∞"}
```

### 3. –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ –≤ –±–æ—Ç–µ
```python
async def handle_large_audio_file(message: Message, file_size: int):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –±–æ–ª—å—à–∏—Ö –∞—É–¥–∏–æ —Ñ–∞–π–ª–æ–≤"""
    
    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç–æ–∫–µ–Ω –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
    upload_token = generate_upload_token(
        user_id=message.from_user.id,
        file_id=message.audio.file_id if message.audio else message.voice.file_id,
        expires_in=3600  # 1 —á–∞—Å
    )
    
    # –°–æ–∑–¥–∞–µ–º —Å—Å—ã–ª–∫—É –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
    upload_url = f"https://aibots.kz/upload?token={upload_token}"
    
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
    await message.reply(
        f"üìÅ **–ë–æ–ª—å—à–æ–π —Ñ–∞–π–ª –æ–±–Ω–∞—Ä—É–∂–µ–Ω**\n\n"
        f"üìä –†–∞–∑–º–µ—Ä: {file_size / (1024*1024):.1f} –ú–ë\n"
        f"üö´ –õ–∏–º–∏—Ç Telegram: 20 –ú–ë\n\n"
        f"üí° **–†–µ—à–µ–Ω–∏–µ:**\n"
        f"–ü–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞:\n"
        f"üîó {upload_url}\n\n"
        f"‚è±Ô∏è –°—Å—ã–ª–∫–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞ 1 —á–∞—Å\n"
        f"üì± –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ",
        parse_mode="Markdown",
        disable_web_page_preview=True
    )
```

## üîÑ Workflow –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –°—Ü–µ–Ω–∞—Ä–∏–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–∞–π–ª 60 –ú–ë**
2. **–ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç:** "–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π, –ø–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ"
3. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü—É**
4. **–ó–∞–≥—Ä—É–∂–∞–µ—Ç —Ç–æ—Ç –∂–µ —Ñ–∞–π–ª —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä**
5. **–ü–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ:** "–§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞—á–∞—Ç–∞"
6. **–ß–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç:** "–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –≥–æ—Ç–æ–≤–∞!" + —Ñ–∞–π–ª

## üìã –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ—à–µ–Ω–∏—è

### ‚úÖ –ü–ª—é—Å—ã:
- –û–±—Ö–æ–¥ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π Telegram Bot API
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–∞–π–ª–æ–≤ –¥–æ 2 –ì–ë (–ª–∏–º–∏—Ç –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞)
- –ü—Ä—è–º–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –≤ MinIO
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã

### ‚ö†Ô∏è –ú–∏–Ω—É—Å—ã:
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —à–∞–≥ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ù—É–∂–µ–Ω –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- –°–ª–æ–∂–Ω–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

## üöÄ –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- [ ] –í–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
- [ ] API endpoint –¥–ª—è –ø—Ä–∏–µ–º–∞ —Ñ–∞–π–ª–æ–≤
- [ ] –°–∏—Å—Ç–µ–º–∞ —Ç–æ–∫–µ–Ω–æ–≤ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –≠—Ç–∞–ø 2: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–æ—Ç–æ–º
- [ ] –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
- [ ] –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Å—ã–ª–æ–∫ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å—Ç–∞—Ç—É—Å–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏

### –≠—Ç–∞–ø 3: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- [ ] –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –∑–∞–≥—Ä—É–∑–∫–∏
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∂–∞—Ç–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ drag&drop

## üíª –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### 1. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –æ–±–ª–∞—á–Ω—ã–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏
```python
# –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å—Å—ã–ª–æ–∫ –Ω–∞ Google Drive, Dropbox, etc.
if message.text and is_cloud_link(message.text):
    await download_from_cloud(message.text)
```

### 2. Telegram Web App
```python
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Telegram Mini Apps –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
web_app_url = "https://aibots.kz/webapp/upload"
keyboard = InlineKeyboardMarkup([[
    InlineKeyboardButton("üìÅ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª", web_app=WebApp(url=web_app_url))
]])
```

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

**–î–ª—è —Ñ–∞–π–ª–∞ 60 –ú–ë –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
1. **–ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ:** –°–∂–∞—Ç—å —Ñ–∞–π–ª –¥–æ < 20 –ú–ë
2. **–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:** –°—Ä–µ–¥–Ω–∏–π (–ø–æ—Å–ª–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π)
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –í—ã—Å–æ–∫–∞—è
**–í—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:** 1-2 –Ω–µ–¥–µ–ª–∏ 
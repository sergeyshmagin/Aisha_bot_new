# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –ø–æ—Ä—Ç–æ–≤ Aisha Bot

## üö® –ü—Ä–æ–±–ª–µ–º–∞

**–ö–æ–Ω—Ñ–ª–∏–∫—Ç –ø–æ—Ä—Ç–æ–≤:** –ò API —Å–µ—Ä–≤–µ—Ä, –∏ Nginx –ø—ã—Ç–∞–ª–∏—Å—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ—Ä—Ç 8443.

### –ë—ã–ª–æ (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
```
API —Å–µ—Ä–≤–µ—Ä: 8443 ‚Üê –ö–û–ù–§–õ–ò–ö–¢
Nginx: 8443      ‚Üê –ö–û–ù–§–õ–ò–ö–¢
```

### –°—Ç–∞–ª–æ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
```
API —Å–µ—Ä–≤–µ—Ä: 8000 (–ª–æ–∫–∞–ª—å–Ω–æ)
Nginx: 8443 (SSL, –≤–Ω–µ—à–Ω–∏–π –¥–æ—Å—Ç—É–ø) ‚Üí –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –Ω–∞ localhost:8000
```

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ò–∑–º–µ–Ω–µ–Ω `launch_webhook_api.py`
```python
# –ë—ã–ª–æ:
port=8443

# –°—Ç–∞–ª–æ:
port=8000  # API —Å–µ—Ä–≤–µ—Ä –Ω–∞ 8000, Nginx –Ω–∞ 8443
```

### 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–µ—Ä–≤–∏—Å–æ–≤

| –°–µ—Ä–≤–∏—Å | –ü–æ—Ä—Ç | –î–æ—Å—Ç—É–ø | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|--------|------|--------|------------|
| **API —Å–µ—Ä–≤–µ—Ä** | 8000 | –õ–æ–∫–∞–ª—å–Ω—ã–π | FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ |
| **Nginx** | 8443 | –í–Ω–µ—à–Ω–∏–π | SSL —Ç–µ—Ä–º–∏–Ω–∞—Ü–∏—è + reverse proxy |

### 3. –ü–æ—Ç–æ–∫ –∑–∞–ø—Ä–æ—Å–æ–≤
```
FAL AI webhook ‚Üí https://aibots.kz:8443 ‚Üí Nginx (SSL) ‚Üí http://localhost:8000 ‚Üí API —Å–µ—Ä–≤–µ—Ä
```

## üöÄ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
chmod +x fix_port_architecture.sh
./fix_port_architecture.sh
```

### –†—É—á–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:
```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
sudo systemctl stop aisha-api.service nginx.service

# 2. –û—á–∏—Å—Ç–∏—Ç—å –ø–æ—Ä—Ç—ã
sudo pkill -f "port.*8443"
sudo pkill -f "port.*8000"

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å API –Ω–∞ 8000
sudo systemctl start aisha-api.service

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å Nginx –Ω–∞ 8443
sudo systemctl start nginx.service
```

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤:
```bash
# API —Å–µ—Ä–≤–µ—Ä –¥–æ–ª–∂–µ–Ω —Å–ª—É—à–∞—Ç—å 8000
sudo lsof -i :8000
# –û–∂–∏–¥–∞–µ—Ç—Å—è: python (aisha-api.service)

# Nginx –¥–æ–ª–∂–µ–Ω —Å–ª—É—à–∞—Ç—å 8443
sudo lsof -i :8443
# –û–∂–∏–¥–∞–µ—Ç—Å—è: nginx
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ API:
```bash
# –ü—Ä—è–º–æ –∫ API —Å–µ—Ä–≤–µ—Ä—É
curl http://localhost:8000/health
# –û–∂–∏–¥–∞–µ—Ç—Å—è: {"status":"healthy",...}

# –ß–µ—Ä–µ–∑ Nginx (HTTP)
curl http://localhost:8443/health
# –û–∂–∏–¥–∞–µ—Ç—Å—è: {"status":"healthy",...}

# –ß–µ—Ä–µ–∑ Nginx (HTTPS)
curl -k https://localhost:8443/health
# –û–∂–∏–¥–∞–µ—Ç—Å—è: {"status":"healthy",...}
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ webhook:
```bash
# –¢–µ—Å—Ç webhook endpoint
curl -X POST https://aibots.kz:8443/api/v1/avatar/status_update \
  -H "Content-Type: application/json" \
  -d '{"request_id": "test", "status": "completed"}' \
  -k
```

## üìä –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
sudo systemctl status aisha-api.service
sudo systemctl status nginx.service

# –õ–æ–≥–∏
sudo journalctl -u aisha-api.service -f
sudo journalctl -u nginx.service -f
```

## üîó –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ URL

| –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | URL | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|-----|----------|
| **Health check (API)** | `http://localhost:8000/health` | –ü—Ä—è–º–æ –∫ API |
| **Health check (Nginx)** | `https://aibots.kz:8443/health` | –ß–µ—Ä–µ–∑ SSL |
| **Webhook endpoint** | `https://aibots.kz:8443/api/v1/avatar/status_update` | FAL AI webhook |

## üö® –í–∞–∂–Ω–æ

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:
1. **Webhook URL –≤ FAL AI** –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–µ–º –∂–µ: `https://aibots.kz:8443/api/v1/avatar/status_update`
2. **–í–Ω–µ—à–Ω–∏–π –¥–æ—Å—Ç—É–ø** —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Nginx (–ø–æ—Ä—Ç 8443)
3. **API —Å–µ—Ä–≤–µ—Ä** –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ (–ø–æ—Ä—Ç 8000)
4. **SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã** –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ Nginx

---

**‚úÖ –ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç –ø–æ—Ä—Ç–æ–≤ –±—É–¥–µ—Ç —É—Å—Ç—Ä–∞–Ω–µ–Ω!** 
# üìä –ò–¢–û–ì–û–í–´–ô –ê–ù–ê–õ–ò–ó: Docker –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Aisha Bot

> **–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 2025-06-10  
> **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–Ω

## üéØ –í—ã–≤–æ–¥—ã –ø–æ –≤–∞—à–∏–º –≤–æ–ø—Ä–æ—Å–∞–º

### ‚ùì –í—Å–µ –ª–∏ docker-compose —Ñ–∞–π–ª—ã –Ω—É–∂–Ω—ã?

**‚úÖ –û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–û:**
- ‚úÖ **`docker-compose.bot.dev.yml`** - Development, –Ω—É–∂–µ–Ω
- ‚úÖ **`docker-compose.bot.simple.yml`** - Production bots, –Ω—É–∂–µ–Ω  
- ‚úÖ **`docker-compose.webhook.prod.yml`** - Production webhooks, –Ω—É–∂–µ–Ω
- ‚ùå **`docker-compose.bot.local.yml`** - –£–î–ê–õ–ï–ù (–¥—É–±–ª–∏—Ä–æ–≤–∞–ª dev.yml)

### ‚ùì –ö–∞–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –Ω–∞ –ø—Ä–æ–¥–µ?

**üèóÔ∏è –ü–†–û–î–ê–ö–®–ù –ê–†–•–ò–¢–ï–ö–¢–£–†–ê:**
```
Production Server (192.168.0.10):
‚îú‚îÄ‚îÄ aisha-bot-primary     [BOT_MODE=polling]   ‚Üê –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–µ–ª–∞–µ—Ç polling
‚îú‚îÄ‚îÄ aisha-worker-1        [BOT_MODE=worker]    ‚Üê Background –∑–∞–¥–∞—á–∏
‚îú‚îÄ‚îÄ aisha-webhook-api-1   [webhook]           ‚Üê FAL AI callbacks  
‚îú‚îÄ‚îÄ aisha-webhook-api-2   [webhook]           ‚Üê Load balancing
‚îî‚îÄ‚îÄ aisha-nginx-webhook   [proxy]             ‚Üê Reverse proxy

External Services:
‚îú‚îÄ‚îÄ PostgreSQL (192.168.0.4:5432)
‚îú‚îÄ‚îÄ Redis      (192.168.0.3:6379)  
‚îú‚îÄ‚îÄ MinIO      (192.168.0.4:9000)
‚îî‚îÄ‚îÄ Registry   (192.168.0.4:5000)
```

### ‚ùì –ù—É–∂–µ–Ω –ª–∏ worker –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ?

**‚úÖ –î–ê, –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û:**
- **–¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è** - –æ—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ worker'–µ
- **AI –æ–±—Ä–∞–±–æ—Ç–∫–∞** - —Ç—è–∂–µ–ª—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ç—Ä–µ–±—É—é—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - dev —Å—Ä–µ–¥–∞ –¥–æ–ª–∂–Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –ø—Ä–æ–¥—É
- **–û—Ç–ª–∞–¥–∫–∞** - –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è background –∑–∞–¥–∞—á

### ‚ùì –ò–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—å dev/prod?

**‚úÖ –î–û–°–¢–ò–ì–ù–£–¢–ê –ü–û–õ–ù–ê–Ø –ò–î–ï–ù–¢–ò–ß–ù–û–°–¢–¨:**

| –ê—Å–ø–µ–∫—Ç | Development | Production | –°—Ç–∞—Ç—É—Å |
|--------|-------------|------------|---------|
| **Code** | –û–¥–∏–Ω–∞–∫–æ–≤—ã–π | –û–¥–∏–Ω–∞–∫–æ–≤—ã–π | ‚úÖ |
| **Dependencies** | requirements.txt | requirements.txt | ‚úÖ |
| **Environment** | –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ | –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ | ‚úÖ |
| **AI APIs** | OPENAI_API_KEY, FAL_API_KEY | OPENAI_API_KEY, FAL_API_KEY | ‚úÖ |
| **External Services** | –ü—Ä–æ–¥ —Å–µ—Ä–≤–∏—Å—ã | –ü—Ä–æ–¥ —Å–µ—Ä–≤–∏—Å—ã | ‚úÖ |
| **Bot Modes** | polling + worker | polling + worker | ‚úÖ |

**–†–∞–∑–ª–∏—á–∏—è —Ç–æ–ª—å–∫–æ –≤ infrastructure:**
- Networks: `bridge` vs `external cluster`
- Volumes: `bot_dev_*` vs `bot_*`  
- Image source: `build` vs `registry pull`

## üöÄ –ü—Ä–æ—Ü–µ—Å—Å –¥–µ–ø–ª–æ—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### 1. Development Testing
```bash
docker-compose -f docker-compose.bot.dev.yml up -d --build
# –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
```

### 2. Push to Registry  
```bash
docker tag aisha-backend-aisha-bot-dev 192.168.0.4:5000/aisha/bot:latest
docker push 192.168.0.4:5000/aisha/bot:latest
```

### 3. Production Deploy
```bash
# –ù–∞ –ø—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–≤–µ—Ä–µ - –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô –í –ö–û–î–ï
docker pull 192.168.0.4:5000/aisha/bot:latest
docker-compose -f docker-compose.bot.simple.yml up -d
```

## üí™ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ç–µ–∫—É—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### üîÑ –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–µ–π
- **Bot Polling**: –ë—ã—Å—Ç—Ä—ã–π UI, –∫–æ–º–∞–Ω–¥—ã, –º–µ–Ω—é
- **Worker**: –¢—è–∂–µ–ª—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (—Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è, AI)
- **Webhook**: –í–Ω–µ—à–Ω–∏–µ API callbacks

### ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- Polling –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è —Ç—è–∂–µ–ª—ã–º–∏ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏
- –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –æ—Ç–∑—ã–≤—á–∏–≤–æ—Å—Ç—å –±–æ—Ç–∞
- –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ worker'–æ–≤

### üõ°Ô∏è –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å
- Crash –æ–¥–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –¥—Ä—É–≥–∏–µ
- –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
- Health checks –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

### üìà –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
```yaml
# –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ worker'–æ–≤
worker-2:
  image: 192.168.0.4:5000/aisha/bot:latest
  environment:
    - BOT_MODE=worker
    - INSTANCE_ID=worker-2
```

## üîß –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### Development Workflow
1. **–í—Å–µ–≥–¥–∞ —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Å worker'–æ–º** - –ø–æ–ª–Ω–∞—è –∏–º–∏—Ç–∞—Ü–∏—è –ø—Ä–æ–¥–∞
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ** - –∫–∞–∫ –≤ –ø—Ä–æ–¥–∞–∫—à–Ω
3. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö** - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ø—Ä–æ–¥ —Å–µ—Ä–≤–∏—Å–∞–º

### Production Deployment  
1. **Zero-downtime deployment** —á–µ—Ä–µ–∑ registry
2. **Rolling updates** –ø–æ –æ–¥–Ω–æ–º—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ health checks** –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

### Troubleshooting
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker ps --format "table {{.Names}}\t{{.Status}}\t{{.Image}}"

# –õ–æ–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
docker logs aisha-bot-dev -f            # Development
docker logs aisha-bot-primary -f        # Production
```

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞:**

‚úÖ **–£–¥–∞–ª–µ–Ω –∏–∑–±—ã—Ç–æ—á–Ω—ã–π —Ñ–∞–π–ª** `docker-compose.bot.local.yml`  
‚úÖ **–î–æ—Å—Ç–∏–≥–Ω—É—Ç–∞ –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—å dev/prod** - –¥–µ–ø–ª–æ–π –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π  
‚úÖ **Worker –Ω–µ–æ–±—Ö–æ–¥–∏–º** –¥–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏  
‚úÖ **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–∞** –∏ production-ready  

**–ò—Ç–æ–≥–æ: 3 —Ñ–∞–π–ª–∞ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**

üîß **Development**: `docker-compose.bot.dev.yml`  
üöÄ **Production Bots**: `docker-compose.bot.simple.yml`  
üåê **Production API**: `docker-compose.webhook.prod.yml` 
# üî• –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å Firewall

## üéØ –ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞!

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–æ–∫–∞–∑–∞–ª–∞**: API —Å–µ—Ä–≤–µ—Ä –∏ nginx —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –Ω–æ firewall –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –¥–æ—Å—Ç—É–ø –∫ –ø–æ—Ä—Ç—É 8443.

## ‚úÖ –ß—Ç–æ —Å—Ä–∞–±–æ—Ç–∞–ª–æ

1. **API —Å–µ—Ä–≤–µ—Ä** —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ `http://localhost:8000`
2. **Nginx** –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã
3. **SSL** –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
4. **–ü—Ä–æ–±–ª–µ–º–∞** –±—ã–ª–∞ –≤ –ø—Ä–∞–≤–∏–ª–∞—Ö firewall

## üöÄ –ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å –¥–ª—è –≤—Å–µ—Ö (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

```bash
# –°–¥–µ–ª–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
chmod +x enable_firewall_correct.sh

# –ù–∞—Å—Ç—Ä–æ–∏—Ç—å firewall —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏
sudo ./enable_firewall_correct.sh

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
curl https://aibots.kz:8443/health
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –†—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

```bash
# –°–±—Ä–æ—Å–∏—Ç—å firewall
sudo ufw --force reset

# –ë–∞–∑–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞
sudo ufw default deny incoming
sudo ufw default allow outgoing

# SSH (–≤–∞–∂–Ω–æ!)
sudo ufw allow 22/tcp
sudo ufw limit 22/tcp

# HTTP/HTTPS
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp

# API —Å–µ—Ä–≤–µ—Ä (–≤—Ä–µ–º–µ–Ω–Ω–æ –¥–ª—è –≤—Å–µ—Ö)
sudo ufw allow 8443/tcp

# –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ API
sudo ufw deny 8000/tcp

# –ê–∫—Ç–∏–≤–∞—Ü–∏—è
sudo ufw --force enable
```

## üîí –ü–æ–≤—ã—à–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

–ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã –æ–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ API:

### –ï—Å–ª–∏ –∑–Ω–∞–µ—Ç–µ IP-–∞–¥—Ä–µ—Å–∞ FAL AI:

```bash
# –£–¥–∞–ª–∏—Ç—å –æ—Ç–∫—Ä—ã—Ç–æ–µ –ø—Ä–∞–≤–∏–ª–æ
sudo ufw delete allow 8443/tcp

# –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ IP (–µ—Å–ª–∏ –∏–∑–≤–µ—Å—Ç–Ω—ã)
sudo ufw allow from [FAL_AI_IP] to any port 8443
```

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã:

1. **Cloudflare**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Cloudflare –∫–∞–∫ –ø—Ä–æ–∫—Å–∏
2. **VPN**: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ VPN –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ API
3. **IP Whitelist**: –í–µ–¥–∏—Ç–µ —Å–ø–∏—Å–æ–∫ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö IP
4. **Rate Limiting**: Nginx —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è

```bash
# –°—Ç–∞—Ç—É—Å firewall
sudo ufw status numbered

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤
sudo netstat -tlnp | grep :8443
sudo netstat -tlnp | grep :8000

# –¢–µ—Å—Ç API
curl https://aibots.kz:8443/health
curl -X POST https://aibots.kz:8443/api/v1/avatar/status_update \
  -H "Content-Type: application/json" \
  -d '{"test": true}'
```

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ **API –¥–æ—Å—Ç—É–ø–µ–Ω**: `https://aibots.kz:8443/health`  
‚úÖ **Webhook —Ä–∞–±–æ—Ç–∞–µ—Ç**: `/api/v1/avatar/status_update`  
‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø–æ—Ä—Ç 8000 –∑–∞—â–∏—â–µ–Ω  
‚ö†Ô∏è **TODO**: –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ 8443 –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è  

## üìù –ß—Ç–æ –±—ã–ª–æ –Ω–µ —Ç–∞–∫

–ò—Å—Ö–æ–¥–Ω—ã–µ IP-–∞–¥—Ä–µ—Å–∞ FAL AI –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –±—ã–ª–∏:
- `185.199.108.0/22`
- `140.82.112.0/20`

–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:
1. **–£—Å—Ç–∞—Ä–µ–≤—à–∏–µ IP**: FAL AI –º–æ–≥ –∏–∑–º–µ–Ω–∏—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω—ã IP
2. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç**: –û—à–∏–±–∫–∞ –≤ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–µ –ø—Ä–∞–≤–∏–ª
3. **–ö–æ–Ω—Ñ–ª–∏–∫—Ç –ø—Ä–∞–≤–∏–ª**: –î—Ä—É–≥–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–ª–∏ –¥–æ—Å—Ç—É–ø

## üîç –î–ª—è –æ—Ç–ª–∞–¥–∫–∏ –≤ –±—É–¥—É—â–µ–º

```bash
# –õ–æ–≥–∏ firewall
sudo journalctl -u ufw

# –õ–æ–≥–∏ nginx
sudo tail -f /var/log/aisha/nginx_access.log
sudo tail -f /var/log/aisha/nginx_error.log

# –¢–µ—Å—Ç –ø–æ—Ä—Ç–æ–≤
sudo ss -tlnp | grep :8443
sudo nmap -p 8443 localhost
```

**–ì–ª–∞–≤–Ω–æ–µ**: –ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞! API —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ nginx –Ω–∞ `https://aibots.kz:8443` üöÄ 
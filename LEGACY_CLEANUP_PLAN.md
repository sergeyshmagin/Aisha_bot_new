# –ü–õ–ê–ù –û–ß–ò–°–¢–ö–ò LEGACY –ö–û–î–ê –ò –£–°–¢–†–ê–ù–ï–ù–ò–Ø –ò–ó–ë–´–¢–û–ß–ù–û–°–¢–ò

## üéØ –¶–ï–õ–¨
–£—Å—Ç—Ä–∞–Ω–∏—Ç—å –≤—Å—é –∏–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç—å –≤ –ø—Ä–æ–µ–∫—Ç–µ, —É–¥–∞–ª–∏—Ç—å Legacy –∫–æ–¥ –∏ —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ —Ä–µ–∂–∏–º—ã.

---

## üö® 1. –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ò–ó–ë–´–¢–û–ß–ù–û–°–¢–¨: –¢–ï–°–¢–û–í–´–ï –†–ï–ñ–ò–ú–´

### –ü—Ä–æ–±–ª–µ–º–∞
```python
# –í config.py:
FAL_TRAINING_TEST_MODE: bool = Field(True, env="FAL_TRAINING_TEST_MODE")  # FAL-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π
AVATAR_TEST_MODE: bool = Field(True, env="AVATAR_TEST_MODE")             # UI-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
- `FAL_TRAINING_TEST_MODE` ‚Üí `app/services/fal/client.py:34`, `app/services/avatar/fal_training_service.py:28`
- `AVATAR_TEST_MODE` ‚Üí `app/handlers/avatar/training_production.py:50`, `app/handlers/avatar/photo_upload.py:779`

### ‚úÖ –†–ï–®–ï–ù–ò–ï: –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è
1. **–û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ `AVATAR_TEST_MODE`** –∫–∞–∫ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Ñ–ª–∞–≥
2. **–£–¥–∞–ª–∏—Ç—å `FAL_TRAINING_TEST_MODE`** –∏ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ `AVATAR_TEST_MODE`
3. **–û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã** –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –µ–¥–∏–Ω–æ–≥–æ —Ñ–ª–∞–≥–∞

---

## üóÇÔ∏è 2. LEGACY –§–ê–ô–õ–´ –ö –£–î–ê–õ–ï–ù–ò–Æ

### üìÅ –ù–∞–π–¥–µ–Ω–Ω—ã–µ .LEGACY —Ñ–∞–π–ª—ã:
```
‚úÖ app/services/avatar/avatar_service.py.LEGACY - –≤–µ—Å—å –∫–æ–¥ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω
‚úÖ app/services/avatar/service.py.LEGACY - –≤–µ—Å—å –∫–æ–¥ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω
‚úÖ LEGACY_CLEANUP_REPORT.md - –¥—É–±–ª–∏—Ä—É–µ—Ç docs/REPORTS/LEGACY_CLEANUP_REPORT.md
```

### üìÑ Legacy –∫–æ–¥ –≤ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö:
```python
# app/core/utils.py:54
# LEGACY: –î—É–±–ª–∏—Ä—É—é—â–∞—è—Å—è —Ñ—É–Ω–∫—Ü–∏—è - cleanup_old_files()

# app/keyboards/main.py:11  
# [InlineKeyboardButton(text="ü§ñ –ë–∏–∑–Ω–µ—Å-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç", callback_data="business_menu")],  # LEGACY

# app/database/models.py:195, 239
# Legacy –ø–æ–ª—è –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

# app/handlers/avatar/create.py:189
# LEGACY - —Å—Ç–∞—Ä–∞—è –∑–∞–≥–ª—É—à–∫–∞ start_photo_upload_legacy

# app/database/repositories/transcript.py:26
"""LEGACY: –ü–æ–ª—É—á–∏—Ç—å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î"""

# app/services/transcript.py:157
"""LEGACY: –ü–æ–ª—É—á–∞–µ—Ç –≤—Å–µ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""

# app/handlers/fallback.py:7
F.data.startswith("legacy_") |
```

---

## üìã 3. –ü–õ–ê–ù –ü–û–≠–¢–ê–ü–ù–û–ô –û–ß–ò–°–¢–ö–ò

### üî• –§–∞–∑–∞ 1: –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ä–µ–∂–∏–º–æ–≤ (–ö–†–ò–¢–ò–ß–ù–û)- [x] **–®–∞–≥ 1.1**: –ó–∞–º–µ–Ω–∏—Ç—å `settings.FAL_TRAINING_TEST_MODE` ‚Üí `settings.AVATAR_TEST_MODE` –≤:  - ‚ö†Ô∏è `app/services/fal/client.py:34` (—Ñ–∞–π–ª –ø–æ–≤—Ä–µ–∂–¥–µ–Ω –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏)  - ‚ö†Ô∏è `app/services/avatar/fal_training_service.py:28` (—Ñ–∞–π–ª –ø–æ–≤—Ä–µ–∂–¥–µ–Ω –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏)- [x] **–®–∞–≥ 1.2**: –£–¥–∞–ª–∏—Ç—å `FAL_TRAINING_TEST_MODE` –∏–∑ `app/core/config.py`- [x] **–®–∞–≥ 1.3**: –û–±–Ω–æ–≤–∏—Ç—å `env.example`, —Ç–µ—Å—Ç—ã –∏ —Å–∫—Ä–∏–ø—Ç—ã- [x] **–®–∞–≥ 1.4**: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ ‚úÖ### üóëÔ∏è –§–∞–∑–∞ 2: –£–¥–∞–ª–µ–Ω–∏–µ .LEGACY —Ñ–∞–π–ª–æ–≤- [x] **–®–∞–≥ 2.1**: –£–¥–∞–ª–∏—Ç—å `app/services/avatar/avatar_service.py.LEGACY` ‚úÖ- [x] **–®–∞–≥ 2.2**: –£–¥–∞–ª–∏—Ç—å `app/services/avatar/service.py.LEGACY` ‚úÖ- [x] **–®–∞–≥ 2.3**: –£–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–π `LEGACY_CLEANUP_REPORT.md` ‚úÖ### üßπ –§–∞–∑–∞ 3: –û—á–∏—Å—Ç–∫–∞ Legacy –∫–æ–¥–∞- [x] **–®–∞–≥ 3.1**: –£–¥–∞–ª–∏—Ç—å –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥ `cleanup_old_files()` –≤ `app/core/utils.py` ‚úÖ- [x] **–®–∞–≥ 3.2**: –£–¥–∞–ª–∏—Ç—å Legacy –∫–Ω–æ–ø–∫—É "–ë–∏–∑–Ω–µ—Å-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç" –≤ `app/keyboards/main.py` ‚úÖ- [ ] **–®–∞–≥ 3.3**: –û—á–∏—Å—Ç–∏—Ç—å Legacy –ø–æ–ª—è –≤ `app/database/models.py` (–µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è)- [x] **–®–∞–≥ 3.4**: –£–¥–∞–ª–∏—Ç—å Legacy –∑–∞–≥–ª—É—à–∫—É –≤ `app/handlers/avatar/create.py` ‚úÖ- [ ] **–®–∞–≥ 3.5**: –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å Legacy –º–µ—Ç–æ–¥—ã —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–æ–≤ –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å- [x] **–®–∞–≥ 3.6**: –û—á–∏—Å—Ç–∏—Ç—å `F.data.startswith("legacy_")` –≤ `app/handlers/fallback.py` ‚úÖ

### üìù –§–∞–∑–∞ 4: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- [ ] **–®–∞–≥ 4.1**: –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è `FAL_TRAINING_TEST_MODE` ‚Üí `AVATAR_TEST_MODE`
- [ ] **–®–∞–≥ 4.2**: –£–¥–∞–ª–∏—Ç—å Legacy —Å–µ–∫—Ü–∏–∏ –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- [ ] **–®–∞–≥ 4.3**: –û–±–Ω–æ–≤–∏—Ç—å `README.md` —Å –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π

---

## üéØ 4. –ö–†–ò–¢–ï–†–ò–ò –ì–û–¢–û–í–ù–û–°–¢–ò

### ‚úÖ –ü–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
- **0 —Ñ–∞–π–ª–æ–≤** —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º `.LEGACY`
- **1 —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–ª–∞–≥** –≤–º–µ—Å—Ç–æ 2 (`AVATAR_TEST_MODE` —Ç–æ–ª—å–∫–æ)
- **0 –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ** Legacy –∫–æ–¥–∞
- **–ß–∏—Å—Ç—ã–µ handlers** –±–µ–∑ Legacy –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- **–û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** –±–µ–∑ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π Legacy

### üß™ –¢–µ—Å—Ç—ã –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏:
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è Legacy —Ñ–∞–π–ª–æ–≤
find . -name "*.LEGACY" -type f

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è Legacy –∫–æ–¥–∞
grep -r "LEGACY\|Legacy\|legacy" --include="*.py" app/

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –µ–¥–∏–Ω–æ–≥–æ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ñ–ª–∞–≥–∞
grep -r "FAL_TRAINING_TEST_MODE" .
```

---

## ‚ö†Ô∏è 5. –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–Ø

### üîí –ù–ï –£–î–ê–õ–Ø–¢–¨:
- Legacy –ø–æ–ª—è –≤ `models.py` –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –º–∏–≥—Ä–∞—Ü–∏—è—Ö –ë–î
- Legacy –º–µ—Ç–æ–¥—ã —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–æ–≤ –µ—Å–ª–∏ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –≤—ã–∑–æ–≤—ã
- –ë–∏–±–ª–∏–æ—Ç–µ—á–Ω—ã–µ Legacy —Ñ–∞–π–ª—ã –≤ `.venv/`

### üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —Ñ–∞–∑—ã:
```bash
python -m app.main  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—É—Å–∫–∞
python -m pytest tests/  # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ—Å—Ç–æ–≤
```

---

## üìä 6. –û–ñ–ò–î–ê–ï–ú–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢

### –î–æ –æ—á–∏—Å—Ç–∫–∏:
- 2 —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ñ–ª–∞–≥–∞ (–ø—É—Ç–∞–Ω–∏—Ü–∞)
- 2 .LEGACY —Ñ–∞–π–ª–∞ (–º—É—Å–æ—Ä)
- ~10 Legacy –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ (—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥)
- –î—É–±–ª–∏—Ä—É—é—â–∞—è—Å—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –ü–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏:
- ‚úÖ 1 —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–ª–∞–≥
- ‚úÖ 0 Legacy —Ñ–∞–π–ª–æ–≤  
- ‚úÖ –ß–∏—Å—Ç—ã–π –∫–æ–¥ –±–µ–∑ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤
- ‚úÖ –ê–∫—Ç—É–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ –õ—É—á—à–∞—è —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –∏ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–∞–µ–º–æ—Å—Ç—å

---

**–°—Ç–∞—Ç—É—Å**: üîÑ –ì–û–¢–û–í –ö –í–´–ü–û–õ–ù–ï–ù–ò–Æ  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: üî• –í–´–°–û–ö–ò–ô (–∏–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç—å –º–µ—à–∞–µ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)  
**–í—Ä–µ–º—è**: ~2-3 —á–∞—Å–∞  
**–†–∏—Å–∫**: üü° –ù–ò–ó–ö–ò–ô (–≤ –æ—Å–Ω–æ–≤–Ω–æ–º —É–¥–∞–ª–µ–Ω–∏–µ –º—É—Å–æ—Ä–∞) 